/' 
# TI-Messenger 1.1
# TI-Messenger-Dienst
# UC - 10063
# Sequence Diagram
# Name: Austausch von Events innerhalb eines Messenger-Service
'/

@startuml
skinparam sequenceMessageAlign direction
skinparam minClassWidth 200
skinparam BoxPadding 1
skinparam sequenceReferenceHeaderBackgroundColor palegreen
scale max 2048 width

skinparam sequence {
ArrowColor black
ArrowFontSize 17
ActorBorderColor black
LifeLineBorderColor black
LifeLineBackgroundColor Gainsboro

ParticipantBorderColor Motivation
ParticipantBackgroundColor Motivation
ParticipantFontName Impact
ParticipantFontSize 20
ParticipantFontColor black
ParticipantBorderColor Black
ParticipantBackgroundColor MOTIVATION

ActorBackgroundColor Gainsboro
ActorFontColor black
ActorFontSize 20
ActorFontName Aapex
}
    actor U1 as "Akteur - A in der Rolle\nUser / User-HBA"
    participant C1 as "TI-Messenger-\nClient"
    box <size:18>Messenger-Service A</size> #WhiteSmoke
      participant MP1 as "Messenger-\nProxy"
      participant MH1 as "Matrix-\nHomeserver"
    end box
    participant VZD as "VZD-FHIR-\nDirectory"
    box <size:18>Messenger-Service B</size> #WhiteSmoke
    participant MH2 as "Matrix-\nHomeserver"
    participant MP2 as "Messenger-\nProxy"
    participant PS2 as "PASSPorT-\nService"
    end box
    participant C2 as "TI-Messenger-\nClient"
    actor U2 as "Akteur - B in der Rolle\nUser / User-HBA"
    
note over U1, MH1: \n<size:17>Der Akteur ist erfolgreich beim Messenger Service angemeldet</size>\n    
    
    alt#LightGrey  <size:16>Suche über VZD-FHIR-Directory</size>
      |||
      ref over U1, VZD : <size:16>Anhang B - Einträge im VZD-FHIR-Directory suchen</size>\n
      |||
    end
    alt#LightGrey  <size:16>PASSporT über QR-Code Austausch</size>
      |||
       note over U1, U2: Akteur A und Akteur B treffen sich in Person
       autonumber
       U1-[#0000FF]>C1: QR-Code teilen
        activate C1
       U2-[#red]>C2: QR-Code scannen
        activate C2
       C2-[#red]>C1: GET /scan
       C1-[#0000FF]>C2: MXID
       C2-[#red]>PS2: GET /user/{mxid} 
        activate PS2
       PS2-[#red]>PS2: PASSporT erstellen
       PS2--[#red]>C2: PASSporT
        deactivate PS2
       C2--[#red]>C1: PASSporT + MXID
       autonumber stop
      |||
    end
    
    |||
    C1->MP1: POST /_matrix/client/r0/rooms/\n{roomId}/invite \n(PASSporT)
    
@enduml
