<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2164px" preserveAspectRatio="none" style="width:1615px;height:2164px;background:#FFFFFF;" version="1.1" viewBox="0 0 1615 2164" width="1615px" zoomAndPan="magnify"><defs><filter height="300%" id="f5792n7hkh8hu" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#F5F5F5" height="2152.5391" style="stroke:#A80036;stroke-width:1.0;" width="682" x="913.5" y="6"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="200" x="1152" y="22.708">VZD-FHIR-Directory</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="0" x="1357" y="23.8872"/><rect fill="#DCDCDC" filter="url(#f5792n7hkh8hu)" height="1744.2578" style="stroke:#000000;stroke-width:1.0;" width="10" x="329.5" y="287.7188"/><rect fill="#DCDCDC" filter="url(#f5792n7hkh8hu)" height="134.1563" style="stroke:#000000;stroke-width:1.0;" width="10" x="564.5" y="774.7344"/><rect fill="#DCDCDC" filter="url(#f5792n7hkh8hu)" height="167.9453" style="stroke:#000000;stroke-width:1.0;" width="10" x="792.5" y="774.7344"/><rect fill="#DCDCDC" filter="url(#f5792n7hkh8hu)" height="33.7891" style="stroke:#000000;stroke-width:1.0;" width="10" x="792.5" y="1097.625"/><rect fill="#DCDCDC" filter="url(#f5792n7hkh8hu)" height="121.1563" style="stroke:#000000;stroke-width:1.0;" width="10" x="1021.5" y="552.2109"/><rect fill="#DCDCDC" filter="url(#f5792n7hkh8hu)" height="33.7891" style="stroke:#000000;stroke-width:1.0;" width="10" x="1021.5" y="976.4688"/><rect fill="#DCDCDC" filter="url(#f5792n7hkh8hu)" height="101.3672" style="stroke:#000000;stroke-width:1.0;" width="10" x="1021.5" y="1063.8359"/><rect fill="#DCDCDC" filter="url(#f5792n7hkh8hu)" height="33.7891" style="stroke:#000000;stroke-width:1.0;" width="10" x="1021.5" y="1351.9375"/><rect fill="#DCDCDC" filter="url(#f5792n7hkh8hu)" height="167.9453" style="stroke:#000000;stroke-width:1.0;" width="10" x="1021.5" y="1523.9297"/><rect fill="#DCDCDC" filter="url(#f5792n7hkh8hu)" height="167.9453" style="stroke:#000000;stroke-width:1.0;" width="10" x="1021.5" y="1765.2422"/><rect fill="#DCDCDC" filter="url(#f5792n7hkh8hu)" height="53.5781" style="stroke:#000000;stroke-width:1.0;" width="10" x="1249.5" y="586"/><rect fill="#DCDCDC" filter="url(#f5792n7hkh8hu)" height="53.5781" style="stroke:#000000;stroke-width:1.0;" width="10" x="1249.5" y="1010.2578"/><rect fill="#DCDCDC" filter="url(#f5792n7hkh8hu)" height="186.7344" style="stroke:#000000;stroke-width:1.0;" width="10" x="1249.5" y="1165.2031"/><rect fill="#DCDCDC" filter="url(#f5792n7hkh8hu)" height="33.7891" style="stroke:#000000;stroke-width:1.0;" width="10" x="1477.5" y="1624.2969"/><rect fill="#DCDCDC" filter="url(#f5792n7hkh8hu)" height="33.7891" style="stroke:#000000;stroke-width:1.0;" width="10" x="1477.5" y="1865.6094"/><rect fill="#F0F8FF" filter="url(#f5792n7hkh8hu)" height="979.6406" style="stroke:#000000;stroke-width:2.0;" width="1427.5" x="10" y="414.0859"/><rect fill="#FFFFFF" filter="url(#f5792n7hkh8hu)" height="567.25" style="stroke:#000000;stroke-width:2.0;" width="1591.5" x="10" y="1432.7266"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="116" x2="116" y1="118.5625" y2="2041.9766"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="334.5" x2="334.5" y1="118.5625" y2="2041.9766"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="569.5" x2="569.5" y1="118.5625" y2="2041.9766"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="797.5" x2="797.5" y1="118.5625" y2="2041.9766"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1026.5" x2="1026.5" y1="118.5625" y2="2041.9766"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1254.5" x2="1254.5" y1="118.5625" y2="2041.9766"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1482.5" x2="1482.5" y1="118.5625" y2="2041.9766"/><text fill="#000000" font-family="Aapex" font-size="20" lengthAdjust="spacing" textLength="187" x="20" y="90.5645">Akteur in der Rolle</text><text fill="#000000" font-family="Aapex" font-size="20" lengthAdjust="spacing" textLength="95" x="66" y="113.8457">User-HBA</text><ellipse cx="116.5" cy="15" fill="#DCDCDC" filter="url(#f5792n7hkh8hu)" rx="8" ry="8" style="stroke:#000000;stroke-width:2.0;"/><path d="M116.5,23 L116.5,50 M103.5,31 L129.5,31 M116.5,50 L103.5,65 M116.5,50 L129.5,65 " fill="none" filter="url(#f5792n7hkh8hu)" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="Aapex" font-size="20" lengthAdjust="spacing" textLength="187" x="20" y="2059.541">Akteur in der Rolle</text><text fill="#000000" font-family="Aapex" font-size="20" lengthAdjust="spacing" textLength="95" x="66" y="2082.8223">User-HBA</text><ellipse cx="116.5" cy="2097.5391" fill="#DCDCDC" filter="url(#f5792n7hkh8hu)" rx="8" ry="8" style="stroke:#000000;stroke-width:2.0;"/><path d="M116.5,2105.5391 L116.5,2132.5391 M103.5,2113.5391 L129.5,2113.5391 M116.5,2132.5391 L103.5,2147.5391 M116.5,2132.5391 L129.5,2147.5391 " fill="none" filter="url(#f5792n7hkh8hu)" style="stroke:#000000;stroke-width:2.0;"/><rect fill="#EFEFFF" filter="url(#f5792n7hkh8hu)" height="37.2813" style="stroke:#000000;stroke-width:1.5;" width="214" x="225.5" y="76.2813"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="198" x="233.5" y="101.8457">TI-Messenger-Client</text><rect fill="#EFEFFF" filter="url(#f5792n7hkh8hu)" height="37.2813" style="stroke:#000000;stroke-width:1.5;" width="214" x="225.5" y="2040.9766"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="198" x="233.5" y="2066.541">TI-Messenger-Client</text><rect fill="#EFEFFF" filter="url(#f5792n7hkh8hu)" height="60.5625" style="stroke:#000000;stroke-width:1.5;" width="214" x="460.5" y="53"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="138" x="495.5" y="78.5645">Authenticator</text><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="145" x="495" y="101.8457">des IDP-Dienst</text><rect fill="#EFEFFF" filter="url(#f5792n7hkh8hu)" height="60.5625" style="stroke:#000000;stroke-width:1.5;" width="214" x="460.5" y="2040.9766"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="138" x="495.5" y="2066.541">Authenticator</text><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="145" x="495" y="2089.8223">des IDP-Dienst</text><rect fill="#EFEFFF" filter="url(#f5792n7hkh8hu)" height="37.2813" style="stroke:#000000;stroke-width:1.5;" width="214" x="688.5" y="76.2813"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="104" x="743.5" y="101.8457">IDP-Dienst</text><rect fill="#EFEFFF" filter="url(#f5792n7hkh8hu)" height="37.2813" style="stroke:#000000;stroke-width:1.5;" width="214" x="688.5" y="2040.9766"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="104" x="743.5" y="2066.541">IDP-Dienst</text><rect fill="#EFEFFF" filter="url(#f5792n7hkh8hu)" height="37.2813" style="stroke:#000000;stroke-width:1.5;" width="214" x="917.5" y="76.2813"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="108" x="970.5" y="101.8457">FHIR-Proxy</text><rect fill="#EFEFFF" filter="url(#f5792n7hkh8hu)" height="37.2813" style="stroke:#000000;stroke-width:1.5;" width="214" x="917.5" y="2040.9766"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="108" x="970.5" y="2066.541">FHIR-Proxy</text><rect fill="#EFEFFF" filter="url(#f5792n7hkh8hu)" height="37.2813" style="stroke:#000000;stroke-width:1.5;" width="214" x="1145.5" y="76.2813"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="128" x="1188.5" y="101.8457">Auth-Service</text><rect fill="#EFEFFF" filter="url(#f5792n7hkh8hu)" height="37.2813" style="stroke:#000000;stroke-width:1.5;" width="214" x="1145.5" y="2040.9766"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="128" x="1188.5" y="2066.541">Auth-Service</text><rect fill="#EFEFFF" filter="url(#f5792n7hkh8hu)" height="37.2813" style="stroke:#000000;stroke-width:1.5;" width="214" x="1373.5" y="76.2813"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="145" x="1408" y="101.8457">FHIR-Directory</text><rect fill="#EFEFFF" filter="url(#f5792n7hkh8hu)" height="37.2813" style="stroke:#000000;stroke-width:1.5;" width="214" x="1373.5" y="2040.9766"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="145" x="1408" y="2066.541">FHIR-Directory</text><rect fill="#DCDCDC" filter="url(#f5792n7hkh8hu)" height="1744.2578" style="stroke:#000000;stroke-width:1.0;" width="10" x="329.5" y="287.7188"/><rect fill="#DCDCDC" filter="url(#f5792n7hkh8hu)" height="134.1563" style="stroke:#000000;stroke-width:1.0;" width="10" x="564.5" y="774.7344"/><rect fill="#DCDCDC" filter="url(#f5792n7hkh8hu)" height="167.9453" style="stroke:#000000;stroke-width:1.0;" width="10" x="792.5" y="774.7344"/><rect fill="#DCDCDC" filter="url(#f5792n7hkh8hu)" height="33.7891" style="stroke:#000000;stroke-width:1.0;" width="10" x="792.5" y="1097.625"/><rect fill="#DCDCDC" filter="url(#f5792n7hkh8hu)" height="121.1563" style="stroke:#000000;stroke-width:1.0;" width="10" x="1021.5" y="552.2109"/><rect fill="#DCDCDC" filter="url(#f5792n7hkh8hu)" height="33.7891" style="stroke:#000000;stroke-width:1.0;" width="10" x="1021.5" y="976.4688"/><rect fill="#DCDCDC" filter="url(#f5792n7hkh8hu)" height="101.3672" style="stroke:#000000;stroke-width:1.0;" width="10" x="1021.5" y="1063.8359"/><rect fill="#DCDCDC" filter="url(#f5792n7hkh8hu)" height="33.7891" style="stroke:#000000;stroke-width:1.0;" width="10" x="1021.5" y="1351.9375"/><rect fill="#DCDCDC" filter="url(#f5792n7hkh8hu)" height="167.9453" style="stroke:#000000;stroke-width:1.0;" width="10" x="1021.5" y="1523.9297"/><rect fill="#DCDCDC" filter="url(#f5792n7hkh8hu)" height="167.9453" style="stroke:#000000;stroke-width:1.0;" width="10" x="1021.5" y="1765.2422"/><rect fill="#DCDCDC" filter="url(#f5792n7hkh8hu)" height="53.5781" style="stroke:#000000;stroke-width:1.0;" width="10" x="1249.5" y="586"/><rect fill="#DCDCDC" filter="url(#f5792n7hkh8hu)" height="53.5781" style="stroke:#000000;stroke-width:1.0;" width="10" x="1249.5" y="1010.2578"/><rect fill="#DCDCDC" filter="url(#f5792n7hkh8hu)" height="186.7344" style="stroke:#000000;stroke-width:1.0;" width="10" x="1249.5" y="1165.2031"/><rect fill="#DCDCDC" filter="url(#f5792n7hkh8hu)" height="33.7891" style="stroke:#000000;stroke-width:1.0;" width="10" x="1477.5" y="1624.2969"/><rect fill="#DCDCDC" filter="url(#f5792n7hkh8hu)" height="33.7891" style="stroke:#000000;stroke-width:1.0;" width="10" x="1477.5" y="1865.6094"/><path d="M16,158.5625 L16,187.5625 L897,187.5625 L897,168.5625 L887,158.5625 L16,158.5625 " fill="#FBFB77" filter="url(#f5792n7hkh8hu)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M887,158.5625 L887,168.5625 L897,168.5625 L887,158.5625 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="615" x="142.75" y="179.3423">Der Akteur ist bei einem Messenger Service angemeldet (siehe AF_10057</text><polygon fill="#000000" points="317.5,283.7188,327.5,287.7188,317.5,291.7188,321.5,287.7188" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="116.5" x2="323.5" y1="287.7188" y2="287.7188"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="168" x="123.5" y="242.1313">FHIR Ressourcen im</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="166" x="123.5" y="261.9204">VZD-FHIR-Directory</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="160" x="123.5" y="281.7095">hinzufügen (MXID)</text><line style="stroke:#000000;stroke-width:1.0;" x1="339.5" x2="381.5" y1="361.0859" y2="361.0859"/><line style="stroke:#000000;stroke-width:1.0;" x1="381.5" x2="381.5" y1="361.0859" y2="374.0859"/><line style="stroke:#000000;stroke-width:1.0;" x1="340.5" x2="381.5" y1="374.0859" y2="374.0859"/><polygon fill="#000000" points="350.5,370.0859,340.5,374.0859,350.5,378.0859,346.5,374.0859" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="167" x="346.5" y="315.4985">Prüfung, ob gültiges</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="159" x="346.5" y="335.2876">owner-accesstoken</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="64" x="346.5" y="355.0767">vorliegt</text><path d="M10,414.0859 L74,414.0859 L74,421.0859 L64,431.0859 L10,431.0859 L10,414.0859 " fill="#D3D3D3" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="979.6406" style="stroke:#000000;stroke-width:2.0;" width="1427.5" x="10" y="414.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="25" y="427.1528">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="5" x="89" y="432.1167">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="312" x="94" y="430.9375">kein gültigess owner-access-token</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="5" x="406" y="432.1167">]</text><line style="stroke:#000000;stroke-width:1.0;" x1="339.5" x2="381.5" y1="505.4219" y2="505.4219"/><line style="stroke:#000000;stroke-width:1.0;" x1="381.5" x2="381.5" y1="505.4219" y2="518.4219"/><line style="stroke:#000000;stroke-width:1.0;" x1="340.5" x2="381.5" y1="518.4219" y2="518.4219"/><polygon fill="#000000" points="350.5,514.4219,340.5,518.4219,350.5,522.4219,346.5,518.4219" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="164" x="346.5" y="479.6235">Erzeuge PKCE Code</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="211" x="346.5" y="499.4126">für verifier und challenge</text><polygon fill="#000000" points="1009.5,548.2109,1019.5,552.2109,1009.5,556.2109,1013.5,552.2109" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="339.5" x2="1015.5" y1="552.2109" y2="552.2109"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="211" x="346.5" y="546.2017">GET /owner-authenticate</text><polygon fill="#000000" points="1237.5,582,1247.5,586,1237.5,590,1241.5,586" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="1031.5" x2="1243.5" y1="586" y2="586"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="117" x="1038.5" y="579.9907">HTTP Forward</text><polygon fill="#000000" points="1042.5,635.5781,1032.5,639.5781,1042.5,643.5781,1038.5,639.5781" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1036.5" x2="1253.5" y1="639.5781" y2="639.5781"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="115" x="1127.5" y="613.7798">Redirct to IDP</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="193" x="1054.5" y="633.5688">Authorization Endpoint</text><polygon fill="#000000" points="350.5,669.3672,340.5,673.3672,350.5,677.3672,346.5,673.3672" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="344.5" x2="1025.5" y1="673.3672" y2="673.3672"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="117" x="902.5" y="667.3579">HTTP Forward</text><polygon fill="#000000" points="127.5,703.1563,117.5,707.1563,127.5,711.1563,123.5,707.1563" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="121.5" x2="328.5" y1="707.1563" y2="707.1563"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="189" x="133.5" y="701.147">Liste verfügbarer IDP's</text><polygon fill="#000000" points="317.5,736.9453,327.5,740.9453,317.5,744.9453,321.5,740.9453" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="116.5" x2="323.5" y1="740.9453" y2="740.9453"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="155" x="123.5" y="734.936">ausgewählterr IDP</text><polygon fill="#000000" points="780.5,770.7344,790.5,774.7344,780.5,778.7344,784.5,774.7344" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="339.5" x2="786.5" y1="774.7344" y2="774.7344"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="124" x="346.5" y="768.7251">GET /authorize</text><polygon fill="#000000" points="350.5,804.5234,340.5,808.5234,350.5,812.5234,346.5,808.5234" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="344.5" x2="791.5" y1="808.5234" y2="808.5234"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="209" x="576.5" y="802.5142">Authentication challenge</text><line style="stroke:#000000;stroke-width:1.0;" x1="574.5" x2="616.5" y1="842.3125" y2="842.3125"/><line style="stroke:#000000;stroke-width:1.0;" x1="616.5" x2="616.5" y1="842.3125" y2="855.3125"/><line style="stroke:#000000;stroke-width:1.0;" x1="575.5" x2="616.5" y1="855.3125" y2="855.3125"/><polygon fill="#000000" points="585.5,851.3125,575.5,855.3125,585.5,859.3125,581.5,855.3125" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="124" x="581.5" y="836.3032">Authentication</text><polygon fill="#000000" points="780.5,904.8906,790.5,908.8906,780.5,912.8906,784.5,908.8906" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="569.5" x2="786.5" y1="908.8906" y2="908.8906"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="124" x="576.5" y="883.0923">Authentication</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="159" x="576.5" y="902.8813">challenge response</text><polygon fill="#000000" points="350.5,938.6797,340.5,942.6797,350.5,946.6797,346.5,942.6797" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="344.5" x2="796.5" y1="942.6797" y2="942.6797"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="405" x="385.5" y="936.6704">Authorization Response with Authorization Code</text><polygon fill="#000000" points="1009.5,972.4688,1019.5,976.4688,1009.5,980.4688,1013.5,976.4688" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="339.5" x2="1015.5" y1="976.4688" y2="976.4688"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="415" x="346.5" y="970.4595">GET /owner-authenticate with Authorization code</text><polygon fill="#000000" points="1237.5,1006.2578,1247.5,1010.2578,1237.5,1014.2578,1241.5,1010.2578" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="1026.5" x2="1243.5" y1="1010.2578" y2="1010.2578"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="117" x="1033.5" y="1004.2485">HTTP Forward</text><polygon fill="#000000" points="1042.5,1059.8359,1032.5,1063.8359,1042.5,1067.8359,1038.5,1063.8359" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1036.5" x2="1253.5" y1="1063.8359" y2="1063.8359"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="178" x="1069.5" y="1038.0376">POST /tokenEndpoint</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="169" x="1078.5" y="1057.8267">(authorization code)</text><polygon fill="#000000" points="813.5,1093.625,803.5,1097.625,813.5,1101.625,809.5,1097.625" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="807.5" x2="1020.5" y1="1097.625" y2="1097.625"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="117" x="897.5" y="1091.6157">HTTP Forward</text><polygon fill="#000000" points="1009.5,1127.4141,1019.5,1131.4141,1009.5,1135.4141,1013.5,1131.4141" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="797.5" x2="1015.5" y1="1131.4141" y2="1131.4141"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="170" x="804.5" y="1125.4048">Response (id_token)</text><polygon fill="#000000" points="1237.5,1161.2031,1247.5,1165.2031,1237.5,1169.2031,1241.5,1165.2031" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="1026.5" x2="1243.5" y1="1165.2031" y2="1165.2031"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="117" x="1033.5" y="1159.1938">HTTP Forward</text><line style="stroke:#000000;stroke-width:1.0;" x1="1259.5" x2="1301.5" y1="1198.9922" y2="1198.9922"/><line style="stroke:#000000;stroke-width:1.0;" x1="1301.5" x2="1301.5" y1="1198.9922" y2="1211.9922"/><line style="stroke:#000000;stroke-width:1.0;" x1="1260.5" x2="1301.5" y1="1211.9922" y2="1211.9922"/><polygon fill="#000000" points="1270.5,1207.9922,1260.5,1211.9922,1270.5,1215.9922,1266.5,1211.9922" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="121" x="1266.5" y="1192.9829">prüfe id_token</text><line style="stroke:#000000;stroke-width:1.0;" x1="1259.5" x2="1301.5" y1="1265.5703" y2="1265.5703"/><line style="stroke:#000000;stroke-width:1.0;" x1="1301.5" x2="1301.5" y1="1265.5703" y2="1278.5703"/><line style="stroke:#000000;stroke-width:1.0;" x1="1260.5" x2="1301.5" y1="1278.5703" y2="1278.5703"/><polygon fill="#000000" points="1270.5,1274.5703,1260.5,1278.5703,1270.5,1282.5703,1266.5,1278.5703" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="66" x="1266.5" y="1239.772">erzeuge</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="159" x="1266.5" y="1259.561">owner-accesstoken</text><polygon fill="#000000" points="1042.5,1347.9375,1032.5,1351.9375,1042.5,1355.9375,1038.5,1351.9375" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1036.5" x2="1253.5" y1="1351.9375" y2="1351.9375"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="111" x="1131.5" y="1306.3501">HTTP 200 OK</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="130" x="1117.5" y="1326.1392">(access_token=</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="166" x="1081.5" y="1345.9282">owner-accesstoken)</text><polygon fill="#000000" points="350.5,1381.7266,340.5,1385.7266,350.5,1389.7266,346.5,1385.7266" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="344.5" x2="1025.5" y1="1385.7266" y2="1385.7266"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="117" x="902.5" y="1379.7173">HTTP Forward</text><path d="M10,1432.7266 L297,1432.7266 L297,1442.7266 L287,1452.7266 L10,1452.7266 L10,1432.7266 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="567.25" style="stroke:#000000;stroke-width:2.0;" width="1591.5" x="10" y="1432.7266"/><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="242" x="25" y="1448.5781">VZD-FHIR-Directory Eintrag</text><polygon fill="#000000" points="1009.5,1519.9297,1019.5,1523.9297,1009.5,1527.9297,1013.5,1523.9297" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="339.5" x2="1015.5" y1="1523.9297" y2="1523.9297"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="513" x="346.5" y="1498.1313">GET /owner/TIHealthCareService?providedBy.id=telematikID</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="338" x="346.5" y="1517.9204">Authorization Bearer owner-accesstoken</text><line style="stroke:#000000;stroke-width:1.0;" x1="1031.5" x2="1073.5" y1="1577.5078" y2="1577.5078"/><line style="stroke:#000000;stroke-width:1.0;" x1="1073.5" x2="1073.5" y1="1577.5078" y2="1590.5078"/><line style="stroke:#000000;stroke-width:1.0;" x1="1032.5" x2="1073.5" y1="1590.5078" y2="1590.5078"/><polygon fill="#000000" points="1042.5,1586.5078,1032.5,1590.5078,1042.5,1594.5078,1038.5,1590.5078" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="44" x="1038.5" y="1551.7095">prüfe</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="159" x="1038.5" y="1571.4985">owner-accesstoken</text><polygon fill="#000000" points="1465.5,1620.2969,1475.5,1624.2969,1465.5,1628.2969,1469.5,1624.2969" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="1031.5" x2="1471.5" y1="1624.2969" y2="1624.2969"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="117" x="1038.5" y="1618.2876">HTTP Forward</text><polygon fill="#000000" points="1042.5,1654.0859,1032.5,1658.0859,1042.5,1662.0859,1038.5,1658.0859" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1036.5" x2="1481.5" y1="1658.0859" y2="1658.0859"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="262" x="1213.5" y="1652.0767">HTTP 200 OK (result body json)</text><polygon fill="#000000" points="350.5,1687.875,340.5,1691.875,350.5,1695.875,346.5,1691.875" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="344.5" x2="1025.5" y1="1691.875" y2="1691.875"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="262" x="757.5" y="1685.8657">HTTP 200 OK (result body json)</text><polygon fill="#000000" points="1009.5,1761.2422,1019.5,1765.2422,1009.5,1769.2422,1013.5,1765.2422" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="339.5" x2="1015.5" y1="1765.2422" y2="1765.2422"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="463" x="346.5" y="1719.6548">PUT /owner/TIHealthCareService?telecom.value=MXID</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="338" x="346.5" y="1739.4438">Authorization Bearer owner-accesstoken</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="314" x="346.5" y="1759.2329">(Optional: setze Flag für Sichtbarkeit)</text><line style="stroke:#000000;stroke-width:1.0;" x1="1031.5" x2="1073.5" y1="1818.8203" y2="1818.8203"/><line style="stroke:#000000;stroke-width:1.0;" x1="1073.5" x2="1073.5" y1="1818.8203" y2="1831.8203"/><line style="stroke:#000000;stroke-width:1.0;" x1="1032.5" x2="1073.5" y1="1831.8203" y2="1831.8203"/><polygon fill="#000000" points="1042.5,1827.8203,1032.5,1831.8203,1042.5,1835.8203,1038.5,1831.8203" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="44" x="1038.5" y="1793.022">prüfe</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="159" x="1038.5" y="1812.811">owner-accesstoken</text><polygon fill="#000000" points="1465.5,1861.6094,1475.5,1865.6094,1465.5,1869.6094,1469.5,1865.6094" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="1031.5" x2="1471.5" y1="1865.6094" y2="1865.6094"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="117" x="1038.5" y="1859.6001">HTTP Forward</text><polygon fill="#000000" points="1042.5,1895.3984,1032.5,1899.3984,1042.5,1903.3984,1038.5,1899.3984" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1036.5" x2="1481.5" y1="1899.3984" y2="1899.3984"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="303" x="1172.5" y="1893.3892">HTTP 201 Created (result body json)</text><polygon fill="#000000" points="350.5,1929.1875,340.5,1933.1875,350.5,1937.1875,346.5,1933.1875" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="344.5" x2="1025.5" y1="1933.1875" y2="1933.1875"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="303" x="716.5" y="1927.1782">HTTP 201 Created (result body json)</text><polygon fill="#000000" points="127.5,1962.9766,117.5,1966.9766,127.5,1970.9766,123.5,1966.9766" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="121.5" x2="328.5" y1="1966.9766" y2="1966.9766"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="54" x="268.5" y="1960.9673">Status</text><!--MD5=[bf4f079cf915de9c53afdb8541ddbbb7]
@startuml
skinparam sequenceMessageAlign direction
skinparam minClassWidth 200
skinparam BoxPadding 1
skinparam sequenceReferenceHeaderBackgroundColor palegreen
scale max 2048 width

skinparam sequence {
ArrowColor black
ArrowFontSize 17
ActorBorderColor black
LifeLineBorderColor black
LifeLineBackgroundColor Gainsboro

ParticipantBorderColor Motivation
ParticipantBackgroundColor Motivation
ParticipantFontName Impact
ParticipantFontSize 20
ParticipantFontColor black
ParticipantBorderColor Black
ParticipantBackgroundColor MOTIVATION

ActorBackgroundColor Gainsboro
ActorFontColor black
ActorFontSize 20
ActorFontName Aapex
}
    actor U as "Akteur in der Rolle\nUser-HBA"
    participant C as "TI-Messenger-Client"
    participant A as "Authenticator \ndes IDP-Dienst"
    participant I as "IDP-Dienst" 
    box <size:18>VZD-FHIR-Directory</size> #WhiteSmoke
      participant FP as "FHIR-Proxy"
      participant Auth as "Auth-Service"
      participant VZD as "FHIR-Directory"
    end box

|||
note over U, I: <size:17>Der Akteur ist bei einem Messenger Service angemeldet (siehe AF_10057</size>
|||

U->C: FHIR Ressourcen im \nVZD-FHIR-Directory \nhinzufügen (MXID)
  Activate C
C->C: Prüfung, ob gültiges \nowner-accesstoken \nvorliegt

|||
alt#LightGrey #AliceBlue <size:16>kein gültigess owner-access-token</size>
|||

  C->C: Erzeuge PKCE Code \nfür verifier und challenge
  C->FP: GET /owner-authenticate
    Activate FP
  FP->Auth: HTTP Forward
    Activate Auth
  Auth- ->FP: Redirct to IDP \nAuthorization Endpoint
    Deactivate Auth
  FP- ->C: HTTP Forward
    Deactivate FP
        
  C->U: Liste verfügbarer IDP's
  U->C: ausgewählterr IDP
    
  C->I: GET /authorize
    Activate A
    Activate I
  I- ->C: Authentication challenge
  A->A: Authentication
  A->I: Authentication \nchallenge response
    Deactivate A
  I- ->C: Authorization Response with Authorization Code
    Deactivate I
          
  C->FP: GET /owner-authenticate with Authorization code
    Activate FP
  FP->Auth: HTTP Forward
    Deactivate FP
    Activate Auth
  Auth- ->FP: POST /tokenEndpoint\n(authorization code)
    Deactivate Auth
    Activate FP
  FP- ->I: HTTP Forward
    Activate I
  I->FP: Response (id_token)
    Deactivate I
  FP->Auth: HTTP Forward
    Deactivate FP
    Activate Auth
  Auth->Auth: prüfe id_token
  Auth->Auth: erzeuge \nowner-accesstoken
  Auth- ->FP: HTTP 200 OK \n(access_token=\nowner-accesstoken)
    Deactivate Auth
    Activate FP
  FP- ->C: HTTP Forward
    Deactivate FP
end
      
|||

group <size:16>VZD-FHIR-Directory Eintrag</size>
  |||
  C->FP: GET /owner/TIHealthCareService?providedBy.id=telematikID \nAuthorization Bearer owner-accesstoken
    Activate FP
  FP->FP: prüfe \nowner-accesstoken
  FP->VZD: HTTP Forward
    Activate VZD
  VZD- ->FP: HTTP 200 OK (result body json)
    Deactivate VZD
  FP- ->C: HTTP 200 OK (result body json)
    Deactivate FP
  C->FP: PUT /owner/TIHealthCareService?telecom.value=MXID \nAuthorization Bearer owner-accesstoken \n(Optional: setze Flag für Sichtbarkeit)
    Activate FP
  FP->FP: prüfe \nowner-accesstoken
  FP->VZD: HTTP Forward
    Activate VZD
  VZD- ->FP: HTTP 201 Created (result body json)
    Deactivate VZD
  FP- ->C: HTTP 201 Created (result body json)
    Deactivate FP
  C- ->U: Status    
  |||
end
|||

  Deactivate C
@enduml

PlantUML version 1.2021.16(Wed Dec 08 17:25:22 UTC 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>