<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2488px" preserveAspectRatio="none" style="width:1690px;height:2488px;background:#FFFFFF;" version="1.1" viewBox="0 0 1690 2488" width="1690px" zoomAndPan="magnify"><defs><filter height="300%" id="fmjfwxinl0wcr" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#F5F5F5" height="2476.7891" style="stroke:#A80036;stroke-width:1.0;" width="454" x="220" y="6"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="93" x="400.5" y="22.708">Endgerät</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="0" x="449.5" y="39.02"/><rect fill="#F5F5F5" height="2476.7891" style="stroke:#A80036;stroke-width:1.0;" width="689" x="906" y="6"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="200" x="1148" y="22.708">VZD-FHIR-Directory</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="0" x="1353" y="23.8872"/><rect fill="#DCDCDC" filter="url(#fmjfwxinl0wcr)" height="2032.3516" style="stroke:#000000;stroke-width:1.0;" width="10" x="328" y="323.875"/><rect fill="#DCDCDC" filter="url(#fmjfwxinl0wcr)" height="291.3125" style="stroke:#000000;stroke-width:1.0;" width="10" x="556" y="723.5234"/><rect fill="#DCDCDC" filter="url(#fmjfwxinl0wcr)" height="350.1016" style="stroke:#000000;stroke-width:1.0;" width="10" x="785" y="723.5234"/><rect fill="#DCDCDC" filter="url(#fmjfwxinl0wcr)" height="33.7891" style="stroke:#000000;stroke-width:1.0;" width="10" x="785" y="1191.2031"/><rect fill="#DCDCDC" filter="url(#fmjfwxinl0wcr)" height="214.7344" style="stroke:#000000;stroke-width:1.0;" width="10" x="1014" y="1632.7656"/><rect fill="#DCDCDC" filter="url(#fmjfwxinl0wcr)" height="214.7344" style="stroke:#000000;stroke-width:1.0;" width="10" x="1014" y="2010.7031"/><rect fill="#DCDCDC" filter="url(#fmjfwxinl0wcr)" height="875.3594" style="stroke:#000000;stroke-width:1.0;" width="10" x="1242" y="521.7891"/><rect fill="#DCDCDC" filter="url(#fmjfwxinl0wcr)" height="80.5781" style="stroke:#000000;stroke-width:1.0;" width="10" x="1477" y="1733.1328"/><rect fill="#DCDCDC" filter="url(#fmjfwxinl0wcr)" height="80.5781" style="stroke:#000000;stroke-width:1.0;" width="10" x="1477" y="2111.0703"/><rect fill="#F0F8FF" filter="url(#fmjfwxinl0wcr)" height="979.9063" style="stroke:#000000;stroke-width:2.0;" width="1472" x="10" y="450.2422"/><rect fill="#FFFFFF" filter="url(#fmjfwxinl0wcr)" height="855.0781" style="stroke:#000000;stroke-width:2.0;" width="1666" x="10" y="1469.1484"/><rect fill="#FFFFFF" filter="url(#fmjfwxinl0wcr)" height="358.7266" style="stroke:#000000;stroke-width:2.0;" width="1406" x="214" y="1521.7734"/><rect fill="#FFFFFF" filter="url(#fmjfwxinl0wcr)" height="338.9375" style="stroke:#000000;stroke-width:2.0;" width="1452" x="214" y="1919.5"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="116" x2="116" y1="134.9297" y2="2366.2266"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="333" x2="333" y1="134.9297" y2="2366.2266"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="561" x2="561" y1="134.9297" y2="2366.2266"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="790" x2="790" y1="134.9297" y2="2366.2266"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1019" x2="1019" y1="134.9297" y2="2366.2266"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1247" x2="1247" y1="134.9297" y2="2366.2266"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1482" x2="1482" y1="134.9297" y2="2366.2266"/><text fill="#000000" font-family="Aapex" font-size="20" lengthAdjust="spacing" textLength="187" x="20" y="106.9316">Akteur in der Rolle</text><text fill="#000000" font-family="Aapex" font-size="20" lengthAdjust="spacing" textLength="110" x="58.5" y="130.2129">Org-Admin</text><ellipse cx="116.5" cy="31.3672" fill="#DCDCDC" filter="url(#fmjfwxinl0wcr)" rx="8" ry="8" style="stroke:#000000;stroke-width:2.0;"/><path d="M116.5,39.3672 L116.5,66.3672 M103.5,47.3672 L129.5,47.3672 M116.5,66.3672 L103.5,81.3672 M116.5,66.3672 L129.5,81.3672 " fill="none" filter="url(#fmjfwxinl0wcr)" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="Aapex" font-size="20" lengthAdjust="spacing" textLength="187" x="20" y="2383.791">Akteur in der Rolle</text><text fill="#000000" font-family="Aapex" font-size="20" lengthAdjust="spacing" textLength="110" x="58.5" y="2407.0723">Org-Admin</text><ellipse cx="116.5" cy="2421.7891" fill="#DCDCDC" filter="url(#fmjfwxinl0wcr)" rx="8" ry="8" style="stroke:#000000;stroke-width:2.0;"/><path d="M116.5,2429.7891 L116.5,2456.7891 M103.5,2437.7891 L129.5,2437.7891 M116.5,2456.7891 L103.5,2471.7891 M116.5,2456.7891 L129.5,2471.7891 " fill="none" filter="url(#fmjfwxinl0wcr)" style="stroke:#000000;stroke-width:2.0;"/><rect fill="#EFEFFF" filter="url(#fmjfwxinl0wcr)" height="83.8438" style="stroke:#000000;stroke-width:1.5;" width="214" x="224" y="46.0859"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="198" x="232" y="71.6504">TI-Messenger-Client</text><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="150" x="256" y="94.9316">mit Org-Admin</text><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="141" x="260.5" y="118.2129">Funktionalität</text><rect fill="#EFEFFF" filter="url(#fmjfwxinl0wcr)" height="83.8438" style="stroke:#000000;stroke-width:1.5;" width="214" x="224" y="2365.2266"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="198" x="232" y="2390.791">TI-Messenger-Client</text><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="150" x="256" y="2414.0723">mit Org-Admin</text><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="141" x="260.5" y="2437.3535">Funktionalität</text><rect fill="#EFEFFF" filter="url(#fmjfwxinl0wcr)" height="60.5625" style="stroke:#000000;stroke-width:1.5;" width="214" x="452" y="69.3672"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="138" x="487" y="94.9316">Authenticator</text><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="145" x="486.5" y="118.2129">des IDP-Dienst</text><rect fill="#EFEFFF" filter="url(#fmjfwxinl0wcr)" height="60.5625" style="stroke:#000000;stroke-width:1.5;" width="214" x="452" y="2365.2266"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="138" x="487" y="2390.791">Authenticator</text><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="145" x="486.5" y="2414.0723">des IDP-Dienst</text><rect fill="#EFEFFF" filter="url(#fmjfwxinl0wcr)" height="37.2813" style="stroke:#000000;stroke-width:1.5;" width="214" x="681" y="92.6484"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="104" x="736" y="118.2129">IDP-Dienst</text><rect fill="#EFEFFF" filter="url(#fmjfwxinl0wcr)" height="37.2813" style="stroke:#000000;stroke-width:1.5;" width="214" x="681" y="2365.2266"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="104" x="736" y="2390.791">IDP-Dienst</text><rect fill="#EFEFFF" filter="url(#fmjfwxinl0wcr)" height="37.2813" style="stroke:#000000;stroke-width:1.5;" width="214" x="910" y="92.6484"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="108" x="963" y="118.2129">FHIR-Proxy</text><rect fill="#EFEFFF" filter="url(#fmjfwxinl0wcr)" height="37.2813" style="stroke:#000000;stroke-width:1.5;" width="214" x="910" y="2365.2266"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="108" x="963" y="2390.791">FHIR-Proxy</text><rect fill="#EFEFFF" filter="url(#fmjfwxinl0wcr)" height="37.2813" style="stroke:#000000;stroke-width:1.5;" width="214" x="1138" y="92.6484"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="128" x="1181" y="118.2129">Auth-Service</text><rect fill="#EFEFFF" filter="url(#fmjfwxinl0wcr)" height="37.2813" style="stroke:#000000;stroke-width:1.5;" width="214" x="1138" y="2365.2266"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="128" x="1181" y="2390.791">Auth-Service</text><rect fill="#EFEFFF" filter="url(#fmjfwxinl0wcr)" height="37.2813" style="stroke:#000000;stroke-width:1.5;" width="214" x="1373" y="92.6484"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="145" x="1407.5" y="118.2129">FHIR-Directory</text><rect fill="#EFEFFF" filter="url(#fmjfwxinl0wcr)" height="37.2813" style="stroke:#000000;stroke-width:1.5;" width="214" x="1373" y="2365.2266"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="145" x="1407.5" y="2390.791">FHIR-Directory</text><rect fill="#DCDCDC" filter="url(#fmjfwxinl0wcr)" height="2032.3516" style="stroke:#000000;stroke-width:1.0;" width="10" x="328" y="323.875"/><rect fill="#DCDCDC" filter="url(#fmjfwxinl0wcr)" height="291.3125" style="stroke:#000000;stroke-width:1.0;" width="10" x="556" y="723.5234"/><rect fill="#DCDCDC" filter="url(#fmjfwxinl0wcr)" height="350.1016" style="stroke:#000000;stroke-width:1.0;" width="10" x="785" y="723.5234"/><rect fill="#DCDCDC" filter="url(#fmjfwxinl0wcr)" height="33.7891" style="stroke:#000000;stroke-width:1.0;" width="10" x="785" y="1191.2031"/><rect fill="#DCDCDC" filter="url(#fmjfwxinl0wcr)" height="214.7344" style="stroke:#000000;stroke-width:1.0;" width="10" x="1014" y="1632.7656"/><rect fill="#DCDCDC" filter="url(#fmjfwxinl0wcr)" height="214.7344" style="stroke:#000000;stroke-width:1.0;" width="10" x="1014" y="2010.7031"/><rect fill="#DCDCDC" filter="url(#fmjfwxinl0wcr)" height="875.3594" style="stroke:#000000;stroke-width:1.0;" width="10" x="1242" y="521.7891"/><rect fill="#DCDCDC" filter="url(#fmjfwxinl0wcr)" height="80.5781" style="stroke:#000000;stroke-width:1.0;" width="10" x="1477" y="1733.1328"/><rect fill="#DCDCDC" filter="url(#fmjfwxinl0wcr)" height="80.5781" style="stroke:#000000;stroke-width:1.0;" width="10" x="1477" y="2111.0703"/><path d="M16,174.9297 L16,223.9297 L890,223.9297 L890,184.9297 L880,174.9297 L16,174.9297 " fill="#FBFB77" filter="url(#fmjfwxinl0wcr)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M880,174.9297 L880,184.9297 L890,184.9297 L880,174.9297 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="607" x="140.5" y="195.7095">Die Organisation hat einen Messenger-Service bereitgestellt bekommen,</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="214" x="140.5" y="215.4985">der Teil der Föderation ist</text><polygon fill="#000000" points="316,319.875,326,323.875,316,327.875,320,323.875" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="116.5" x2="322" y1="323.875" y2="323.875"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="168" x="123.5" y="278.2876">FHIR Ressourcen im</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="166" x="123.5" y="298.0767">VZD-FHIR-Directory</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="160" x="123.5" y="317.8657">hinzufügen (MXID)</text><line style="stroke:#000000;stroke-width:1.0;" x1="338" x2="380" y1="397.2422" y2="397.2422"/><line style="stroke:#000000;stroke-width:1.0;" x1="380" x2="380" y1="397.2422" y2="410.2422"/><line style="stroke:#000000;stroke-width:1.0;" x1="339" x2="380" y1="410.2422" y2="410.2422"/><polygon fill="#000000" points="349,406.2422,339,410.2422,349,414.2422,345,410.2422" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="167" x="345" y="351.6548">Prüfung, ob gültiges</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="159" x="345" y="371.4438">owner-accesstoken</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="64" x="345" y="391.2329">vorliegt</text><path d="M10,450.2422 L74,450.2422 L74,457.2422 L64,467.2422 L10,467.2422 L10,450.2422 " fill="#D3D3D3" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="979.9063" style="stroke:#000000;stroke-width:2.0;" width="1472" x="10" y="450.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="25" y="463.3091">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="5" x="89" y="468.2729">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="305" x="94" y="467.0938">kein gültigess owner-accesstoken</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="5" x="399" y="468.2729">]</text><polygon fill="#000000" points="1230,517.7891,1240,521.7891,1230,525.7891,1234,521.7891" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="338" x2="1236" y1="521.7891" y2="521.7891"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="211" x="345" y="515.7798">GET /owner-authenticate</text><line style="stroke:#000000;stroke-width:1.0;" x1="1252" x2="1294" y1="575.3672" y2="575.3672"/><line style="stroke:#000000;stroke-width:1.0;" x1="1294" x2="1294" y1="575.3672" y2="588.3672"/><line style="stroke:#000000;stroke-width:1.0;" x1="1253" x2="1294" y1="588.3672" y2="588.3672"/><polygon fill="#000000" points="1263,584.3672,1253,588.3672,1263,592.3672,1259,588.3672" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="164" x="1259" y="549.5688">Erzeuge PKCE Code</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="211" x="1259" y="569.3579">für verifier und challenge</text><polygon fill="#000000" points="349,618.1563,339,622.1563,349,626.1563,345,622.1563" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="1241" y1="622.1563" y2="622.1563"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="424" x="811" y="616.147">Redirct to IDP Authorization Endpoint (PKCE Code)</text><polygon fill="#000000" points="127.5,651.9453,117.5,655.9453,127.5,659.9453,123.5,655.9453" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="121.5" x2="327" y1="655.9453" y2="655.9453"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="184" x="137" y="649.936">Liste verfügbarer IDPs</text><polygon fill="#000000" points="316,685.7344,326,689.7344,316,693.7344,320,689.7344" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="116.5" x2="322" y1="689.7344" y2="689.7344"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="148" x="123.5" y="683.7251">ausgewählter IDP</text><polygon fill="#000000" points="773,719.5234,783,723.5234,773,727.5234,777,723.5234" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="338" x2="779" y1="723.5234" y2="723.5234"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="124" x="345" y="717.5142">GET /authorize</text><polygon fill="#000000" points="349,773.1016,339,777.1016,349,781.1016,345,777.1016" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="784" y1="777.1016" y2="777.1016"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="124" x="649" y="751.3032">Authentication</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="80" x="698" y="771.0923">challenge</text><polygon fill="#000000" points="127.5,851.6797,117.5,855.6797,127.5,859.6797,123.5,855.6797" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="121.5" x2="555" y1="855.6797" y2="855.6797"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="141" x="403" y="829.8813">Aufforderung zur</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="146" x="403" y="849.6704">Authentifizierung</text><polygon fill="#000000" points="544,885.4688,554,889.4688,544,893.4688,548,889.4688" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="116.5" x2="550" y1="889.4688" y2="889.4688"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="132" x="123.5" y="883.4595">Eingabe tätigen</text><line style="stroke:#000000;stroke-width:1.0;" x1="566" x2="608" y1="948.2578" y2="948.2578"/><line style="stroke:#000000;stroke-width:1.0;" x1="608" x2="608" y1="948.2578" y2="961.2578"/><line style="stroke:#000000;stroke-width:1.0;" x1="567" x2="608" y1="961.2578" y2="961.2578"/><polygon fill="#000000" points="577,957.2578,567,961.2578,577,965.2578,573,961.2578" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="124" x="573" y="942.2485">Authentication</text><polygon fill="#000000" points="773,1010.8359,783,1014.8359,773,1018.8359,777,1014.8359" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="561" x2="779" y1="1014.8359" y2="1014.8359"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="124" x="568" y="989.0376">Authentication</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="159" x="568" y="1008.8267">challenge response</text><polygon fill="#000000" points="349,1069.625,339,1073.625,349,1077.625,345,1073.625" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="789" y1="1073.625" y2="1073.625"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="405" x="378" y="1067.6157">Authorization Response with Authorization Code</text><polygon fill="#000000" points="1230,1128.4141,1240,1132.4141,1230,1136.4141,1234,1132.4141" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="338" x2="1236" y1="1132.4141" y2="1132.4141"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="526" x="345" y="1126.4048">GET /owner-authenticate with Authorization code (PKCE Code)</text><polygon fill="#000000" points="806,1187.2031,796,1191.2031,806,1195.2031,802,1191.2031" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="800" x2="1241" y1="1191.2031" y2="1191.2031"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="352" x="883" y="1185.1938">POST /tokenEndpoint (authorization code)</text><polygon fill="#000000" points="1230,1220.9922,1240,1224.9922,1230,1228.9922,1234,1224.9922" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="790" x2="1236" y1="1224.9922" y2="1224.9922"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="72" x="797" y="1218.9829">id_token</text><line style="stroke:#000000;stroke-width:1.0;" x1="1252" x2="1294" y1="1258.7813" y2="1258.7813"/><line style="stroke:#000000;stroke-width:1.0;" x1="1294" x2="1294" y1="1258.7813" y2="1271.7813"/><line style="stroke:#000000;stroke-width:1.0;" x1="1253" x2="1294" y1="1271.7813" y2="1271.7813"/><polygon fill="#000000" points="1263,1267.7813,1253,1271.7813,1263,1275.7813,1259,1271.7813" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="121" x="1259" y="1252.772">prüfe id_token</text><line style="stroke:#000000;stroke-width:1.0;" x1="1252" x2="1294" y1="1350.3594" y2="1350.3594"/><line style="stroke:#000000;stroke-width:1.0;" x1="1294" x2="1294" y1="1350.3594" y2="1363.3594"/><line style="stroke:#000000;stroke-width:1.0;" x1="1253" x2="1294" y1="1363.3594" y2="1363.3594"/><polygon fill="#000000" points="1263,1359.3594,1253,1363.3594,1263,1367.3594,1259,1363.3594" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="66" x="1259" y="1324.561">erzeuge</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="159" x="1259" y="1344.3501">owner-accesstoken</text><polygon fill="#000000" points="349,1393.1484,339,1397.1484,349,1401.1484,345,1397.1484" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="1246" y1="1397.1484" y2="1397.1484"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="159" x="1081" y="1391.1392">owner-accesstoken</text><path d="M10,1469.1484 L337,1469.1484 L337,1479.1484 L327,1489.1484 L10,1489.1484 L10,1469.1484 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="855.0781" style="stroke:#000000;stroke-width:2.0;" width="1666" x="10" y="1469.1484"/><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="282" x="25" y="1485">FHIR-Directory Eintrag erstellen</text><path d="M214,1521.7734 L453,1521.7734 L453,1531.7734 L443,1541.7734 L214,1541.7734 L214,1521.7734 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="358.7266" style="stroke:#000000;stroke-width:2.0;" width="1406" x="214" y="1521.7734"/><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="194" x="229" y="1537.625">FHIR-Ressource lesen</text><polygon fill="#000000" points="1002,1628.7656,1012,1632.7656,1002,1636.7656,1006,1632.7656" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="338" x2="1008" y1="1632.7656" y2="1632.7656"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="296" x="345" y="1587.1782">POST /owner/HealthcareService/?...</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="333" x="345" y="1606.9673">Finde Datensatz für eigene TelematikID</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="338" x="345" y="1626.7563">Authorization Bearer owner-accesstoken</text><line style="stroke:#000000;stroke-width:1.0;" x1="1024" x2="1066" y1="1686.3438" y2="1686.3438"/><line style="stroke:#000000;stroke-width:1.0;" x1="1066" x2="1066" y1="1686.3438" y2="1699.3438"/><line style="stroke:#000000;stroke-width:1.0;" x1="1025" x2="1066" y1="1699.3438" y2="1699.3438"/><polygon fill="#000000" points="1035,1695.3438,1025,1699.3438,1035,1703.3438,1031,1699.3438" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="44" x="1031" y="1660.5454">prüfe</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="159" x="1031" y="1680.3345">owner-accesstoken</text><polygon fill="#000000" points="1465,1729.1328,1475,1733.1328,1465,1737.1328,1469,1733.1328" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="1024" x2="1471" y1="1733.1328" y2="1733.1328"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="128" x="1031" y="1727.1235">HTTPS Forward</text><line style="stroke:#000000;stroke-width:1.0;" x1="1487" x2="1529" y1="1766.9219" y2="1766.9219"/><line style="stroke:#000000;stroke-width:1.0;" x1="1529" x2="1529" y1="1766.9219" y2="1779.9219"/><line style="stroke:#000000;stroke-width:1.0;" x1="1488" x2="1529" y1="1779.9219" y2="1779.9219"/><polygon fill="#000000" points="1498,1775.9219,1488,1779.9219,1498,1783.9219,1494,1779.9219" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="114" x="1494" y="1760.9126">suche Eintrag</text><polygon fill="#000000" points="1035,1809.7109,1025,1813.7109,1035,1817.7109,1031,1813.7109" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1029" x2="1481" y1="1813.7109" y2="1813.7109"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="132" x="1343" y="1807.7017">result body json</text><polygon fill="#000000" points="349,1843.5,339,1847.5,349,1851.5,345,1847.5" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="1018" y1="1847.5" y2="1847.5"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="128" x="884" y="1841.4907">HTTPS Forward</text><path d="M214,1919.5 L493,1919.5 L493,1929.5 L483,1939.5 L214,1939.5 L214,1919.5 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="338.9375" style="stroke:#000000;stroke-width:2.0;" width="1452" x="214" y="1919.5"/><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="234" x="229" y="1935.3516">FHIR-Ressource schreiben</text><polygon fill="#000000" points="1002,2006.7031,1012,2010.7031,1002,2014.7031,1006,2010.7031" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="338" x2="1008" y1="2010.7031" y2="2010.7031"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="459" x="345" y="1984.9048">FHIR-Operationen um eigenen Datensatz zu verwalten</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="338" x="345" y="2004.6938">Authorization Bearer owner-accesstoken</text><line style="stroke:#000000;stroke-width:1.0;" x1="1024" x2="1066" y1="2064.2813" y2="2064.2813"/><line style="stroke:#000000;stroke-width:1.0;" x1="1066" x2="1066" y1="2064.2813" y2="2077.2813"/><line style="stroke:#000000;stroke-width:1.0;" x1="1025" x2="1066" y1="2077.2813" y2="2077.2813"/><polygon fill="#000000" points="1035,2073.2813,1025,2077.2813,1035,2081.2813,1031,2077.2813" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="44" x="1031" y="2038.4829">prüfe</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="159" x="1031" y="2058.272">owner-accesstoken</text><polygon fill="#000000" points="1465,2107.0703,1475,2111.0703,1465,2115.0703,1469,2111.0703" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="1024" x2="1471" y1="2111.0703" y2="2111.0703"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="128" x="1031" y="2105.061">HTTPS Forward</text><line style="stroke:#000000;stroke-width:1.0;" x1="1487" x2="1529" y1="2144.8594" y2="2144.8594"/><line style="stroke:#000000;stroke-width:1.0;" x1="1529" x2="1529" y1="2144.8594" y2="2157.8594"/><line style="stroke:#000000;stroke-width:1.0;" x1="1488" x2="1529" y1="2157.8594" y2="2157.8594"/><polygon fill="#000000" points="1498,2153.8594,1488,2157.8594,1498,2161.8594,1494,2157.8594" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="160" x="1494" y="2138.8501">Eintrag hinzufügen</text><polygon fill="#000000" points="1035,2187.6484,1025,2191.6484,1035,2195.6484,1031,2191.6484" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1029" x2="1481" y1="2191.6484" y2="2191.6484"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="132" x="1343" y="2185.6392">result body json</text><polygon fill="#000000" points="349,2221.4375,339,2225.4375,349,2229.4375,345,2225.4375" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="1018" y1="2225.4375" y2="2225.4375"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="128" x="884" y="2219.4282">HTTPS Forward</text><polygon fill="#000000" points="127.5,2287.2266,117.5,2291.2266,127.5,2295.2266,123.5,2291.2266" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="121.5" x2="327" y1="2291.2266" y2="2291.2266"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="51" x="270" y="2285.2173">status</text><!--MD5=[7cfed03ba677acfa7b0d510824b1abb0]
@startuml
skinparam sequenceMessageAlign direction
skinparam minClassWidth 200
skinparam BoxPadding 1
skinparam sequenceReferenceHeaderBackgroundColor palegreen
scale max 2048 width

skinparam sequence {
ArrowColor black
ArrowFontSize 17
ActorBorderColor black
LifeLineBorderColor black
LifeLineBackgroundColor Gainsboro

ParticipantBorderColor Motivation
ParticipantBackgroundColor Motivation
ParticipantFontName Impact
ParticipantFontSize 20
ParticipantFontColor black
ParticipantBorderColor Black
ParticipantBackgroundColor MOTIVATION

ActorBackgroundColor Gainsboro
ActorFontColor black
ActorFontSize 20
ActorFontName Aapex
}
    actor U as "Akteur in der Rolle\nOrg-Admin"
    box <size:18>Endgerät</size>\n #WhiteSmoke 
    participant C as "TI-Messenger-Client\n mit Org-Admin \nFunktionalität"
    participant A as "Authenticator \ndes IDP-Dienst"
    end box
    participant I as "IDP-Dienst" 
    box <size:18>VZD-FHIR-Directory</size> #WhiteSmoke
      participant FP as "FHIR-Proxy"
      participant Auth as "Auth-Service"
      participant VZD as "FHIR-Directory"
    end box

|||
note over U, I: <size:17>Die Organisation hat einen Messenger-Service bereitgestellt bekommen, \n<size:17>der Teil der Föderation ist</size>
|||

U->C: FHIR Ressourcen im \nVZD-FHIR-Directory \nhinzufügen (MXID)
  Activate C
C->C: Prüfung, ob gültiges \nowner-accesstoken \nvorliegt

|||
alt#LightGrey #AliceBlue <size:16>kein gültigess owner-accesstoken</size>
|||

  C->Auth: GET /owner-authenticate
    Activate Auth
  Auth->Auth: Erzeuge PKCE Code \nfür verifier und challenge
  Auth- ->C: Redirct to IDP Authorization Endpoint (PKCE Code)

  C->U: Liste verfügbarer IDPs
  U->C: ausgewählter IDP
    
  C->I: GET /authorize
    Activate A
    Activate I
  I- ->C: Authentication \nchallenge
  |||
  A->U: Aufforderung zur \nAuthentifizierung
  U->A: Eingabe tätigen
  |||
  A->A: Authentication
  A->I: Authentication \nchallenge response
    Deactivate A
  |||
  I- ->C: Authorization Response with Authorization Code
    Deactivate I
      
  |||    
  C->Auth: GET /owner-authenticate with Authorization code (PKCE Code)
  |||
  Auth- ->I: POST /tokenEndpoint (authorization code)
    Activate I
  I- ->Auth: id_token
    Deactivate I
  Auth->Auth: prüfe id_token
  |||
  Auth->Auth: erzeuge \nowner-accesstoken
  Auth- ->C: owner-accesstoken
  ||| 
    
    Deactivate Auth
end
      
|||

group <size:16>FHIR-Directory Eintrag erstellen</size>
  |||
  group <size:16>FHIR-Ressource lesen</size>
  |||
  C->FP: POST /owner/HealthcareService/?... \nFinde Datensatz für eigene TelematikID \nAuthorization Bearer owner-accesstoken
    Activate FP
  FP->FP: prüfe \nowner-accesstoken
  FP->VZD: HTTPS Forward
    Activate VZD
  VZD->VZD: suche Eintrag
  VZD- ->FP: result body json
    Deactivate VZD
  FP- ->C: HTTPS Forward
    Deactivate FP
  |||
  end

  |||
  group <size:16>FHIR-Ressource schreiben</size>
  |||
  C->FP: FHIR-Operationen um eigenen Datensatz zu verwalten \nAuthorization Bearer owner-accesstoken
    Activate FP
  FP->FP: prüfe \nowner-accesstoken
  FP->VZD: HTTPS Forward
    Activate VZD
  VZD->VZD: Eintrag hinzufügen
  VZD- ->FP: result body json
    Deactivate VZD
  FP- ->C: HTTPS Forward
     Deactivate FP
  |||
  end
  C- ->U: status    
  |||
end
|||

  Deactivate C
@enduml

PlantUML version 1.2021.16(Wed Dec 08 17:25:22 UTC 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>