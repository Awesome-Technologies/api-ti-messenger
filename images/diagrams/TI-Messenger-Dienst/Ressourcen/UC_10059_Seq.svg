<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="2473px" preserveAspectRatio="none" style="width:1664px;height:2473px;background:#FFFFFF;" version="1.1" viewBox="0 0 1664 2473" width="1664px" zoomAndPan="magnify"><defs/><g><rect fill="#F5F5F5" height="2461.7891" style="stroke:#181818;stroke-width:0.5;" width="446" x="220" y="6"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="93" x="396.5" y="22.708">Endgerät</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="5" x="396.5" y="39.02"> </text><rect fill="#F5F5F5" height="2461.7891" style="stroke:#181818;stroke-width:0.5;" width="681" x="894" y="6"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="200" x="1132" y="22.708">VZD-FHIR-Directory</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="5" x="1332" y="23.8872"> </text><rect fill="#DCDCDC" height="2032.3516" style="stroke:#000000;stroke-width:1.0;" width="10" x="326" y="315.875"/><rect fill="#DCDCDC" height="291.3125" style="stroke:#000000;stroke-width:1.0;" width="10" x="550" y="715.5234"/><rect fill="#DCDCDC" height="350.1016" style="stroke:#000000;stroke-width:1.0;" width="10" x="775" y="715.5234"/><rect fill="#DCDCDC" height="33.7891" style="stroke:#000000;stroke-width:1.0;" width="10" x="775" y="1183.2031"/><rect fill="#DCDCDC" height="214.7344" style="stroke:#000000;stroke-width:1.0;" width="10" x="1000" y="1624.7656"/><rect fill="#DCDCDC" height="214.7344" style="stroke:#000000;stroke-width:1.0;" width="10" x="1000" y="2002.7031"/><rect fill="#DCDCDC" height="875.3594" style="stroke:#000000;stroke-width:1.0;" width="10" x="1224" y="513.7891"/><rect fill="#DCDCDC" height="80.5781" style="stroke:#000000;stroke-width:1.0;" width="10" x="1459" y="1725.1328"/><rect fill="#DCDCDC" height="80.5781" style="stroke:#000000;stroke-width:1.0;" width="10" x="1459" y="2103.0703"/><rect fill="#F0F8FF" height="979.9063" style="stroke:#000000;stroke-width:1.5;" width="1454" x="10" y="442.2422"/><rect height="855.0781" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1648" x="10" y="1461.1484"/><rect height="358.7266" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1388" x="214" y="1513.7734"/><rect height="338.9375" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1434" x="214" y="1911.5"/><line style="stroke:#000000;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="116" x2="116" y1="130.9297" y2="2358.2266"/><line style="stroke:#000000;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="331" x2="331" y1="130.9297" y2="2358.2266"/><line style="stroke:#000000;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="555" x2="555" y1="130.9297" y2="2358.2266"/><line style="stroke:#000000;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="780" x2="780" y1="130.9297" y2="2358.2266"/><line style="stroke:#000000;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1005" x2="1005" y1="130.9297" y2="2358.2266"/><line style="stroke:#000000;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1229" x2="1229" y1="130.9297" y2="2358.2266"/><line style="stroke:#000000;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1464" x2="1464" y1="130.9297" y2="2358.2266"/><text fill="#000000" font-family="Aapex" font-size="20" lengthAdjust="spacing" textLength="187" x="20" y="102.9316">Akteur in der Rolle</text><text fill="#000000" font-family="Aapex" font-size="20" lengthAdjust="spacing" textLength="110" x="58.5" y="126.2129">Org-Admin</text><ellipse cx="116.5" cy="32.8672" fill="#DCDCDC" rx="8" ry="8" style="stroke:#000000;stroke-width:0.5;"/><path d="M116.5,40.8672 L116.5,67.8672 M103.5,48.8672 L129.5,48.8672 M116.5,67.8672 L103.5,82.8672 M116.5,67.8672 L129.5,82.8672 " fill="none" style="stroke:#000000;stroke-width:0.5;"/><text fill="#000000" font-family="Aapex" font-size="20" lengthAdjust="spacing" textLength="187" x="20" y="2375.791">Akteur in der Rolle</text><text fill="#000000" font-family="Aapex" font-size="20" lengthAdjust="spacing" textLength="110" x="58.5" y="2399.0723">Org-Admin</text><ellipse cx="116.5" cy="2412.2891" fill="#DCDCDC" rx="8" ry="8" style="stroke:#000000;stroke-width:0.5;"/><path d="M116.5,2420.2891 L116.5,2447.2891 M103.5,2428.2891 L129.5,2428.2891 M116.5,2447.2891 L103.5,2462.2891 M116.5,2447.2891 L129.5,2462.2891 " fill="none" style="stroke:#000000;stroke-width:0.5;"/><rect fill="#EFEFFF" height="83.8438" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="224" y="46.0859"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="198" x="232" y="71.6504">TI-Messenger-Client</text><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="150" x="256" y="94.9316">mit Org-Admin</text><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="141" x="260.5" y="118.2129">Funktionalität</text><rect fill="#EFEFFF" height="83.8438" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="224" y="2357.2266"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="198" x="232" y="2382.791">TI-Messenger-Client</text><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="150" x="256" y="2406.0723">mit Org-Admin</text><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="141" x="260.5" y="2429.3535">Funktionalität</text><rect fill="#EFEFFF" height="60.5625" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="448" y="69.3672"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="138" x="483" y="94.9316">Authenticator</text><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="145" x="482.5" y="118.2129">des IDP-Dienst</text><rect fill="#EFEFFF" height="60.5625" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="448" y="2357.2266"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="138" x="483" y="2382.791">Authenticator</text><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="145" x="482.5" y="2406.0723">des IDP-Dienst</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="673" y="92.6484"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="104" x="728" y="118.2129">IDP-Dienst</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="673" y="2357.2266"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="104" x="728" y="2382.791">IDP-Dienst</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="898" y="92.6484"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="108" x="951" y="118.2129">FHIR-Proxy</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="898" y="2357.2266"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="108" x="951" y="2382.791">FHIR-Proxy</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1122" y="92.6484"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="128" x="1165" y="118.2129">Auth-Service</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1122" y="2357.2266"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="128" x="1165" y="2382.791">Auth-Service</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1357" y="92.6484"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="145" x="1391.5" y="118.2129">FHIR-Directory</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1357" y="2357.2266"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="145" x="1391.5" y="2382.791">FHIR-Directory</text><rect fill="#DCDCDC" height="2032.3516" style="stroke:#000000;stroke-width:1.0;" width="10" x="326" y="315.875"/><rect fill="#DCDCDC" height="291.3125" style="stroke:#000000;stroke-width:1.0;" width="10" x="550" y="715.5234"/><rect fill="#DCDCDC" height="350.1016" style="stroke:#000000;stroke-width:1.0;" width="10" x="775" y="715.5234"/><rect fill="#DCDCDC" height="33.7891" style="stroke:#000000;stroke-width:1.0;" width="10" x="775" y="1183.2031"/><rect fill="#DCDCDC" height="214.7344" style="stroke:#000000;stroke-width:1.0;" width="10" x="1000" y="1624.7656"/><rect fill="#DCDCDC" height="214.7344" style="stroke:#000000;stroke-width:1.0;" width="10" x="1000" y="2002.7031"/><rect fill="#DCDCDC" height="875.3594" style="stroke:#000000;stroke-width:1.0;" width="10" x="1224" y="513.7891"/><rect fill="#DCDCDC" height="80.5781" style="stroke:#000000;stroke-width:1.0;" width="10" x="1459" y="1725.1328"/><rect fill="#DCDCDC" height="80.5781" style="stroke:#000000;stroke-width:1.0;" width="10" x="1459" y="2103.0703"/><path d="M17,170.9297 L17,219.9297 L879,219.9297 L879,180.9297 L869,170.9297 L17,170.9297 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M869,170.9297 L869,180.9297 L879,180.9297 L869,170.9297 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="607" x="137.5" y="191.7095">Die Organisation hat einen Messenger-Service bereitgestellt bekommen,</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="214" x="137.5" y="211.4985">der Teil der Föderation ist</text><polygon fill="#000000" points="314,311.875,324,315.875,314,319.875,318,315.875" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="116.5" x2="320" y1="315.875" y2="315.875"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="168" x="123.5" y="270.2876">FHIR Ressourcen im</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="166" x="123.5" y="290.0767">VZD-FHIR-Directory</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="160" x="123.5" y="309.8657">hinzufügen (MXID)</text><line style="stroke:#000000;stroke-width:1.0;" x1="336" x2="378" y1="389.2422" y2="389.2422"/><line style="stroke:#000000;stroke-width:1.0;" x1="378" x2="378" y1="389.2422" y2="402.2422"/><line style="stroke:#000000;stroke-width:1.0;" x1="337" x2="378" y1="402.2422" y2="402.2422"/><polygon fill="#000000" points="347,398.2422,337,402.2422,347,406.2422,343,402.2422" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="167" x="343" y="343.6548">Prüfung, ob gültiges</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="159" x="343" y="363.4438">owner-accesstoken</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="64" x="343" y="383.2329">vorliegt</text><path d="M10,442.2422 L74,442.2422 L74,449.375 L64,459.375 L10,459.375 L10,442.2422 " fill="#D3D3D3" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="979.9063" style="stroke:#000000;stroke-width:1.5;" width="1454" x="10" y="442.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="25" y="455.3091">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="5" x="89" y="460.2729">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="305" x="94" y="459.0938">kein gültigess owner-accesstoken</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="5" x="399" y="460.2729">]</text><polygon fill="#000000" points="1212,509.7891,1222,513.7891,1212,517.7891,1216,513.7891" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="336" x2="1218" y1="513.7891" y2="513.7891"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="211" x="343" y="507.7798">GET /owner-authenticate</text><line style="stroke:#000000;stroke-width:1.0;" x1="1234" x2="1276" y1="567.3672" y2="567.3672"/><line style="stroke:#000000;stroke-width:1.0;" x1="1276" x2="1276" y1="567.3672" y2="580.3672"/><line style="stroke:#000000;stroke-width:1.0;" x1="1235" x2="1276" y1="580.3672" y2="580.3672"/><polygon fill="#000000" points="1245,576.3672,1235,580.3672,1245,584.3672,1241,580.3672" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="164" x="1241" y="541.5688">Erzeuge PKCE Code</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="211" x="1241" y="561.3579">für verifier und challenge</text><polygon fill="#000000" points="347,610.1563,337,614.1563,347,618.1563,343,614.1563" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="341" x2="1223" y1="614.1563" y2="614.1563"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="424" x="793" y="608.147">Redirct to IDP Authorization Endpoint (PKCE Code)</text><polygon fill="#000000" points="127.5,643.9453,117.5,647.9453,127.5,651.9453,123.5,647.9453" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="121.5" x2="325" y1="647.9453" y2="647.9453"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="184" x="135" y="641.936">Liste verfügbarer IDPs</text><polygon fill="#000000" points="314,677.7344,324,681.7344,314,685.7344,318,681.7344" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="116.5" x2="320" y1="681.7344" y2="681.7344"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="148" x="123.5" y="675.7251">ausgewählter IDP</text><polygon fill="#000000" points="763,711.5234,773,715.5234,763,719.5234,767,715.5234" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="336" x2="769" y1="715.5234" y2="715.5234"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="124" x="343" y="709.5142">GET /authorize</text><polygon fill="#000000" points="347,765.1016,337,769.1016,347,773.1016,343,769.1016" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="341" x2="774" y1="769.1016" y2="769.1016"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="124" x="639" y="743.3032">Authentication</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="80" x="639" y="763.0923">challenge</text><polygon fill="#000000" points="127.5,843.6797,117.5,847.6797,127.5,851.6797,123.5,847.6797" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="121.5" x2="549" y1="847.6797" y2="847.6797"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="141" x="397" y="821.8813">Aufforderung zur</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="146" x="397" y="841.6704">Authentifizierung</text><polygon fill="#000000" points="538,877.4688,548,881.4688,538,885.4688,542,881.4688" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="116.5" x2="544" y1="881.4688" y2="881.4688"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="132" x="123.5" y="875.4595">Eingabe tätigen</text><line style="stroke:#000000;stroke-width:1.0;" x1="560" x2="602" y1="940.2578" y2="940.2578"/><line style="stroke:#000000;stroke-width:1.0;" x1="602" x2="602" y1="940.2578" y2="953.2578"/><line style="stroke:#000000;stroke-width:1.0;" x1="561" x2="602" y1="953.2578" y2="953.2578"/><polygon fill="#000000" points="571,949.2578,561,953.2578,571,957.2578,567,953.2578" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="124" x="567" y="934.2485">Authentication</text><polygon fill="#000000" points="763,1002.8359,773,1006.8359,763,1010.8359,767,1006.8359" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="555" x2="769" y1="1006.8359" y2="1006.8359"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="124" x="562" y="981.0376">Authentication</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="159" x="562" y="1000.8267">challenge response</text><polygon fill="#000000" points="347,1061.625,337,1065.625,347,1069.625,343,1065.625" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="341" x2="779" y1="1065.625" y2="1065.625"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="405" x="368" y="1059.6157">Authorization Response with Authorization Code</text><polygon fill="#000000" points="1212,1120.4141,1222,1124.4141,1212,1128.4141,1216,1124.4141" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="336" x2="1218" y1="1124.4141" y2="1124.4141"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="526" x="343" y="1118.4048">GET /owner-authenticate with Authorization code (PKCE Code)</text><polygon fill="#000000" points="796,1179.2031,786,1183.2031,796,1187.2031,792,1183.2031" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="790" x2="1223" y1="1183.2031" y2="1183.2031"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="352" x="865" y="1177.1938">POST /tokenEndpoint (authorization code)</text><polygon fill="#000000" points="1212,1212.9922,1222,1216.9922,1212,1220.9922,1216,1216.9922" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="780" x2="1218" y1="1216.9922" y2="1216.9922"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="72" x="787" y="1210.9829">id_token</text><line style="stroke:#000000;stroke-width:1.0;" x1="1234" x2="1276" y1="1250.7813" y2="1250.7813"/><line style="stroke:#000000;stroke-width:1.0;" x1="1276" x2="1276" y1="1250.7813" y2="1263.7813"/><line style="stroke:#000000;stroke-width:1.0;" x1="1235" x2="1276" y1="1263.7813" y2="1263.7813"/><polygon fill="#000000" points="1245,1259.7813,1235,1263.7813,1245,1267.7813,1241,1263.7813" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="121" x="1241" y="1244.772">prüfe id_token</text><line style="stroke:#000000;stroke-width:1.0;" x1="1234" x2="1276" y1="1342.3594" y2="1342.3594"/><line style="stroke:#000000;stroke-width:1.0;" x1="1276" x2="1276" y1="1342.3594" y2="1355.3594"/><line style="stroke:#000000;stroke-width:1.0;" x1="1235" x2="1276" y1="1355.3594" y2="1355.3594"/><polygon fill="#000000" points="1245,1351.3594,1235,1355.3594,1245,1359.3594,1241,1355.3594" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="66" x="1241" y="1316.561">erzeuge</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="159" x="1241" y="1336.3501">owner-accesstoken</text><polygon fill="#000000" points="347,1385.1484,337,1389.1484,347,1393.1484,343,1389.1484" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="341" x2="1228" y1="1389.1484" y2="1389.1484"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="159" x="1063" y="1383.1392">owner-accesstoken</text><path d="M10,1461.1484 L337,1461.1484 L337,1471.7734 L327,1481.7734 L10,1481.7734 L10,1461.1484 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="855.0781" style="stroke:#000000;stroke-width:1.5;" width="1648" x="10" y="1461.1484"/><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="282" x="25" y="1477">FHIR-Directory Eintrag erstellen</text><path d="M214,1513.7734 L453,1513.7734 L453,1524.3984 L443,1534.3984 L214,1534.3984 L214,1513.7734 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="358.7266" style="stroke:#000000;stroke-width:1.5;" width="1388" x="214" y="1513.7734"/><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="194" x="229" y="1529.625">FHIR-Ressource lesen</text><polygon fill="#000000" points="988,1620.7656,998,1624.7656,988,1628.7656,992,1624.7656" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="336" x2="994" y1="1624.7656" y2="1624.7656"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="296" x="343" y="1579.1782">POST /owner/HealthcareService/?...</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="333" x="343" y="1598.9673">Finde Datensatz für eigene TelematikID</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="338" x="343" y="1618.7563">Authorization Bearer owner-accesstoken</text><line style="stroke:#000000;stroke-width:1.0;" x1="1010" x2="1052" y1="1678.3438" y2="1678.3438"/><line style="stroke:#000000;stroke-width:1.0;" x1="1052" x2="1052" y1="1678.3438" y2="1691.3438"/><line style="stroke:#000000;stroke-width:1.0;" x1="1011" x2="1052" y1="1691.3438" y2="1691.3438"/><polygon fill="#000000" points="1021,1687.3438,1011,1691.3438,1021,1695.3438,1017,1691.3438" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="44" x="1017" y="1652.5454">prüfe</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="159" x="1017" y="1672.3345">owner-accesstoken</text><polygon fill="#000000" points="1447,1721.1328,1457,1725.1328,1447,1729.1328,1451,1725.1328" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="1010" x2="1453" y1="1725.1328" y2="1725.1328"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="128" x="1017" y="1719.1235">HTTPS Forward</text><line style="stroke:#000000;stroke-width:1.0;" x1="1469" x2="1511" y1="1758.9219" y2="1758.9219"/><line style="stroke:#000000;stroke-width:1.0;" x1="1511" x2="1511" y1="1758.9219" y2="1771.9219"/><line style="stroke:#000000;stroke-width:1.0;" x1="1470" x2="1511" y1="1771.9219" y2="1771.9219"/><polygon fill="#000000" points="1480,1767.9219,1470,1771.9219,1480,1775.9219,1476,1771.9219" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="114" x="1476" y="1752.9126">suche Eintrag</text><polygon fill="#000000" points="1021,1801.7109,1011,1805.7109,1021,1809.7109,1017,1805.7109" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1015" x2="1463" y1="1805.7109" y2="1805.7109"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="132" x="1325" y="1799.7017">result body json</text><polygon fill="#000000" points="347,1835.5,337,1839.5,347,1843.5,343,1839.5" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="341" x2="1004" y1="1839.5" y2="1839.5"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="128" x="870" y="1833.4907">HTTPS Forward</text><path d="M214,1911.5 L493,1911.5 L493,1922.125 L483,1932.125 L214,1932.125 L214,1911.5 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="338.9375" style="stroke:#000000;stroke-width:1.5;" width="1434" x="214" y="1911.5"/><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="234" x="229" y="1927.3516">FHIR-Ressource schreiben</text><polygon fill="#000000" points="988,1998.7031,998,2002.7031,988,2006.7031,992,2002.7031" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="336" x2="994" y1="2002.7031" y2="2002.7031"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="459" x="343" y="1976.9048">FHIR-Operationen um eigenen Datensatz zu verwalten</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="338" x="343" y="1996.6938">Authorization Bearer owner-accesstoken</text><line style="stroke:#000000;stroke-width:1.0;" x1="1010" x2="1052" y1="2056.2813" y2="2056.2813"/><line style="stroke:#000000;stroke-width:1.0;" x1="1052" x2="1052" y1="2056.2813" y2="2069.2813"/><line style="stroke:#000000;stroke-width:1.0;" x1="1011" x2="1052" y1="2069.2813" y2="2069.2813"/><polygon fill="#000000" points="1021,2065.2813,1011,2069.2813,1021,2073.2813,1017,2069.2813" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="44" x="1017" y="2030.4829">prüfe</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="159" x="1017" y="2050.272">owner-accesstoken</text><polygon fill="#000000" points="1447,2099.0703,1457,2103.0703,1447,2107.0703,1451,2103.0703" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="1010" x2="1453" y1="2103.0703" y2="2103.0703"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="128" x="1017" y="2097.061">HTTPS Forward</text><line style="stroke:#000000;stroke-width:1.0;" x1="1469" x2="1511" y1="2136.8594" y2="2136.8594"/><line style="stroke:#000000;stroke-width:1.0;" x1="1511" x2="1511" y1="2136.8594" y2="2149.8594"/><line style="stroke:#000000;stroke-width:1.0;" x1="1470" x2="1511" y1="2149.8594" y2="2149.8594"/><polygon fill="#000000" points="1480,2145.8594,1470,2149.8594,1480,2153.8594,1476,2149.8594" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="160" x="1476" y="2130.8501">Eintrag hinzufügen</text><polygon fill="#000000" points="1021,2179.6484,1011,2183.6484,1021,2187.6484,1017,2183.6484" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1015" x2="1463" y1="2183.6484" y2="2183.6484"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="132" x="1325" y="2177.6392">result body json</text><polygon fill="#000000" points="347,2213.4375,337,2217.4375,347,2221.4375,343,2217.4375" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="341" x2="1004" y1="2217.4375" y2="2217.4375"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="128" x="870" y="2211.4282">HTTPS Forward</text><polygon fill="#000000" points="127.5,2279.2266,117.5,2283.2266,127.5,2287.2266,123.5,2283.2266" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="121.5" x2="325" y1="2283.2266" y2="2283.2266"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="51" x="268" y="2277.2173">status</text><!--MD5=[b4d8dd3cd0f084366f4814017d6b1031]
@startuml
skinparam sequenceMessageAlign direction
skinparam minClassWidth 200
skinparam BoxPadding 1
skinparam sequenceReferenceHeaderBackgroundColor palegreen
scale max 2048 width

skinparam sequence {
ArrowColor black
ArrowFontSize 17
ActorBorderColor black
LifeLineBorderColor black
LifeLineBackgroundColor Gainsboro

ParticipantBorderColor Motivation
ParticipantBackgroundColor Motivation
ParticipantFontName Impact
ParticipantFontSize 20
ParticipantFontColor black
ParticipantBorderColor Black
ParticipantBackgroundColor MOTIVATION

ActorBackgroundColor Gainsboro
ActorFontColor black
ActorFontSize 20
ActorFontName Aapex
}
    actor U as "Akteur in der Rolle\nOrg-Admin"
    box <size:18>Endgerät</size>\n #WhiteSmoke 
    participant C as "TI-Messenger-Client\n mit Org-Admin \nFunktionalität"
    participant A as "Authenticator \ndes IDP-Dienst"
    end box
    participant I as "IDP-Dienst" 
    box <size:18>VZD-FHIR-Directory</size> #WhiteSmoke
      participant FP as "FHIR-Proxy"
      participant Auth as "Auth-Service"
      participant VZD as "FHIR-Directory"
    end box

|||
note over U, I: <size:17>Die Organisation hat einen Messenger-Service bereitgestellt bekommen, \n<size:17>der Teil der Föderation ist</size>
|||

U->C: FHIR Ressourcen im \nVZD-FHIR-Directory \nhinzufügen (MXID)
  Activate C
C->C: Prüfung, ob gültiges \nowner-accesstoken \nvorliegt

|||
alt#LightGrey #AliceBlue <size:16>kein gültigess owner-accesstoken</size>
|||

  C->Auth: GET /owner-authenticate
    Activate Auth
  Auth->Auth: Erzeuge PKCE Code \nfür verifier und challenge
  Auth- ->C: Redirct to IDP Authorization Endpoint (PKCE Code)

  C->U: Liste verfügbarer IDPs
  U->C: ausgewählter IDP
    
  C->I: GET /authorize
    Activate A
    Activate I
  I- ->C: Authentication \nchallenge
  |||
  A->U: Aufforderung zur \nAuthentifizierung
  U->A: Eingabe tätigen
  |||
  A->A: Authentication
  A->I: Authentication \nchallenge response
    Deactivate A
  |||
  I- ->C: Authorization Response with Authorization Code
    Deactivate I
      
  |||    
  C->Auth: GET /owner-authenticate with Authorization code (PKCE Code)
  |||
  Auth- ->I: POST /tokenEndpoint (authorization code)
    Activate I
  I- ->Auth: id_token
    Deactivate I
  Auth->Auth: prüfe id_token
  |||
  Auth->Auth: erzeuge \nowner-accesstoken
  Auth- ->C: owner-accesstoken
  ||| 
    
    Deactivate Auth
end
      
|||

group <size:16>FHIR-Directory Eintrag erstellen</size>
  |||
  group <size:16>FHIR-Ressource lesen</size>
  |||
  C->FP: POST /owner/HealthcareService/?... \nFinde Datensatz für eigene TelematikID \nAuthorization Bearer owner-accesstoken
    Activate FP
  FP->FP: prüfe \nowner-accesstoken
  FP->VZD: HTTPS Forward
    Activate VZD
  VZD->VZD: suche Eintrag
  VZD- ->FP: result body json
    Deactivate VZD
  FP- ->C: HTTPS Forward
    Deactivate FP
  |||
  end

  |||
  group <size:16>FHIR-Ressource schreiben</size>
  |||
  C->FP: FHIR-Operationen um eigenen Datensatz zu verwalten \nAuthorization Bearer owner-accesstoken
    Activate FP
  FP->FP: prüfe \nowner-accesstoken
  FP->VZD: HTTPS Forward
    Activate VZD
  VZD->VZD: Eintrag hinzufügen
  VZD- ->FP: result body json
    Deactivate VZD
  FP- ->C: HTTPS Forward
     Deactivate FP
  |||
  end
  C- ->U: status    
  |||
end
|||

  Deactivate C
@enduml

PlantUML version 1.2022.5(Sat Apr 30 10:55:52 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>