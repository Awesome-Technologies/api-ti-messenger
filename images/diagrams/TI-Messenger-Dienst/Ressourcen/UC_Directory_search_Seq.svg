<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2687.9694px" preserveAspectRatio="none" style="width:2048px;height:2687px;background:#FFFFFF;" version="1.1" viewBox="0 0 2048 2687" width="2048.4889px" zoomAndPan="magnify"><defs><filter height="300%" id="f1quv9c89kyd4n" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="1.9555979947481499"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="3.9111959894962998" dy="3.9111959894962998" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#F5F5F5" height="2676.2511" style="stroke:#A80036;stroke-width:0.9777989973740749;" width="962.1542" x="984.1547" y="5.8668"/><text fill="#000000" font-family="sans-serif" font-size="17.6004" font-weight="bold" lengthAdjust="spacing" textLength="195.5598" x="1365.0074" y="22.2039">VZD-FHIR-Directory</text><text fill="#000000" font-family="sans-serif" font-size="12.7114" font-weight="bold" lengthAdjust="spacing" textLength="0" x="1565.4562" y="23.3569"/><rect fill="#DCDCDC" filter="url(#f1quv9c89kyd4n)" height="2400.3896" style="stroke:#000000;stroke-width:0.9777989973740749;" width="9.778" x="334.8962" y="125.7083"/><rect fill="#DCDCDC" filter="url(#f1quv9c89kyd4n)" height="123.5617" style="stroke:#000000;stroke-width:0.9777989973740749;" width="9.778" x="619.4357" y="523.7947"/><rect fill="#DCDCDC" filter="url(#f1quv9c89kyd4n)" height="144.867" style="stroke:#000000;stroke-width:0.9777989973740749;" width="9.778" x="619.4357" y="1117.9451"/><rect fill="#DCDCDC" filter="url(#f1quv9c89kyd4n)" height="57.4839" style="stroke:#000000;stroke-width:0.9777989973740749;" width="9.778" x="842.3738" y="556.8336"/><rect fill="#DCDCDC" filter="url(#f1quv9c89kyd4n)" height="78.7892" style="stroke:#000000;stroke-width:0.9777989973740749;" width="9.778" x="842.3738" y="1150.984"/><rect fill="#DCDCDC" filter="url(#f1quv9c89kyd4n)" height="1069.5288" style="stroke:#000000;stroke-width:0.9777989973740749;" width="9.778" x="1089.757" y="1456.5691"/><rect fill="#DCDCDC" filter="url(#f1quv9c89kyd4n)" height="98.1389" style="stroke:#000000;stroke-width:0.9777989973740749;" width="9.778" x="1382.1189" y="2394.92"/><rect fill="#DCDCDC" filter="url(#f1quv9c89kyd4n)" height="656.1108" style="stroke:#000000;stroke-width:0.9777989973740749;" width="9.778" x="1605.0571" y="704.8403"/><rect fill="#DCDCDC" filter="url(#f1quv9c89kyd4n)" height="33.0389" style="stroke:#000000;stroke-width:0.9777989973740749;" width="9.778" x="1830.9286" y="1771.0995"/><rect fill="#DCDCDC" filter="url(#f1quv9c89kyd4n)" height="117.4887" style="stroke:#000000;stroke-width:0.9777989973740749;" width="9.778" x="1830.9286" y="1944.4984"/><rect fill="#F0F8FF" filter="url(#f1quv9c89kyd4n)" height="965.5765" style="stroke:#000000;stroke-width:1.9555979947481499;" width="1826.0396" x="9.778" y="434.4865"/><rect fill="#ADD8E6" filter="url(#f1quv9c89kyd4n)" height="545.4667" style="stroke:#000000;stroke-width:1.9555979947481499;" width="1804.528" x="19.556" y="847.7517"/><rect fill="#ADD8E6" height="345.1019" style="stroke:none;stroke-width:0.9777989973740749;" width="1804.528" x="19.556" y="1048.1165"/><rect fill="#FFE4E1" filter="url(#f1quv9c89kyd4n)" height="77.7809" style="stroke:#000000;stroke-width:1.9555979947481499;" width="987.577" x="223.4271" y="1565.8763"/><rect fill="#F0F8FF" filter="url(#f1quv9c89kyd4n)" height="154.6145" style="stroke:#000000;stroke-width:1.9555979947481499;" width="973.8878" x="978.2879" y="1681.7914"/><rect fill="#F0F8FF" filter="url(#f1quv9c89kyd4n)" height="219.7145" style="stroke:#000000;stroke-width:1.9555979947481499;" width="1057.0007" x="978.2879" y="1874.54"/><rect fill="#FFE4E1" filter="url(#f1quv9c89kyd4n)" height="97.1306" style="stroke:#000000;stroke-width:1.9555979947481499;" width="987.577" x="223.4271" y="2221.9336"/><line style="stroke:#000000;stroke-width:0.9777989973740749;stroke-dasharray:5.0,5.0;" x1="123.2027" x2="123.2027" y1="115.9303" y2="2568.1432"/><line style="stroke:#000000;stroke-width:0.9777989973740749;stroke-dasharray:5.0,5.0;" x1="339.7852" x2="339.7852" y1="115.9303" y2="2568.1432"/><line style="stroke:#000000;stroke-width:0.9777989973740749;stroke-dasharray:5.0,5.0;" x1="624.3247" x2="624.3247" y1="115.9303" y2="2568.1432"/><line style="stroke:#000000;stroke-width:0.9777989973740749;stroke-dasharray:5.0,5.0;" x1="847.2628" x2="847.2628" y1="115.9303" y2="2568.1432"/><line style="stroke:#000000;stroke-width:0.9777989973740749;stroke-dasharray:5.0,5.0;" x1="1094.646" x2="1094.646" y1="115.9303" y2="2568.1432"/><line style="stroke:#000000;stroke-width:0.9777989973740749;stroke-dasharray:5.0,5.0;" x1="1387.0079" x2="1387.0079" y1="115.9303" y2="2568.1432"/><line style="stroke:#000000;stroke-width:0.9777989973740749;stroke-dasharray:5.0,5.0;" x1="1609.946" x2="1609.946" y1="115.9303" y2="2568.1432"/><line style="stroke:#000000;stroke-width:0.9777989973740749;stroke-dasharray:5.0,5.0;" x1="1835.8176" x2="1835.8176" y1="115.9303" y2="2568.1432"/><text fill="#000000" font-family="Aapex" font-size="19.556" lengthAdjust="spacing" textLength="182.8484" x="29.334" y="88.5538">Akteur in der Rolle</text><text fill="#000000" font-family="Aapex" font-size="19.556" lengthAdjust="spacing" textLength="155.47" x="43.0232" y="111.3182">User / User-HBA</text><ellipse cx="123.6916" cy="14.667" fill="#DCDCDC" filter="url(#f1quv9c89kyd4n)" rx="7.8224" ry="7.8224" style="stroke:#000000;stroke-width:1.9555979947481499;"/><path d="M123.6916,22.4894 L123.6916,48.8899 M110.9802,30.3118 L136.403,30.3118 M123.6916,48.8899 L110.9802,63.5569 M123.6916,48.8899 L136.403,63.5569 " fill="none" filter="url(#f1quv9c89kyd4n)" style="stroke:#000000;stroke-width:1.9555979947481499;"/><text fill="#000000" font-family="Aapex" font-size="19.556" lengthAdjust="spacing" textLength="182.8484" x="29.334" y="2585.3177">Akteur in der Rolle</text><text fill="#000000" font-family="Aapex" font-size="19.556" lengthAdjust="spacing" textLength="155.47" x="43.0232" y="2608.0821">User / User-HBA</text><ellipse cx="123.6916" cy="2622.4722" fill="#DCDCDC" filter="url(#f1quv9c89kyd4n)" rx="7.8224" ry="7.8224" style="stroke:#000000;stroke-width:1.9555979947481499;"/><path d="M123.6916,2630.2946 L123.6916,2656.6952 M110.9802,2638.117 L136.403,2638.117 M123.6916,2656.6952 L110.9802,2671.3621 M123.6916,2656.6952 L136.403,2671.3621 " fill="none" filter="url(#f1quv9c89kyd4n)" style="stroke:#000000;stroke-width:1.9555979947481499;"/><rect fill="#EFEFFF" filter="url(#f1quv9c89kyd4n)" height="36.4536" style="stroke:#000000;stroke-width:1.4666984960611125;" width="209.249" x="233.2051" y="74.5877"/><text fill="#000000" font-family="Impact" font-size="19.556" lengthAdjust="spacing" textLength="193.6042" x="241.0275" y="99.5846">TI-Messenger-Client</text><rect fill="#EFEFFF" filter="url(#f1quv9c89kyd4n)" height="36.4536" style="stroke:#000000;stroke-width:1.4666984960611125;" width="209.249" x="233.2051" y="2567.1654"/><text fill="#000000" font-family="Impact" font-size="19.556" lengthAdjust="spacing" textLength="193.6042" x="241.0275" y="2592.1623">TI-Messenger-Client</text><rect fill="#EFEFFF" filter="url(#f1quv9c89kyd4n)" height="36.4536" style="stroke:#000000;stroke-width:1.4666984960611125;" width="209.249" x="517.7446" y="74.5877"/><text fill="#000000" font-family="Impact" font-size="19.556" lengthAdjust="spacing" textLength="163.2924" x="540.7228" y="99.5846">Messenger Proxy</text><rect fill="#EFEFFF" filter="url(#f1quv9c89kyd4n)" height="36.4536" style="stroke:#000000;stroke-width:1.4666984960611125;" width="209.249" x="517.7446" y="2567.1654"/><text fill="#000000" font-family="Impact" font-size="19.556" lengthAdjust="spacing" textLength="163.2924" x="540.7228" y="2592.1623">Messenger Proxy</text><rect fill="#EFEFFF" filter="url(#f1quv9c89kyd4n)" height="36.4536" style="stroke:#000000;stroke-width:1.4666984960611125;" width="209.249" x="740.6827" y="74.5877"/><text fill="#000000" font-family="Impact" font-size="19.556" lengthAdjust="spacing" textLength="184.804" x="752.9052" y="99.5846">Matrix-Homeserver</text><rect fill="#EFEFFF" filter="url(#f1quv9c89kyd4n)" height="36.4536" style="stroke:#000000;stroke-width:1.4666984960611125;" width="209.249" x="740.6827" y="2567.1654"/><text fill="#000000" font-family="Impact" font-size="19.556" lengthAdjust="spacing" textLength="184.804" x="752.9052" y="2592.1623">Matrix-Homeserver</text><rect fill="#EFEFFF" filter="url(#f1quv9c89kyd4n)" height="36.4536" style="stroke:#000000;stroke-width:1.4666984960611125;" width="209.249" x="988.0659" y="74.5877"/><text fill="#000000" font-family="Impact" font-size="19.556" lengthAdjust="spacing" textLength="105.6023" x="1039.8892" y="99.5846">FHIR-Proxy</text><rect fill="#EFEFFF" filter="url(#f1quv9c89kyd4n)" height="36.4536" style="stroke:#000000;stroke-width:1.4666984960611125;" width="209.249" x="988.0659" y="2567.1654"/><text fill="#000000" font-family="Impact" font-size="19.556" lengthAdjust="spacing" textLength="105.6023" x="1039.8892" y="2592.1623">FHIR-Proxy</text><rect fill="#EFEFFF" filter="url(#f1quv9c89kyd4n)" height="59.218" style="stroke:#000000;stroke-width:1.4666984960611125;" width="209.249" x="1280.4278" y="51.8233"/><text fill="#000000" font-family="Impact" font-size="19.556" lengthAdjust="spacing" textLength="101.6911" x="1334.2067" y="76.8202">PASSporT-</text><text fill="#000000" font-family="Impact" font-size="19.556" lengthAdjust="spacing" textLength="71.3793" x="1349.3626" y="99.5846">Service</text><rect fill="#EFEFFF" filter="url(#f1quv9c89kyd4n)" height="59.218" style="stroke:#000000;stroke-width:1.4666984960611125;" width="209.249" x="1280.4278" y="2567.1654"/><text fill="#000000" font-family="Impact" font-size="19.556" lengthAdjust="spacing" textLength="101.6911" x="1334.2067" y="2592.1623">PASSporT-</text><text fill="#000000" font-family="Impact" font-size="19.556" lengthAdjust="spacing" textLength="71.3793" x="1349.3626" y="2614.9267">Service</text><rect fill="#EFEFFF" filter="url(#f1quv9c89kyd4n)" height="36.4536" style="stroke:#000000;stroke-width:1.4666984960611125;" width="209.249" x="1503.366" y="74.5877"/><text fill="#000000" font-family="Impact" font-size="19.556" lengthAdjust="spacing" textLength="125.1583" x="1545.4113" y="99.5846">Auth-Service</text><rect fill="#EFEFFF" filter="url(#f1quv9c89kyd4n)" height="36.4536" style="stroke:#000000;stroke-width:1.4666984960611125;" width="209.249" x="1503.366" y="2567.1654"/><text fill="#000000" font-family="Impact" font-size="19.556" lengthAdjust="spacing" textLength="125.1583" x="1545.4113" y="2592.1623">Auth-Service</text><rect fill="#EFEFFF" filter="url(#f1quv9c89kyd4n)" height="36.4536" style="stroke:#000000;stroke-width:1.4666984960611125;" width="209.249" x="1729.2375" y="74.5877"/><text fill="#000000" font-family="Impact" font-size="19.556" lengthAdjust="spacing" textLength="141.7809" x="1762.9716" y="99.5846">FHIR-Directory</text><rect fill="#EFEFFF" filter="url(#f1quv9c89kyd4n)" height="36.4536" style="stroke:#000000;stroke-width:1.4666984960611125;" width="209.249" x="1729.2375" y="2567.1654"/><text fill="#000000" font-family="Impact" font-size="19.556" lengthAdjust="spacing" textLength="141.7809" x="1762.9716" y="2592.1623">FHIR-Directory</text><rect fill="#DCDCDC" filter="url(#f1quv9c89kyd4n)" height="2400.3896" style="stroke:#000000;stroke-width:0.9777989973740749;" width="9.778" x="334.8962" y="125.7083"/><rect fill="#DCDCDC" filter="url(#f1quv9c89kyd4n)" height="123.5617" style="stroke:#000000;stroke-width:0.9777989973740749;" width="9.778" x="619.4357" y="523.7947"/><rect fill="#DCDCDC" filter="url(#f1quv9c89kyd4n)" height="144.867" style="stroke:#000000;stroke-width:0.9777989973740749;" width="9.778" x="619.4357" y="1117.9451"/><rect fill="#DCDCDC" filter="url(#f1quv9c89kyd4n)" height="57.4839" style="stroke:#000000;stroke-width:0.9777989973740749;" width="9.778" x="842.3738" y="556.8336"/><rect fill="#DCDCDC" filter="url(#f1quv9c89kyd4n)" height="78.7892" style="stroke:#000000;stroke-width:0.9777989973740749;" width="9.778" x="842.3738" y="1150.984"/><rect fill="#DCDCDC" filter="url(#f1quv9c89kyd4n)" height="1069.5288" style="stroke:#000000;stroke-width:0.9777989973740749;" width="9.778" x="1089.757" y="1456.5691"/><rect fill="#DCDCDC" filter="url(#f1quv9c89kyd4n)" height="98.1389" style="stroke:#000000;stroke-width:0.9777989973740749;" width="9.778" x="1382.1189" y="2394.92"/><rect fill="#DCDCDC" filter="url(#f1quv9c89kyd4n)" height="656.1108" style="stroke:#000000;stroke-width:0.9777989973740749;" width="9.778" x="1605.0571" y="704.8403"/><rect fill="#DCDCDC" filter="url(#f1quv9c89kyd4n)" height="33.0389" style="stroke:#000000;stroke-width:0.9777989973740749;" width="9.778" x="1830.9286" y="1771.0995"/><rect fill="#DCDCDC" filter="url(#f1quv9c89kyd4n)" height="117.4887" style="stroke:#000000;stroke-width:0.9777989973740749;" width="9.778" x="1830.9286" y="1944.4984"/><path d="M25.4228,155.0423 L25.4228,213.7102 L944.5538,213.7102 L944.5538,164.8202 L934.7758,155.0423 L25.4228,155.0423 " fill="#FBFB77" filter="url(#f1quv9c89kyd4n)" style="stroke:#A80036;stroke-width:0.9777989973740749;"/><path d="M934.7758,155.0423 L934.7758,164.8202 L944.5538,164.8202 L934.7758,155.0423 " fill="#FBFB77" style="stroke:#A80036;stroke-width:0.9777989973740749;"/><text fill="#000000" font-family="sans-serif" font-size="12.7114" lengthAdjust="spacing" textLength="0" x="227.0938" y="171.7302"/><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="511.3889" x="223.1826" y="190.1576">Der Akteur ist erfolgreich beim Messenger-Service angemeldet</text><text fill="#000000" font-family="sans-serif" font-size="12.7114" lengthAdjust="spacing" textLength="0" x="227.0938" y="205.8768"/><polygon fill="#000000" points="323.1626,307.0136,332.9406,310.9248,323.1626,314.836,327.0738,310.9248" style="stroke:#000000;stroke-width:0.9777989973740749;"/><line style="stroke:#000000;stroke-width:0.9777989973740749;" x1="123.6916" x2="329.0294" y1="310.9248" y2="310.9248"/><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="154.4922" x="130.5362" y="266.3495">Suchparameter für</text><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="138.8475" x="130.5362" y="285.6992">FHIR-Ressourcen</text><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="75.2905" x="135.4252" y="305.0489">eingeben</text><line style="stroke:#000000;stroke-width:0.9777989973740749;" x1="344.6741" x2="385.7417" y1="382.6632" y2="382.6632"/><line style="stroke:#000000;stroke-width:0.9777989973740749;" x1="385.7417" x2="385.7417" y1="382.6632" y2="395.3746"/><line style="stroke:#000000;stroke-width:0.9777989973740749;" x1="345.6519" x2="385.7417" y1="395.3746" y2="395.3746"/><polygon fill="#000000" points="355.4299,391.4634,345.6519,395.3746,355.4299,399.2857,351.5187,395.3746" style="stroke:#000000;stroke-width:0.9777989973740749;"/><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="180.8928" x="351.5187" y="338.0878">prüfe ob noch gültiges</text><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="190.6708" x="351.5187" y="357.4376">tim-search-accesstoken</text><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="62.5791" x="351.5187" y="376.7873">vorliegt</text><path d="M9.778,434.4865 L72.3571,434.4865 L72.3571,441.3311 L62.5791,451.1091 L9.778,451.1091 L9.778,434.4865 " fill="#D3D3D3" style="stroke:#000000;stroke-width:0.9777989973740749;"/><rect fill="none" height="965.5765" style="stroke:#000000;stroke-width:1.9555979947481499;" width="1826.0396" x="9.778" y="434.4865"/><text fill="#000000" font-family="sans-serif" font-size="12.7114" font-weight="bold" lengthAdjust="spacing" textLength="18.5782" x="24.445" y="447.2633">alt</text><text fill="#000000" font-family="sans-serif" font-size="10.7558" font-weight="bold" lengthAdjust="spacing" textLength="4.889" x="87.0241" y="452.117">[</text><text fill="#000000" font-family="sans-serif" font-size="15.6448" font-weight="bold" lengthAdjust="spacing" textLength="424.3648" x="91.9131" y="450.964">kein gültiges tim-search-accesstoken vorhanden</text><text fill="#000000" font-family="sans-serif" font-size="10.7558" font-weight="bold" lengthAdjust="spacing" textLength="4.889" x="516.2779" y="452.117">]</text><polygon fill="#000000" points="607.7021,519.8835,617.4801,523.7947,607.7021,527.7059,611.6133,523.7947" style="stroke:#000000;stroke-width:0.9777989973740749;"/><line style="stroke:#000000;stroke-width:0.9777989973740749;" x1="344.6741" x2="613.5689" y1="523.7947" y2="523.7947"/><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="205.3378" x="351.5187" y="498.5691">GET /_matrix/client/user/</text><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="256.1833" x="351.5187" y="517.9188">{userId}/openid/request_token</text><polygon fill="#000000" points="830.6402,552.9224,840.4182,556.8336,830.6402,560.7448,834.5514,556.8336" style="stroke:#000000;stroke-width:0.9777989973740749;"/><line style="stroke:#000000;stroke-width:0.9777989973740749;" x1="629.2137" x2="836.507" y1="556.8336" y2="556.8336"/><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="114.4025" x="636.0582" y="550.9577">HTTP Forward</text><polygon fill="#000000" points="639.9694,610.4063,630.1915,614.3175,639.9694,618.2287,636.0582,614.3175" style="stroke:#000000;stroke-width:0.9777989973740749;"/><line style="stroke:#000000;stroke-width:0.9777989973740749;stroke-dasharray:2.0,2.0;" x1="634.1026" x2="846.285" y1="614.3175" y2="614.3175"/><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="176.0038" x="664.4144" y="608.4416">Matrix-OpenID-Token</text><polygon fill="#000000" points="355.4299,643.4452,345.6519,647.3564,355.4299,651.2676,351.5187,647.3564" style="stroke:#000000;stroke-width:0.9777989973740749;"/><line style="stroke:#000000;stroke-width:0.9777989973740749;stroke-dasharray:2.0,2.0;" x1="349.5631" x2="623.3469" y1="647.3564" y2="647.3564"/><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="138.8475" x="478.6326" y="641.4805">HTTP(S) Forward</text><polygon fill="#000000" points="1593.3235,700.9291,1603.1015,704.8403,1593.3235,708.7515,1597.2347,704.8403" style="stroke:#000000;stroke-width:0.9777989973740749;"/><line style="stroke:#000000;stroke-width:0.9777989973740749;" x1="344.6741" x2="1599.1903" y1="704.8403" y2="704.8403"/><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="532.9005" x="351.5187" y="698.9644">GET /tim-authenticate... (Auth Header mit Matrix-OpenID-Token)</text><line style="stroke:#000000;stroke-width:0.9777989973740749;" x1="1614.835" x2="1655.9026" y1="795.9284" y2="795.9284"/><line style="stroke:#000000;stroke-width:0.9777989973740749;" x1="1655.9026" x2="1655.9026" y1="795.9284" y2="808.6398"/><line style="stroke:#000000;stroke-width:0.9777989973740749;" x1="1615.8128" x2="1655.9026" y1="808.6398" y2="808.6398"/><polygon fill="#000000" points="1625.5908,804.7286,1615.8128,808.6398,1625.5908,812.551,1621.6796,808.6398" style="stroke:#000000;stroke-width:0.9777989973740749;"/><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="67.4681" x="1621.6796" y="732.0033">Prüfe ob</text><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="197.5154" x="1621.6796" y="751.3531">Matrix-Domain aus dem</text><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="196.5376" x="1621.6796" y="770.7028">Matrix-OpenID-Token in</text><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="197.5154" x="1621.6796" y="790.0525">Föderation enthalten ist</text><path d="M19.556,847.7517 L82.1351,847.7517 L82.1351,854.5963 L72.3571,864.3743 L19.556,864.3743 L19.556,847.7517 " fill="#D3D3D3" style="stroke:#000000;stroke-width:0.9777989973740749;"/><rect fill="none" height="545.4667" style="stroke:#000000;stroke-width:1.9555979947481499;" width="1804.528" x="19.556" y="847.7517"/><text fill="#000000" font-family="sans-serif" font-size="12.7114" font-weight="bold" lengthAdjust="spacing" textLength="18.5782" x="34.223" y="860.5285">alt</text><text fill="#000000" font-family="sans-serif" font-size="10.7558" font-weight="bold" lengthAdjust="spacing" textLength="4.889" x="96.8021" y="865.3822">[</text><text fill="#000000" font-family="sans-serif" font-size="15.6448" font-weight="bold" lengthAdjust="spacing" textLength="417.5202" x="101.6911" y="864.2292">Matrix-Domain nicht in der Föderation enthalten</text><text fill="#000000" font-family="sans-serif" font-size="10.7558" font-weight="bold" lengthAdjust="spacing" textLength="4.889" x="519.2113" y="865.3822">]</text><polygon fill="#000000" points="355.4299,933.1487,345.6519,937.0599,355.4299,940.9711,351.5187,937.0599" style="stroke:#000000;stroke-width:0.9777989973740749;"/><line style="stroke:#000000;stroke-width:0.9777989973740749;stroke-dasharray:2.0,2.0;" x1="349.5631" x2="1604.0793" y1="937.0599" y2="937.0599"/><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="79.2017" x="1514.1217" y="911.8343">HTTP 401</text><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="110.4913" x="1487.7212" y="931.1841">Unauthorized</text><line style="stroke:#000000;stroke-width:0.9777989973740749;" x1="344.6741" x2="385.7417" y1="970.0988" y2="970.0988"/><line style="stroke:#000000;stroke-width:0.9777989973740749;" x1="385.7417" x2="385.7417" y1="970.0988" y2="982.8102"/><line style="stroke:#000000;stroke-width:0.9777989973740749;" x1="345.6519" x2="385.7417" y1="982.8102" y2="982.8102"/><polygon fill="#000000" points="355.4299,978.899,345.6519,982.8102,355.4299,986.7214,351.5187,982.8102" style="stroke:#000000;stroke-width:0.9777989973740749;"/><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="136.8919" x="351.5187" y="964.223">Session beenden</text><polygon fill="#000000" points="134.4474,1011.9379,124.6694,1015.8491,134.4474,1019.7603,130.5362,1015.8491" style="stroke:#000000;stroke-width:0.9777989973740749;"/><line style="stroke:#000000;stroke-width:0.9777989973740749;stroke-dasharray:2.0,2.0;" x1="128.5806" x2="333.9184" y1="1015.8491" y2="1015.8491"/><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="187.7374" x="140.3142" y="1009.9733">Suche nicht erfolgreich</text><line style="stroke:#000000;stroke-width:0.9777989973740749;stroke-dasharray:2.0,2.0;" x1="19.556" x2="1824.084" y1="1049.0943" y2="1049.0943"/><text fill="#000000" font-family="sans-serif" font-size="10.7558" font-weight="bold" lengthAdjust="spacing" textLength="4.889" x="24.445" y="1064.7692">[</text><text fill="#000000" font-family="sans-serif" font-size="15.6448" font-weight="bold" lengthAdjust="spacing" textLength="417.5202" x="29.334" y="1063.6161">matrix_server_name in der Föderation enthalten</text><text fill="#000000" font-family="sans-serif" font-size="10.7558" font-weight="bold" lengthAdjust="spacing" textLength="4.889" x="446.8541" y="1064.7692">]</text><polygon fill="#000000" points="639.9694,1114.0339,630.1915,1117.9451,639.9694,1121.8563,636.0582,1117.9451" style="stroke:#000000;stroke-width:0.9777989973740749;"/><line style="stroke:#000000;stroke-width:0.9777989973740749;" x1="634.1026" x2="1604.0793" y1="1117.9451" y2="1117.9451"/><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="368.6302" x="1229.5822" y="1112.0692">GET /openid/userinfo/?Matrix-OpenID-Token)</text><polygon fill="#000000" points="830.6402,1147.0728,840.4182,1150.984,830.6402,1154.8952,834.5514,1150.984" style="stroke:#000000;stroke-width:0.9777989973740749;"/><line style="stroke:#000000;stroke-width:0.9777989973740749;" x1="629.2137" x2="836.507" y1="1150.984" y2="1150.984"/><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="138.8475" x="636.0582" y="1145.1081">HTTP(S) Forward</text><line style="stroke:#000000;stroke-width:0.9777989973740749;" x1="852.1518" x2="893.2194" y1="1184.0229" y2="1184.0229"/><line style="stroke:#000000;stroke-width:0.9777989973740749;" x1="893.2194" x2="893.2194" y1="1184.0229" y2="1196.7343"/><line style="stroke:#000000;stroke-width:0.9777989973740749;" x1="853.1296" x2="893.2194" y1="1196.7343" y2="1196.7343"/><polygon fill="#000000" points="862.9076,1192.8231,853.1296,1196.7343,862.9076,1200.6455,858.9964,1196.7343" style="stroke:#000000;stroke-width:0.9777989973740749;"/><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="223.916" x="858.9964" y="1178.1471">prüfe Matrix-OpenID-Token</text><polygon fill="#000000" points="639.9694,1225.862,630.1915,1229.7732,639.9694,1233.6844,636.0582,1229.7732" style="stroke:#000000;stroke-width:0.9777989973740749;"/><line style="stroke:#000000;stroke-width:0.9777989973740749;stroke-dasharray:2.0,2.0;" x1="634.1026" x2="846.285" y1="1229.7732" y2="1229.7732"/><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="145.6921" x="694.7262" y="1223.8974">MXID des Nutzers</text><polygon fill="#000000" points="1593.3235,1258.9009,1603.1015,1262.8121,1593.3235,1266.7233,1597.2347,1262.8121" style="stroke:#000000;stroke-width:0.9777989973740749;"/><line style="stroke:#000000;stroke-width:0.9777989973740749;stroke-dasharray:2.0,2.0;" x1="624.3247" x2="1599.1903" y1="1262.8121" y2="1262.8121"/><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="138.8475" x="631.1693" y="1256.9363">HTTP(S) Forward</text><line style="stroke:#000000;stroke-width:0.9777989973740749;" x1="1614.835" x2="1655.9026" y1="1315.2008" y2="1315.2008"/><line style="stroke:#000000;stroke-width:0.9777989973740749;" x1="1655.9026" x2="1655.9026" y1="1315.2008" y2="1327.9122"/><line style="stroke:#000000;stroke-width:0.9777989973740749;" x1="1615.8128" x2="1655.9026" y1="1327.9122" y2="1327.9122"/><polygon fill="#000000" points="1625.5908,1324.001,1615.8128,1327.9122,1625.5908,1331.8233,1621.6796,1327.9122" style="stroke:#000000;stroke-width:0.9777989973740749;"/><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="64.5347" x="1621.6796" y="1289.9752">erzeuge</text><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="190.6708" x="1621.6796" y="1309.3249">tim-search-accesstoken</text><polygon fill="#000000" points="355.4299,1357.0399,345.6519,1360.9511,355.4299,1364.8623,351.5187,1360.9511" style="stroke:#000000;stroke-width:0.9777989973740749;"/><line style="stroke:#000000;stroke-width:0.9777989973740749;stroke-dasharray:2.0,2.0;" x1="349.5631" x2="1608.9683" y1="1360.9511" y2="1360.9511"/><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="433.165" x="1169.9365" y="1355.0752">tim-search-accesstoken (inklusive MXID des Nutzers)</text><polygon fill="#000000" points="1078.0234,1452.6579,1087.8014,1456.5691,1078.0234,1460.4803,1081.9346,1456.5691" style="stroke:#000000;stroke-width:0.9777989973740749;"/><line style="stroke:#000000;stroke-width:0.9777989973740749;" x1="344.6741" x2="1083.8902" y1="1456.5691" y2="1456.5691"/><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="595.4796" x="351.5187" y="1450.6932">GET /tim-search?... (Auth Header mit tim-search-accesstoken inkl. MXID)</text><line style="stroke:#000000;stroke-width:0.9777989973740749;" x1="1099.535" x2="1140.6025" y1="1514.053" y2="1514.053"/><line style="stroke:#000000;stroke-width:0.9777989973740749;" x1="1140.6025" x2="1140.6025" y1="1514.053" y2="1526.7644"/><line style="stroke:#000000;stroke-width:0.9777989973740749;" x1="1100.5128" x2="1140.6025" y1="1526.7644" y2="1526.7644"/><polygon fill="#000000" points="1110.2908,1522.8532,1100.5128,1526.7644,1110.2908,1530.6756,1106.3796,1526.7644" style="stroke:#000000;stroke-width:0.9777989973740749;"/><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="238.583" x="1106.3796" y="1508.1771">prüfe tim-search-accesstoken</text><path d="M223.4271,1565.8763 L291.873,1565.8763 L291.873,1572.7209 L282.095,1582.4989 L223.4271,1582.4989 L223.4271,1565.8763 " fill="#D3D3D3" style="stroke:#000000;stroke-width:0.9777989973740749;"/><rect fill="none" height="77.7809" style="stroke:#000000;stroke-width:1.9555979947481499;" width="987.577" x="223.4271" y="1565.8763"/><text fill="#000000" font-family="sans-serif" font-size="12.7114" font-weight="bold" lengthAdjust="spacing" textLength="24.445" x="238.0941" y="1578.6531">opt</text><text fill="#000000" font-family="sans-serif" font-size="10.7558" font-weight="bold" lengthAdjust="spacing" textLength="4.889" x="306.54" y="1583.5068">[</text><text fill="#000000" font-family="sans-serif" font-size="15.6448" font-weight="bold" lengthAdjust="spacing" textLength="72.3571" x="311.429" y="1582.3538">Abbruch</text><text fill="#000000" font-family="sans-serif" font-size="10.7558" font-weight="bold" lengthAdjust="spacing" textLength="4.889" x="383.7861" y="1583.5068">]</text><polygon fill="#000000" points="355.4299,1607.4786,345.6519,1611.3898,355.4299,1615.301,351.5187,1611.3898" style="stroke:#000000;stroke-width:0.9777989973740749;"/><line style="stroke:#000000;stroke-width:0.9777989973740749;stroke-dasharray:2.0,2.0;" x1="349.5631" x2="1088.7792" y1="1611.3898" y2="1611.3898"/><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="300.1843" x="782.7281" y="1605.514">kein gültiges tim-search-accesstoken</text><path d="M978.2879,1681.7914 L1040.867,1681.7914 L1040.867,1688.636 L1031.089,1698.4139 L978.2879,1698.4139 L978.2879,1681.7914 " fill="#D3D3D3" style="stroke:#000000;stroke-width:0.9777989973740749;"/><rect fill="none" height="154.6145" style="stroke:#000000;stroke-width:1.9555979947481499;" width="973.8878" x="978.2879" y="1681.7914"/><text fill="#000000" font-family="sans-serif" font-size="12.7114" font-weight="bold" lengthAdjust="spacing" textLength="18.5782" x="992.9549" y="1694.5682">alt</text><text fill="#000000" font-family="sans-serif" font-size="10.7558" font-weight="bold" lengthAdjust="spacing" textLength="4.889" x="1055.534" y="1699.4218">[</text><text fill="#000000" font-family="sans-serif" font-size="15.6448" font-weight="bold" lengthAdjust="spacing" textLength="382.3194" x="1060.423" y="1698.2688">HealthcareService-Einträge werden gesucht</text><text fill="#000000" font-family="sans-serif" font-size="10.7558" font-weight="bold" lengthAdjust="spacing" textLength="4.889" x="1442.7424" y="1699.4218">]</text><polygon fill="#000000" points="1819.195,1767.1884,1828.973,1771.0995,1819.195,1775.0107,1823.1062,1771.0995" style="stroke:#000000;stroke-width:0.9777989973740749;"/><line style="stroke:#000000;stroke-width:0.9777989973740749;" x1="1099.535" x2="1825.0618" y1="1771.0995" y2="1771.0995"/><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="309.9623" x="1106.3796" y="1745.874">POST /tim-search/HealthcareService/?</text><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="265.9613" x="1106.3796" y="1765.2237">Finde Datensatz für TelematikID</text><polygon fill="#000000" points="1110.2908,1800.2273,1100.5128,1804.1385,1110.2908,1808.0497,1106.3796,1804.1385" style="stroke:#000000;stroke-width:0.9777989973740749;"/><line style="stroke:#000000;stroke-width:0.9777989973740749;stroke-dasharray:2.0,2.0;" x1="1104.424" x2="1834.8398" y1="1804.1385" y2="1804.1385"/><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="135.9141" x="1693.059" y="1798.2626">Result Body json</text><path d="M978.2879,1874.54 L1040.867,1874.54 L1040.867,1881.3846 L1031.089,1891.1626 L978.2879,1891.1626 L978.2879,1874.54 " fill="#D3D3D3" style="stroke:#000000;stroke-width:0.9777989973740749;"/><rect fill="none" height="219.7145" style="stroke:#000000;stroke-width:1.9555979947481499;" width="1057.0007" x="978.2879" y="1874.54"/><text fill="#000000" font-family="sans-serif" font-size="12.7114" font-weight="bold" lengthAdjust="spacing" textLength="18.5782" x="992.9549" y="1887.3168">alt</text><text fill="#000000" font-family="sans-serif" font-size="10.7558" font-weight="bold" lengthAdjust="spacing" textLength="4.889" x="1055.534" y="1892.1704">[</text><text fill="#000000" font-family="sans-serif" font-size="15.6448" font-weight="bold" lengthAdjust="spacing" textLength="365.6968" x="1060.423" y="1891.0174">PractitionerRole-Einträge werden gesucht</text><text fill="#000000" font-family="sans-serif" font-size="10.7558" font-weight="bold" lengthAdjust="spacing" textLength="4.889" x="1426.1198" y="1892.1704">]</text><polygon fill="#000000" points="1819.195,1940.5873,1828.973,1944.4984,1819.195,1948.4096,1823.1062,1944.4984" style="stroke:#000000;stroke-width:0.9777989973740749;"/><line style="stroke:#000000;stroke-width:0.9777989973740749;" x1="1099.535" x2="1825.0618" y1="1944.4984" y2="1944.4984"/><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="593.524" x="1106.3796" y="1938.6226">POST /tim-search/PractitionerRole/? ...&lt;MXID des anfragenden Nutzers&gt;</text><line style="stroke:#000000;stroke-width:0.9777989973740749;" x1="1840.7066" x2="1881.7742" y1="2016.2368" y2="2016.2368"/><line style="stroke:#000000;stroke-width:0.9777989973740749;" x1="1881.7742" x2="1881.7742" y1="2016.2368" y2="2028.9482"/><line style="stroke:#000000;stroke-width:0.9777989973740749;" x1="1841.6844" x2="1881.7742" y1="2028.9482" y2="2028.9482"/><polygon fill="#000000" points="1851.4624,2025.037,1841.6844,2028.9482,1851.4624,2032.8594,1847.5512,2028.9482" style="stroke:#000000;stroke-width:0.9777989973740749;"/><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="171.1148" x="1847.5512" y="1971.6615">Prüfung, ob MXID im</text><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="154.4922" x="1847.5512" y="1991.0112">TIEndpoint-Eintrag</text><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="112.4469" x="1847.5512" y="2010.3609">vorhanden ist</text><polygon fill="#000000" points="1110.2908,2058.0759,1100.5128,2061.9871,1110.2908,2065.8983,1106.3796,2061.9871" style="stroke:#000000;stroke-width:0.9777989973740749;"/><line style="stroke:#000000;stroke-width:0.9777989973740749;stroke-dasharray:2.0,2.0;" x1="1104.424" x2="1834.8398" y1="2061.9871" y2="2061.9871"/><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="350.052" x="1478.921" y="2056.1112">Result Body json mit TIPractitioner-Eintrag</text><line style="stroke:#000000;stroke-width:0.9777989973740749;" x1="1099.535" x2="1140.6025" y1="2170.1103" y2="2170.1103"/><line style="stroke:#000000;stroke-width:0.9777989973740749;" x1="1140.6025" x2="1140.6025" y1="2170.1103" y2="2182.8217"/><line style="stroke:#000000;stroke-width:0.9777989973740749;" x1="1100.5128" x2="1140.6025" y1="2182.8217" y2="2182.8217"/><polygon fill="#000000" points="1110.2908,2178.9105,1100.5128,2182.8217,1110.2908,2186.7329,1106.3796,2182.8217" style="stroke:#000000;stroke-width:0.9777989973740749;"/><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="167.2036" x="1106.3796" y="2144.8847">MXID enthalten und</text><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="229.7828" x="1106.3796" y="2164.2344">TIEndpoint.status == active</text><path d="M223.4271,2221.9336 L291.873,2221.9336 L291.873,2228.7782 L282.095,2238.5562 L223.4271,2238.5562 L223.4271,2221.9336 " fill="#D3D3D3" style="stroke:#000000;stroke-width:0.9777989973740749;"/><rect fill="none" height="97.1306" style="stroke:#000000;stroke-width:1.9555979947481499;" width="987.577" x="223.4271" y="2221.9336"/><text fill="#000000" font-family="sans-serif" font-size="12.7114" font-weight="bold" lengthAdjust="spacing" textLength="24.445" x="238.0941" y="2234.7104">opt</text><text fill="#000000" font-family="sans-serif" font-size="10.7558" font-weight="bold" lengthAdjust="spacing" textLength="4.889" x="306.54" y="2239.5641">[</text><text fill="#000000" font-family="sans-serif" font-size="15.6448" font-weight="bold" lengthAdjust="spacing" textLength="72.3571" x="311.429" y="2238.4111">Abbruch</text><text fill="#000000" font-family="sans-serif" font-size="10.7558" font-weight="bold" lengthAdjust="spacing" textLength="4.889" x="383.7861" y="2239.5641">]</text><polygon fill="#000000" points="355.4299,2282.8857,345.6519,2286.7968,355.4299,2290.708,351.5187,2286.7968" style="stroke:#000000;stroke-width:0.9777989973740749;"/><line style="stroke:#000000;stroke-width:0.9777989973740749;stroke-dasharray:2.0,2.0;" x1="349.5631" x2="1088.7792" y1="2286.7968" y2="2286.7968"/><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="268.8947" x="809.1287" y="2261.5713">kein passender Eintrag gefunden</text><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="260.0945" x="822.8179" y="2280.921">oder TIEndpoint.status == false</text><polygon fill="#000000" points="1370.3853,2391.0088,1380.1633,2394.92,1370.3853,2398.8312,1374.2965,2394.92" style="stroke:#000000;stroke-width:0.9777989973740749;"/><line style="stroke:#000000;stroke-width:0.9777989973740749;" x1="1099.535" x2="1376.2521" y1="2394.92" y2="2394.92"/><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="66.4903" x="1106.3796" y="2369.6944">Request</text><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="234.6718" x="1106.3796" y="2389.0442">erzeuge PASSporT (MXIDs...)</text><line style="stroke:#000000;stroke-width:0.9777989973740749;" x1="1391.8969" x2="1432.9644" y1="2447.3087" y2="2447.3087"/><line style="stroke:#000000;stroke-width:0.9777989973740749;" x1="1432.9644" x2="1432.9644" y1="2447.3087" y2="2460.0201"/><line style="stroke:#000000;stroke-width:0.9777989973740749;" x1="1392.8747" x2="1432.9644" y1="2460.0201" y2="2460.0201"/><polygon fill="#000000" points="1402.6527,2456.1089,1392.8747,2460.0201,1402.6527,2463.9312,1398.7415,2460.0201" style="stroke:#000000;stroke-width:0.9777989973740749;"/><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="148.6254" x="1398.7415" y="2422.0831">Erzeuge PASSporT</text><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="157.4256" x="1398.7415" y="2441.4328">(Attribut orig, dest)</text><polygon fill="#000000" points="1110.2908,2489.1478,1100.5128,2493.059,1110.2908,2496.9702,1106.3796,2493.059" style="stroke:#000000;stroke-width:0.9777989973740749;"/><line style="stroke:#000000;stroke-width:0.9777989973740749;stroke-dasharray:2.0,2.0;" x1="1104.424" x2="1386.0301" y1="2493.059" y2="2493.059"/><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="259.1167" x="1121.0466" y="2487.1831">/?PASSporT=[PASSporT-String].</text><polygon fill="#000000" points="350.5409,2522.1867,340.763,2526.0979,350.5409,2530.0091,346.6297,2526.0979" style="stroke:#000000;stroke-width:0.9777989973740749;"/><line style="stroke:#000000;stroke-width:0.9777989973740749;stroke-dasharray:2.0,2.0;" x1="344.6741" x2="1093.6682" y1="2526.0979" y2="2526.0979"/><text fill="#000000" font-family="sans-serif" font-size="16.6226" lengthAdjust="spacing" textLength="353.9632" x="733.8381" y="2520.222">MXID des gesuchten Akteurs und PASSporT</text><!--MD5=[3829aa1cf1cb796e599e00f19eb3a233]
@startuml
skinparam sequenceMessageAlign direction
skinparam minClassWidth 200
skinparam BoxPadding 1
skinparam sequenceReferenceHeaderBackgroundColor palegreen
scale max 2048 width

skinparam sequence {
ArrowColor black
ArrowFontSize 17
ActorBorderColor black
LifeLineBorderColor black
LifeLineBackgroundColor Gainsboro

ParticipantBorderColor Motivation
ParticipantBackgroundColor Motivation
ParticipantFontName Impact
ParticipantFontSize 20
ParticipantFontColor black
ParticipantBorderColor Black
ParticipantBackgroundColor MOTIVATION

ActorBackgroundColor Gainsboro
ActorFontColor black
ActorFontSize 20
ActorFontName Aapex
}
    actor U as "Akteur in der Rolle\nUser / User-HBA"
    participant cl as "TI-Messenger-Client"
    participant mp as "Messenger Proxy"
    participant hs as "Matrix-Homeserver"
    box <size:18>VZD-FHIR-Directory</size> #WhiteSmoke
      participant fp as "FHIR-Proxy"
      participant pp as "PASSporT-\nService"
      participant au as "Auth-Service"
      participant fd as "FHIR-Directory"
    end box

|||
note over U, hs: \n<size:17>Der Akteur ist erfolgreich beim Messenger-Service angemeldet</size>\n
|||

      activate cl
    U->cl:Suchparameter für \nFHIR-Ressourcen \n eingeben
    cl->cl: prüfe ob noch gültiges \ntim-search-accesstoken\nvorliegt

|||
alt#LightGrey #AliceBlue <size:16>kein gültiges tim-search-accesstoken vorhanden</size>
|||
      

    cl->mp: GET /_matrix/client/user/\n{userId}/openid/request_token 
      activate mp
    mp->hs: HTTP Forward 

      activate hs
    |||
    hs- ->mp: Matrix-OpenID-Token
      deactivate hs
    mp- ->cl: HTTP(S) Forward
      deactivate mp
      
    |||
    cl->au: GET /tim-authenticate... (Auth Header mit Matrix-OpenID-Token)
      activate au
    au->au: Prüfe ob \nMatrix-Domain aus dem \nMatrix-OpenID-Token in \nFöderation enthalten ist

|||
alt#LightGrey #LightBlue <size:16>Matrix-Domain nicht in der Föderation enthalten</size>
|||    

    au- ->cl: HTTP 401 \nUnauthorized
    cl->cl: Session beenden
    cl- ->U: Suche nicht erfolgreich
    
    |||
    else <size:16>matrix_server_name in der Föderation enthalten</size>
    |||
        au->mp: GET /openid/userinfo/?Matrix-OpenID-Token)
          activate mp
        mp->hs: HTTP(S) Forward
          activate hs
        hs->hs: prüfe Matrix-OpenID-Token
        hs- ->mp: MXID des Nutzers
          deactivate hs
        mp- ->au: HTTP(S) Forward
          deactivate mp
        au->au: erzeuge \ntim-search-accesstoken 
        au- ->cl: tim-search-accesstoken (inklusive MXID des Nutzers)
          deactivate au
          deactivate fp
    |||
    end
end

    |||
    cl->fp: GET /tim-search?... (Auth Header mit tim-search-accesstoken inkl. MXID)
    |||
      activate fp
    fp->fp: prüfe tim-search-accesstoken
    |||
    opt#LightGrey #MistyRose <size:16>Abbruch</size>
      fp- ->cl: kein gültiges tim-search-accesstoken 
    |||
    end
   
|||
alt#LightGrey #AliceBlue <size:16>HealthcareService-Einträge werden gesucht</size>
|||
    fp->fd: POST /tim-search/HealthcareService/? \nFinde Datensatz für TelematikID 
      activate fd
    fd- ->fp: Result Body json
      deactivate fd
|||
end

|||
alt#LightGrey #AliceBlue <size:16>PractitionerRole-Einträge werden gesucht</size>
|||
    fp->fd: POST /tim-search/PractitionerRole/? ...<MXID des anfragenden Nutzers> 
      activate fd
    fd->fd: Prüfung, ob MXID im \nTIEndpoint-Eintrag \nvorhanden ist
    fd- ->fp: Result Body json mit TIPractitioner-Eintrag
      deactivate fd
|||
end
|||

  fp->fp: MXID enthalten und \nTIEndpoint.status == active
  |||
  opt#LightGrey #MistyRose <size:16>Abbruch</size>
    fp- ->cl: kein passender Eintrag gefunden \noder TIEndpoint.status == false
    |||
  end
  |||
  fp->pp: Request \nerzeuge PASSporT (MXIDs...)
    activate pp
  pp->pp: Erzeuge PASSporT \n(Attribut orig, dest)
  pp- ->fp: /?PASSporT=[PASSporT-String].
    deactivate pp
  fp- ->cl: MXID des gesuchten Akteurs und PASSporT
   |||
    deactivate fp
    deactivate cl

@enduml

PlantUML version 1.2021.16(Wed Dec 08 17:25:22 UTC 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>