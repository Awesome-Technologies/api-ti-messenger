<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="990px" preserveAspectRatio="none" style="width:1497px;height:990px;background:#FFFFFF;" version="1.1" viewBox="0 0 1497 990" width="1497px" zoomAndPan="magnify"><defs/><g><rect fill="#F5F5F5" height="978.4453" style="stroke:#181818;stroke-width:0.5;" width="548" x="16" y="6"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="193" x="193.5" y="22.708">Messenger-Service</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="5" x="193.5" y="39.02"> </text><rect fill="#F5F5F5" height="978.4453" style="stroke:#181818;stroke-width:0.5;" width="446" x="982.5" y="6"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="200" x="1103" y="22.708">VZD-FHIR-Directory</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="5" x="1303" y="23.8872"> </text><rect fill="#DCDCDC" height="741.0078" style="stroke:#000000;stroke-width:1.0;" width="10" x="122" y="145.1563"/><rect fill="#DCDCDC" height="674.2188" style="stroke:#000000;stroke-width:1.0;" width="10" x="681.5" y="145.1563"/><rect fill="#DCDCDC" height="382.9063" style="stroke:#000000;stroke-width:1.0;" width="10" x="1088.5" y="377.6797"/><rect fill="#DCDCDC" height="100.3672" style="stroke:#000000;stroke-width:1.0;" width="10" x="1312.5" y="198.7344"/><rect fill="#F0F8FF" height="350.3281" style="stroke:#000000;stroke-width:1.5;" width="1200.5" x="10" y="575.8359"/><rect fill="#F0F8FF" height="211.9922" style="stroke:none;stroke-width:1.0;" width="1200.5" x="10" y="714.1719"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="127" x2="127" y1="84.3672" y2="943.1641"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="453" x2="453" y1="84.3672" y2="943.1641"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="686" x2="686" y1="84.3672" y2="943.1641"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1093.5" x2="1093.5" y1="84.3672" y2="943.1641"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1317.5" x2="1317.5" y1="84.3672" y2="943.1641"/><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="20" y="46.0859"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="168" x="43" y="71.6504">Messenger-Proxy</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="20" y="942.1641"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="168" x="43" y="967.7285">Messenger-Proxy</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="346" y="46.0859"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="189" x="358.5" y="71.6504">Matrix-Homeserver</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="346" y="942.1641"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="189" x="358.5" y="967.7285">Matrix-Homeserver</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="231" x="571" y="46.0859"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="217" x="578" y="71.6504">Registrierungs-Dienst</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="231" x="571" y="942.1641"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="217" x="578" y="967.7285">Registrierungs-Dienst</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="986.5" y="46.0859"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="108" x="1039.5" y="71.6504">FHIR-Proxy</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="986.5" y="942.1641"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="108" x="1039.5" y="967.7285">FHIR-Proxy</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1210.5" y="46.0859"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="144" x="1245.5" y="71.6504">OAuth-Service</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1210.5" y="942.1641"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="144" x="1245.5" y="967.7285">OAuth-Service</text><rect fill="#DCDCDC" height="741.0078" style="stroke:#000000;stroke-width:1.0;" width="10" x="122" y="145.1563"/><rect fill="#DCDCDC" height="674.2188" style="stroke:#000000;stroke-width:1.0;" width="10" x="681.5" y="145.1563"/><rect fill="#DCDCDC" height="382.9063" style="stroke:#000000;stroke-width:1.0;" width="10" x="1088.5" y="377.6797"/><rect fill="#DCDCDC" height="100.3672" style="stroke:#000000;stroke-width:1.0;" width="10" x="1312.5" y="198.7344"/><polygon fill="#000000" points="669.5,141.1563,679.5,145.1563,669.5,149.1563,673.5,145.1563" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="132" x2="675.5" y1="145.1563" y2="145.1563"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="164" x="139" y="139.147">GET /FederationList</text><polygon fill="#000000" points="1300.5,194.7344,1310.5,198.7344,1300.5,202.7344,1304.5,198.7344" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="691.5" x2="1306.5" y1="198.7344" y2="198.7344"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="356" x="698.5" y="172.936">GET /authenticate (client_id, client_secret)</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="259" x="698.5" y="192.7251">(OAuth Client credentials flow)</text><line style="stroke:#000000;stroke-width:1.0;" x1="1322.5" x2="1364.5" y1="252.3125" y2="252.3125"/><line style="stroke:#000000;stroke-width:1.0;" x1="1364.5" x2="1364.5" y1="252.3125" y2="265.3125"/><line style="stroke:#000000;stroke-width:1.0;" x1="1323.5" x2="1364.5" y1="265.3125" y2="265.3125"/><polygon fill="#000000" points="1333.5,261.3125,1323.5,265.3125,1333.5,269.3125,1329.5,265.3125" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="156" x="1329.5" y="226.5142">prüfe client_id und</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="105" x="1329.5" y="246.3032">client_secret</text><polygon fill="#000000" points="702.5,295.1016,692.5,299.1016,702.5,303.1016,698.5,299.1016" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="696.5" x2="1316.5" y1="299.1016" y2="299.1016"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="236" x="1074.5" y="293.0923">status, provider-accesstoken</text><polygon fill="#000000" points="1076.5,373.6797,1086.5,377.6797,1076.5,381.6797,1080.5,377.6797" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="691.5" x2="1082.5" y1="377.6797" y2="377.6797"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="373" x="698.5" y="351.8813">GET /tim-provider-services/getFederationList</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="260" x="698.5" y="371.6704">(provider-accesstoken, version)</text><line style="stroke:#000000;stroke-width:1.0;" x1="1098.5" x2="1140.5" y1="431.2578" y2="431.2578"/><line style="stroke:#000000;stroke-width:1.0;" x1="1140.5" x2="1140.5" y1="431.2578" y2="444.2578"/><line style="stroke:#000000;stroke-width:1.0;" x1="1099.5" x2="1140.5" y1="444.2578" y2="444.2578"/><polygon fill="#000000" points="1109.5,440.2578,1099.5,444.2578,1109.5,448.2578,1105.5,444.2578" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="44" x="1105.5" y="405.4595">prüfe</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="175" x="1105.5" y="425.2485">provider-accesstoken</text><line style="stroke:#000000;stroke-width:1.0;" x1="1098.5" x2="1140.5" y1="522.8359" y2="522.8359"/><line style="stroke:#000000;stroke-width:1.0;" x1="1140.5" x2="1140.5" y1="522.8359" y2="535.8359"/><line style="stroke:#000000;stroke-width:1.0;" x1="1099.5" x2="1140.5" y1="535.8359" y2="535.8359"/><polygon fill="#000000" points="1109.5,531.8359,1099.5,535.8359,1109.5,539.8359,1105.5,535.8359" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="148" x="1105.5" y="497.0376">prüfe übergebene</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="62" x="1105.5" y="516.8267">Version</text><path d="M10,575.8359 L74,575.8359 L74,582.9688 L64,592.9688 L10,592.9688 L10,575.8359 " fill="#D3D3D3" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="350.3281" style="stroke:#000000;stroke-width:1.5;" width="1200.5" x="10" y="575.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="25" y="588.9028">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="5" x="89" y="593.8667">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="160" x="94" y="592.6875">Version ist aktuell</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="5" x="254" y="593.8667">]</text><polygon fill="#000000" points="702.5,643.3828,692.5,647.3828,702.5,651.3828,698.5,647.3828" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="696.5" x2="1087.5" y1="647.3828" y2="647.3828"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="51" x="1030.5" y="641.3735">status</text><polygon fill="#000000" points="143,677.1719,133,681.1719,143,685.1719,139,681.1719" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="137" x2="680.5" y1="681.1719" y2="681.1719"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="51" x="623.5" y="675.1626">status</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="1210.5" y1="715.1719" y2="715.1719"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="5" x="15" y="731.2026">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="210" x="20" y="730.0234">Version ist nicht aktuell</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="5" x="230" y="731.2026">]</text><polygon fill="#000000" points="702.5,756.5859,692.5,760.5859,702.5,764.5859,698.5,760.5859" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="696.5" x2="1092.5" y1="760.5859" y2="760.5859"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="147" x="939.5" y="754.5767">Föderationsliste[]</text><polygon fill="#000000" points="143,815.375,133,819.375,143,823.375,139,819.375" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="137" x2="685.5" y1="819.375" y2="819.375"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="147" x="532.5" y="813.3657">Föderationsliste[]</text><line style="stroke:#000000;stroke-width:1.0;" x1="132" x2="174" y1="853.1641" y2="853.1641"/><line style="stroke:#000000;stroke-width:1.0;" x1="174" x2="174" y1="853.1641" y2="866.1641"/><line style="stroke:#000000;stroke-width:1.0;" x1="133" x2="174" y1="866.1641" y2="866.1641"/><polygon fill="#000000" points="143,862.1641,133,866.1641,143,870.1641,139,866.1641" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="302" x="139" y="847.1548">Signatur der Föderationsliste prüfen</text><!--MD5=[85eff64f8f3749e538cced2c0aa0d955]
@startuml
skinparam sequenceMessageAlign direction
skinparam minClassWidth 200
skinparam BoxPadding 1
skinparam sequenceReferenceHeaderBackgroundColor palegreen
scale max 2048 width

skinparam sequence {
ArrowColor black
ArrowFontSize 17
ActorBorderColor black
LifeLineBorderColor black
LifeLineBackgroundColor Gainsboro

ParticipantBorderColor Motivation
ParticipantBackgroundColor Motivation
ParticipantFontName Impact
ParticipantFontSize 20
ParticipantFontColor black
ParticipantBorderColor Black
ParticipantBackgroundColor MOTIVATION

ActorBackgroundColor Gainsboro
ActorFontColor black
ActorFontSize 20
ActorFontName Aapex
}
    box <size:18>Messenger-Service\n #WhiteSmoke
    participant MP as "Messenger-Proxy"
    participant MH as "Matrix-Homeserver"
    end box
    participant RD as "Registrierungs-Dienst"
    box <size:18>VZD-FHIR-Directory</size> #WhiteSmoke
      participant FP as "FHIR-Proxy"
      participant AS as "OAuth-Service"
    end box

  |||
  MP->RD: GET /FederationList 
    Activate MP
    Activate RD

  RD->AS: GET /authenticate (client_id, client_secret) \n(OAuth Client credentials flow)
    Activate AS
  AS->AS: prüfe client_id und \nclient_secret
  AS- ->RD: status, provider-accesstoken 
    Deactivate AS  

  |||
  RD->FP: GET /tim-provider-services/getFederationList \n(provider-accesstoken, version)
    Activate FP
  FP->FP: prüfe \nprovider-accesstoken
  |||
  FP->FP: prüfe übergebene \nVersion

|||
alt#LightGrey #AliceBlue <size:16>Version ist aktuell</size>
|||    

    FP- ->RD: status
    RD- ->MP: status
    |||
    
    else <size:16>Version ist nicht aktuell</size>
       FP- ->RD: Föderationsliste[]
        Deactivate FP
       |||
      RD- ->MP: Föderationsliste[]
        Deactivate RD
      MP->MP: Signatur der Föderationsliste prüfen
      'Needed for correct deactivation in case last message is message to itself
      MP-[hidden]->MP
        deactivate MP
    |||
end
@enduml

@startuml
skinparam sequenceMessageAlign direction
skinparam minClassWidth 200
skinparam BoxPadding 1
skinparam sequenceReferenceHeaderBackgroundColor palegreen
scale max 2048 width

skinparam sequence {
ArrowColor black
ArrowFontSize 17
ActorBorderColor black
LifeLineBorderColor black
LifeLineBackgroundColor Gainsboro

ParticipantBorderColor Motivation
ParticipantBackgroundColor Motivation
ParticipantFontName Impact
ParticipantFontSize 20
ParticipantFontColor black
ParticipantBorderColor Black
ParticipantBackgroundColor MOTIVATION

ActorBackgroundColor Gainsboro
ActorFontColor black
ActorFontSize 20
ActorFontName Aapex
}
    box <size:18>Messenger-Service\n #WhiteSmoke
    participant MP as "Messenger-Proxy"
    participant MH as "Matrix-Homeserver"
    end box
    participant RD as "Registrierungs-Dienst"
    box <size:18>VZD-FHIR-Directory</size> #WhiteSmoke
      participant FP as "FHIR-Proxy"
      participant AS as "OAuth-Service"
    end box

  |||
  MP->RD: GET /FederationList 
    Activate MP
    Activate RD

  RD->AS: GET /authenticate (client_id, client_secret) \n(OAuth Client credentials flow)
    Activate AS
  AS->AS: prüfe client_id und \nclient_secret
  AS- ->RD: status, provider-accesstoken 
    Deactivate AS  

  |||
  RD->FP: GET /tim-provider-services/getFederationList \n(provider-accesstoken, version)
    Activate FP
  FP->FP: prüfe \nprovider-accesstoken
  |||
  FP->FP: prüfe übergebene \nVersion

|||
alt#LightGrey #AliceBlue <size:16>Version ist aktuell</size>
|||    

    FP- ->RD: status
    RD- ->MP: status
    |||
    
    else <size:16>Version ist nicht aktuell</size>
       FP- ->RD: Föderationsliste[]
        Deactivate FP
       |||
      RD- ->MP: Föderationsliste[]
        Deactivate RD
      MP->MP: Signatur der Föderationsliste prüfen
      MP-[hidden]->MP
        deactivate MP
    |||
end
@enduml

PlantUML version 1.2022.5(Sat Apr 30 10:55:52 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>