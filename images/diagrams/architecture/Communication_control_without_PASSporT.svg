<<<<<<< HEAD
<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1793px" preserveAspectRatio="none" style="width:2722px;height:1793px;background:#FFFFFF;" version="1.1" viewBox="0 0 2722 1793" width="2722px" zoomAndPan="magnify"><defs/><g><rect fill="#F8F8F8" height="1781.1641" style="stroke:#181818;stroke-width:0.5;" width="582.5" x="635.5" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="181" x="833.75" y="18.0669">TI-Messenger Anbieter A</text><rect fill="#F8F8F8" height="1781.1641" style="stroke:#181818;stroke-width:0.5;" width="583.5" x="1529.5" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="190" x="1723.75" y="18.0669">TI-Messenger Anbieter B7</text><rect fill="#FFFFFF" height="1538.4453" style="stroke:#181818;stroke-width:1.0;" width="10" x="235.5" y="159.4219"/><rect fill="#FFFFFF" height="44.2656" style="stroke:#181818;stroke-width:1.0;" width="10" x="714.5" y="395.6172"/><rect fill="#FFFFFF" height="710.0625" style="stroke:#181818;stroke-width:1.0;" width="10" x="714.5" y="987.8047"/><rect fill="#FFFFFF" height="174.9297" style="stroke:#181818;stroke-width:1.0;" width="10" x="1123.5" y="484.1484"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="1332.5" y="188.5547"/><rect fill="#FFFFFF" height="44.2656" style="stroke:#181818;stroke-width:1.0;" width="10" x="1332.5" y="1333.3359"/><rect fill="#FFFFFF" height="174.9297" style="stroke:#181818;stroke-width:1.0;" width="10" x="1614.5" y="776.7422"/><rect fill="#FFFFFF" height="490" style="stroke:#181818;stroke-width:1.0;" width="10" x="1614.5" y="1134.6016"/><rect fill="#FFFFFF" height="44.2656" style="stroke:#181818;stroke-width:1.0;" width="10" x="2023.5" y="688.2109"/><rect fill="#FFFFFF" height="578.5313" style="stroke:#181818;stroke-width:1.0;" width="10" x="2023.5" y="1075.2031"/><rect fill="#FFFFFF" height="1214.1797" style="stroke:#181818;stroke-width:1.0;" width="10" x="2486.5" y="366.4844"/><rect height="119.6641" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1393.5" x="10" y="106.0234"/><rect height="719.9844" style="stroke:#000000;stroke-width:1.5;fill:none;" width="2706.5" x="10" y="239.6875"/><rect height="541.2656" style="stroke:#000000;stroke-width:1.5;fill:none;" width="2370.5" x="181" y="1149.6016"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="52" x2="52" y1="89.0234" y2="1707.8672"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="240" x2="240" y1="89.0234" y2="1707.8672"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="719.5" x2="719.5" y1="89.0234" y2="1707.8672"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1128" x2="1128" y1="89.0234" y2="1707.8672"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1337.5" x2="1337.5" y1="89.0234" y2="1707.8672"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1619.5" x2="1619.5" y1="89.0234" y2="1707.8672"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="2028" x2="2028" y1="89.0234" y2="1707.8672"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="2491.5" x2="2491.5" y1="89.0234" y2="1707.8672"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="2673.5" x2="2673.5" y1="89.0234" y2="1707.8672"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="20" y="85.7217">Nutzer A</text><ellipse cx="52.5" cy="21.2266" fill="#E3E3E3" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M52.5,29.2266 L52.5,56.2266 M39.5,37.2266 L65.5,37.2266 M52.5,56.2266 L39.5,71.2266 M52.5,56.2266 L65.5,71.2266 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="20" y="1719.8623">Nutzer A</text><ellipse cx="52.5" cy="1731.6641" fill="#E3E3E3" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M52.5,1739.6641 L52.5,1766.6641 M39.5,1747.6641 L65.5,1747.6641 M52.5,1766.6641 L39.5,1781.6641 M52.5,1766.6641 L65.5,1781.6641 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="99" x="191" y="57.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85" x="198" y="77.7217">TI-M Client A</text><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="99" x="191" y="1706.8672"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85" x="198" y="1726.8623">TI-M Client A</text><rect fill="#E3E3E3" height="62.8906" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="160" x="639.5" y="25.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="146" x="646.5" y="45.1279">Messenger-Service A</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="141" x="649" y="61.4248">(Messenger-Proxy +</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89" x="675" y="77.7217">Homeserver)</text><rect fill="#E3E3E3" height="62.8906" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="160" x="639.5" y="1706.8672"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="146" x="646.5" y="1726.8623">Messenger-Service A</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="141" x="649" y="1743.1592">(Messenger-Proxy +</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89" x="675" y="1759.4561">Homeserver)</text><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="171" x="1043" y="57.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="157" x="1050" y="77.7217">Registrierungsdienst A</text><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="171" x="1043" y="1706.8672"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="157" x="1050" y="1726.8623">Registrierungsdienst A</text><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="112" x="1281.5" y="57.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="1288.5" y="77.7217">FHIR-Directory</text><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="112" x="1281.5" y="1706.8672"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="1288.5" y="1726.8623">FHIR-Directory</text><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="172" x="1533.5" y="57.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="158" x="1540.5" y="77.7217">Registrierungsdienst B</text><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="172" x="1533.5" y="1706.8672"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="158" x="1540.5" y="1726.8623">Registrierungsdienst B</text><rect fill="#E3E3E3" height="62.8906" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="161" x="1948" y="25.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="147" x="1955" y="45.1279">Messenger-Service B</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="141" x="1958" y="61.4248">(Messenger-Proxy +</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89" x="1984" y="77.7217">Homeserver)</text><rect fill="#E3E3E3" height="62.8906" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="161" x="1948" y="1706.8672"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="147" x="1955" y="1726.8623">Messenger-Service B</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="141" x="1958" y="1743.1592">(Messenger-Proxy +</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89" x="1984" y="1759.4561">Homeserver)</text><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="100" x="2441.5" y="57.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="2448.5" y="77.7217">TI-M Client B</text><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="100" x="2441.5" y="1706.8672"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="2448.5" y="1726.8623">TI-M Client B</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60" x="2640.5" y="85.7217">Nutzer B</text><ellipse cx="2673.5" cy="21.2266" fill="#E3E3E3" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M2673.5,29.2266 L2673.5,56.2266 M2660.5,37.2266 L2686.5,37.2266 M2673.5,56.2266 L2660.5,71.2266 M2673.5,56.2266 L2686.5,71.2266 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60" x="2640.5" y="1719.8623">Nutzer B</text><ellipse cx="2673.5" cy="1731.6641" fill="#E3E3E3" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M2673.5,1739.6641 L2673.5,1766.6641 M2660.5,1747.6641 L2686.5,1747.6641 M2673.5,1766.6641 L2660.5,1781.6641 M2673.5,1766.6641 L2686.5,1781.6641 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#FFFFFF" height="1538.4453" style="stroke:#181818;stroke-width:1.0;" width="10" x="235.5" y="159.4219"/><rect fill="#FFFFFF" height="44.2656" style="stroke:#181818;stroke-width:1.0;" width="10" x="714.5" y="395.6172"/><rect fill="#FFFFFF" height="710.0625" style="stroke:#181818;stroke-width:1.0;" width="10" x="714.5" y="987.8047"/><rect fill="#FFFFFF" height="174.9297" style="stroke:#181818;stroke-width:1.0;" width="10" x="1123.5" y="484.1484"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="1332.5" y="188.5547"/><rect fill="#FFFFFF" height="44.2656" style="stroke:#181818;stroke-width:1.0;" width="10" x="1332.5" y="1333.3359"/><rect fill="#FFFFFF" height="174.9297" style="stroke:#181818;stroke-width:1.0;" width="10" x="1614.5" y="776.7422"/><rect fill="#FFFFFF" height="490" style="stroke:#181818;stroke-width:1.0;" width="10" x="1614.5" y="1134.6016"/><rect fill="#FFFFFF" height="44.2656" style="stroke:#181818;stroke-width:1.0;" width="10" x="2023.5" y="688.2109"/><rect fill="#FFFFFF" height="578.5313" style="stroke:#181818;stroke-width:1.0;" width="10" x="2023.5" y="1075.2031"/><rect fill="#FFFFFF" height="1214.1797" style="stroke:#181818;stroke-width:1.0;" width="10" x="2486.5" y="366.4844"/><path d="M10,106.0234 L74,106.0234 L74,113.1563 L64,123.1563 L10,123.1563 L10,106.0234 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="119.6641" style="stroke:#000000;stroke-width:1.5;" width="1393.5" x="10" y="106.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="25" y="119.0903">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="164" x="89" y="118.2339">[Suche im FHIR-Directory]</text><polygon fill="#181818" points="223.5,155.4219,233.5,159.4219,223.5,163.4219,227.5,159.4219" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="52.5" x2="229.5" y1="159.4219" y2="159.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164" x="59.5" y="139.2231">möchte TI-M Kontakt zum</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92" x="59.5" y="154.356">chatten finden</text><polygon fill="#181818" points="1320.5,184.5547,1330.5,188.5547,1320.5,192.5547,1324.5,188.5547" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="245.5" x2="1326.5" y1="188.5547" y2="188.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="252.5" y="183.4888">FHIR search request</text><polygon fill="#181818" points="256.5,213.6875,246.5,217.6875,256.5,221.6875,252.5,217.6875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="250.5" x2="1336.5" y1="217.6875" y2="217.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="239" x="262.5" y="212.6216">FHIR response mit MXID von Nutzer B</text><path d="M10,239.6875 L74,239.6875 L74,246.8203 L64,256.8203 L10,256.8203 L10,239.6875 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="719.9844" style="stroke:#000000;stroke-width:1.5;" width="2706.5" x="10" y="239.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="25" y="252.7544">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="372" x="89" y="251.8979">[Tauscht bei persönlichem Treffen MXID mit Nutzer B aus]</text><polygon fill="#181818" points="2661.5,273.9531,2671.5,277.9531,2661.5,281.9531,2665.5,277.9531" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="52.5" x2="2667.5" y1="277.9531" y2="277.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226" x="59.5" y="272.8872">Kontaktdaten austauschen per App</text><polygon fill="#181818" points="223.5,318.2188,233.5,322.2188,223.5,326.2188,227.5,322.2188" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="52.5" x2="229.5" y1="322.2188" y2="322.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="59.5" y="302.02">MXID von Nutzer B</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="59.5" y="317.1528">zu Kontakten hinzufügen</text><polygon fill="#181818" points="2507.5,362.4844,2497.5,366.4844,2507.5,370.4844,2503.5,366.4844" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2501.5" x2="2672.5" y1="366.4844" y2="366.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="2513.5" y="346.2856">MXID von Nutzer A</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="2513.5" y="361.4185">zu Kontakten hinzufügen</text><polygon fill="#181818" points="702.5,391.6172,712.5,395.6172,702.5,399.6172,706.5,395.6172" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="245.5" x2="708.5" y1="395.6172" y2="395.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="379" x="252.5" y="390.5513">POST /_matrix/client/r0/user/{userId}/openid/request_token</text><polygon fill="#181818" points="256.5,435.8828,246.5,439.8828,256.5,443.8828,252.5,439.8828" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="250.5" x2="718.5" y1="439.8828" y2="439.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="445" x="262.5" y="419.6841">HTTP 200 OK, Result body {"access_token": "Matrix-OpenID-Token",...,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="271" x="262.5" y="434.8169">"matrix_server_name": "example.com",...}</text><polygon fill="#181818" points="1111.5,480.1484,1121.5,484.1484,1111.5,488.1484,1115.5,484.1484" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="245.5" x2="1117.5" y1="484.1484" y2="484.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189" x="252.5" y="463.9497">invite von Nutzer B ist erlaubt</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="254" x="252.5" y="479.0825">(Auth Header mit Matrix-OpenID-Token)</text><line style="stroke:#181818;stroke-width:1.0;" x1="1133.5" x2="1175.5" y1="528.4141" y2="528.4141"/><line style="stroke:#181818;stroke-width:1.0;" x1="1175.5" x2="1175.5" y1="528.4141" y2="541.4141"/><line style="stroke:#181818;stroke-width:1.0;" x1="1134.5" x2="1175.5" y1="541.4141" y2="541.4141"/><polygon fill="#181818" points="1144.5,537.4141,1134.5,541.4141,1144.5,545.4141,1140.5,541.4141" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="1140.5" y="508.2153">verify that the token comes</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="1140.5" y="523.3481">from own Messenger-Service</text><polygon fill="#181818" points="730.5,581.6797,720.5,585.6797,730.5,589.6797,726.5,585.6797" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="724.5" x2="1122.5" y1="585.6797" y2="585.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="736.5" y="565.481">GET /openid/userinfo/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="380" x="736.5" y="580.6138">request header, Authorization: Bearer Matrix-OpenID-Token</text><polygon fill="#181818" points="1111.5,625.9453,1121.5,629.9453,1111.5,633.9453,1115.5,629.9453" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="719.5" x2="1117.5" y1="629.9453" y2="629.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="726.5" y="609.7466">HTTP 200 OK</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="270" x="726.5" y="624.8794">(Result Body MXID des Nutzers)activate rd</text><polygon fill="#181818" points="256.5,655.0781,246.5,659.0781,256.5,663.0781,252.5,659.0781" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="250.5" x2="1127.5" y1="659.0781" y2="659.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="262.5" y="654.0122">HTTP 200 OK</text><polygon fill="#181818" points="2044.5,684.2109,2034.5,688.2109,2044.5,692.2109,2040.5,688.2109" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2038.5" x2="2485.5" y1="688.2109" y2="688.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="379" x="2050.5" y="683.145">POST /_matrix/client/r0/user/{userId}/openid/request_token</text><polygon fill="#181818" points="2474.5,728.4766,2484.5,732.4766,2474.5,736.4766,2478.5,732.4766" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2028.5" x2="2480.5" y1="732.4766" y2="732.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="429" x="2035.5" y="712.2778">HTTP 200 OK, Result body {"access_token": "Matrix-OpenID-Token",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="291" x="2035.5" y="727.4106">..., "matrix_server_name": "example.com",...}</text><polygon fill="#181818" points="1635.5,772.7422,1625.5,776.7422,1635.5,780.7422,1631.5,776.7422" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1629.5" x2="2485.5" y1="776.7422" y2="776.7422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189" x="1641.5" y="756.5435">invite von Nutzer A ist erlaubt</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="254" x="1641.5" y="771.6763">(Auth Header mit Matrix-OpenID-Token)</text><line style="stroke:#181818;stroke-width:1.0;" x1="1624.5" x2="1666.5" y1="821.0078" y2="821.0078"/><line style="stroke:#181818;stroke-width:1.0;" x1="1666.5" x2="1666.5" y1="821.0078" y2="834.0078"/><line style="stroke:#181818;stroke-width:1.0;" x1="1625.5" x2="1666.5" y1="834.0078" y2="834.0078"/><polygon fill="#181818" points="1635.5,830.0078,1625.5,834.0078,1635.5,838.0078,1631.5,834.0078" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="1631.5" y="800.8091">verify that the token comes</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="1631.5" y="815.9419">from own Messenger-Service</text><polygon fill="#181818" points="2016.5,874.2734,2026.5,878.2734,2016.5,882.2734,2020.5,878.2734" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1624.5" x2="2022.5" y1="878.2734" y2="878.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="1631.5" y="858.0747">GET /openid/userinfo/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="380" x="1631.5" y="873.2075">request header, Authorization: Bearer Matrix-OpenID-Token</text><polygon fill="#181818" points="1635.5,918.5391,1625.5,922.5391,1635.5,926.5391,1631.5,922.5391" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1629.5" x2="2027.5" y1="922.5391" y2="922.5391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="1641.5" y="902.3403">HTTP 200 OK</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="270" x="1641.5" y="917.4731">(Result Body MXID des Nutzers)activate rd</text><polygon fill="#181818" points="2474.5,947.6719,2484.5,951.6719,2474.5,955.6719,2478.5,951.6719" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1619.5" x2="2480.5" y1="951.6719" y2="951.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="1626.5" y="946.606">HTTP 200 OK</text><polygon fill="#181818" points="702.5,983.8047,712.5,987.8047,702.5,991.8047,706.5,987.8047" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="245.5" x2="708.5" y1="987.8047" y2="987.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="252.5" y="982.7388">create room</text><polygon fill="#181818" points="256.5,1012.9375,246.5,1016.9375,256.5,1020.9375,252.5,1016.9375" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="250.5" x2="713.5" y1="1016.9375" y2="1016.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87" x="262.5" y="1011.8716">room created</text><polygon fill="#181818" points="702.5,1042.0703,712.5,1046.0703,702.5,1050.0703,706.5,1046.0703" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="245.5" x2="708.5" y1="1046.0703" y2="1046.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="252.5" y="1041.0044">invite von Nutzer A an Nutzer B</text><polygon fill="#181818" points="2011.5,1071.2031,2021.5,1075.2031,2011.5,1079.2031,2015.5,1075.2031" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="724.5" x2="2017.5" y1="1075.2031" y2="1075.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="731.5" y="1070.1372">invite von Nutzer A an Nutzer B</text><polygon fill="#181818" points="1635.5,1130.6016,1625.5,1134.6016,1635.5,1138.6016,1631.5,1134.6016" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1629.5" x2="2022.5" y1="1134.6016" y2="1134.6016"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="1641.5" y="1099.27">REST Operation</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="290" x="1641.5" y="1114.4028">IsAllowedCommunication(src=MXID Nutzer A,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="1645.5" y="1129.5356">dst=MXID Nutzer B)</text><path d="M181,1149.6016 L245,1149.6016 L245,1156.7344 L235,1166.7344 L181,1166.7344 L181,1149.6016 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="541.2656" style="stroke:#000000;stroke-width:1.5;" width="2370.5" x="181" y="1149.6016"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="196" y="1162.6685">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="201" x="260" y="1161.812">[invite von Nutzer A ist erlaubt]</text><polygon fill="#181818" points="2011.5,1183.8672,2021.5,1187.8672,2011.5,1191.8672,2015.5,1187.8672" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1624.5" x2="2017.5" y1="1187.8672" y2="1187.8672"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92" x="1631.5" y="1182.8013">Response true</text><polygon fill="#181818" points="2474.5,1213,2484.5,1217,2474.5,1221,2478.5,1217" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2033.5" x2="2480.5" y1="1217" y2="1217"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="2040.5" y="1211.9341">invite von Nutzer A an Nutzer B</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="181" x2="2551.5" y1="1226" y2="1226"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="217" x="186" y="1236.2104">[invite von Nutzer A nicht erlaubt]</text><line style="stroke:#181818;stroke-width:1.0;" x1="1624.5" x2="1666.5" y1="1276.0703" y2="1276.0703"/><line style="stroke:#181818;stroke-width:1.0;" x1="1666.5" x2="1666.5" y1="1276.0703" y2="1289.0703"/><line style="stroke:#181818;stroke-width:1.0;" x1="1625.5" x2="1666.5" y1="1289.0703" y2="1289.0703"/><polygon fill="#181818" points="1635.5,1285.0703,1625.5,1289.0703,1635.5,1293.0703,1631.5,1289.0703" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196" x="1631.5" y="1255.8716">hashA = hash(MXID Nutzer A),</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="1631.5" y="1271.0044">hashB = hash(MXID Nutzer B)</text><polygon fill="#181818" points="1353.5,1329.3359,1343.5,1333.3359,1353.5,1337.3359,1349.5,1333.3359" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1347.5" x2="1613.5" y1="1333.3359" y2="1333.3359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="1359.5" y="1313.1372">REST Operation</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208" x="1359.5" y="1328.27">WhereIs(hashA), WhereIs(hashB)</text><polygon fill="#181818" points="1602.5,1373.6016,1612.5,1377.6016,1602.5,1381.6016,1606.5,1377.6016" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1337.5" x2="1608.5" y1="1377.6016" y2="1377.6016"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="244" x="1344.5" y="1357.4028">Response (hashA is in PractitionerDir),</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="248" x="1344.5" y="1372.5356">Response (hashB is in OrganizationDir)</text><line style="stroke:#181818;stroke-width:1.0;" x1="1624.5" x2="1666.5" y1="1406.7344" y2="1406.7344"/><line style="stroke:#181818;stroke-width:1.0;" x1="1666.5" x2="1666.5" y1="1406.7344" y2="1419.7344"/><line style="stroke:#181818;stroke-width:1.0;" x1="1625.5" x2="1666.5" y1="1419.7344" y2="1419.7344"/><polygon fill="#181818" points="1635.5,1415.7344,1625.5,1419.7344,1635.5,1423.7344,1631.5,1419.7344" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="1631.5" y="1401.6685">Cache Response (1 Tag)</text><line style="stroke:#181818;stroke-width:1.0;" x1="1624.5" x2="1666.5" y1="1509.3984" y2="1509.3984"/><line style="stroke:#181818;stroke-width:1.0;" x1="1666.5" x2="1666.5" y1="1509.3984" y2="1522.3984"/><line style="stroke:#181818;stroke-width:1.0;" x1="1625.5" x2="1666.5" y1="1522.3984" y2="1522.3984"/><polygon fill="#181818" points="1635.5,1518.3984,1625.5,1522.3984,1635.5,1526.3984,1631.5,1522.3984" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="1631.5" y="1443.8013">Decision[</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="286" x="1631.5" y="1458.9341">if hashB is in organization directory then true</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="1631.5" y="1474.0669">else if hashA is in practitioner directory</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="297" x="1635.5" y="1489.1997">and hashB is in practitioner directory then true</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="1631.5" y="1504.3325">else false]</text><polygon fill="#181818" points="2011.5,1547.5313,2021.5,1551.5313,2011.5,1555.5313,2015.5,1551.5313" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1624.5" x2="2017.5" y1="1551.5313" y2="1551.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92" x="1631.5" y="1546.4653">Response true</text><polygon fill="#181818" points="2479.5,1576.6641,2489.5,1580.6641,2479.5,1584.6641,2483.5,1580.6641" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2033.5" x2="2485.5" y1="1580.6641" y2="1580.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="2040.5" y="1575.5981">invite von Nutzer A an Nutzer B</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="181" x2="2551.5" y1="1589.6641" y2="1589.6641"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="152" x="186" y="1599.8745">[Invite ist nicht erlaubt]</text><polygon fill="#181818" points="2011.5,1620.6016,2021.5,1624.6016,2011.5,1628.6016,2015.5,1624.6016" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1619.5" x2="2017.5" y1="1624.6016" y2="1624.6016"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="1626.5" y="1619.5356">Response false</text><polygon fill="#181818" points="735.5,1649.7344,725.5,1653.7344,735.5,1657.7344,731.5,1653.7344" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="729.5" x2="2027.5" y1="1653.7344" y2="1653.7344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="335" x="741.5" y="1648.6685">ERROR: invite von Nutzer A an Nutzer B nicht erlaubt</text><polygon fill="#181818" points="256.5,1678.8672,246.5,1682.8672,256.5,1686.8672,252.5,1682.8672" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="250.5" x2="713.5" y1="1682.8672" y2="1682.8672"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="335" x="262.5" y="1677.8013">ERROR: invite von Nutzer A an Nutzer B nicht erlaubt</text><!--MD5=[a2b63d4062227ba464f8644937ce39a5]
@startuml TI-Messenger communication control without PASSporT
/'
Vorteile:
- bessere Kompatibilität mit Matrix API
- einfachere Architektur
- keine Signaturprüfung von PASSporT im Messenger-Proxy
  - kein download von Signatur-, CA- und Root-Zertifikaten erforderlich (Schnittstelle und
    Spezifikation fehlen noch in aktueller Spec)
  - keine Abhängigkeit mehr zu PT Infrastructure
- Bessere Latenz bei Suchen im FHIR-Dir
  - einheitliche Schnittstelle im FHIR-Dir für TIM und KIM 2.0
  - geringere Abhängigkeit vom FHIR-Dir
- Ermöglicht TI 2.0 Zero Trust Architektur (Policy Decision Point (PDP) ist entweder in
  Registrierungsdienst integriert oder eigenständige Komponente, Policy Enforcement Point ist der Messenger-Proxy)
  - einfache Erweiterung um zusätzliche Policies im PDP möglich (z. B. für Versicherte)
  - Sicherheit von TIM wird durch TIM-Komponenten kontrolliert (und nicht durch das FHIR-Dir)
- Bessere UX für Austausch von TI-M Adressen bei persönlichem Kontakt.
  - Austausch von TIM Adressen grundsätzlich auch remote möglich

Was muss getan werden, um ohne PASSporTs auszukommen?
- PASSporT aus der TI-M Spec entfernen
- PASSporT aus der FHIR-Dir Spec entfernen
- REST Operationen am Messenger-Proxy spezifizieren (invite von MXIDs erlauben und Erlaubnis widerrufen,
  Dauer der Erlaubnis als Parameter)
- zusätzliche REST Operationen an I_TIM_Provider_Services
- Erläuternde Beschreibung der Abläufe zwischen Messenger-Proxy und Registrierungsdienst
'/
!pragma layout smetana
'!include ../includes/gem-tim.iuml
'!include ../includes/gem-tim-monochrome.iuml
skinparam monochrome true

actor a as "Nutzer A"
participant cl as "TI-M Client A"
box TI-Messenger Anbieter A #GhostWhite
participant mp as "Messenger-Service A\n(Messenger-Proxy +\nHomeserver)"
participant rd as "Registrierungsdienst A"
end box
participant fd as "FHIR-Directory"
box TI-Messenger Anbieter B7 #GhostWhite
participant rdb as "Registrierungsdienst B"
participant mpb as "Messenger-Service B\n(Messenger-Proxy +\nHomeserver)"
end box
participant clb as "TI-M Client B"
actor b as "Nutzer B"

alt Suche im FHIR-Directory
=======
<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1541.1451px" preserveAspectRatio="none" style="width:2048px;height:1541px;background:#FFFFFF;" version="1.1" viewBox="0 0 2048 1541" width="2048.4786px" zoomAndPan="magnify"><defs/><g><rect fill="#DCDCDC" height="1257.5649" style="stroke:#000000;stroke-width:0.9572329983641038;" width="9.5723" x="290.5202" y="189.7041"/><rect fill="#DCDCDC" height="849.1629" style="stroke:#000000;stroke-width:0.9572329983641038;" width="9.5723" x="576.7329" y="598.1061"/><rect fill="#DCDCDC" height="32.344" style="stroke:#000000;stroke-width:0.9572329983641038;" width="9.5723" x="794.5034" y="222.0481"/><rect fill="#DCDCDC" height="51.2867" style="stroke:#000000;stroke-width:0.9572329983641038;" width="9.5723" x="794.5034" y="977.9855"/><rect fill="#DCDCDC" height="486.3118" style="stroke:#000000;stroke-width:0.9572329983641038;" width="9.5723" x="1139.1073" y="862.968"/><rect fill="#DCDCDC" height="846.4931" style="stroke:#000000;stroke-width:0.9572329983641038;" width="9.5723" x="1473.1816" y="535.1306"/><rect fill="#DCDCDC" height="826.7502" style="stroke:#000000;stroke-width:0.9572329983641038;" width="9.5723" x="1759.3943" y="470.4426"/><rect height="183.7065" style="stroke:#000000;stroke-width:1.4358494975461558;fill:none;" width="901.7135" x="9.5723" y="102.2744"/><rect height="267.3372" style="stroke:#000000;stroke-width:1.4358494975461558;fill:none;" width="2033.6415" x="9.5723" y="299.3821"/><rect height="731.0717" style="stroke:#000000;stroke-width:1.4358494975461558;fill:none;" width="1692.8666" x="183.3101" y="709.4966"/><line style="stroke:#000000;stroke-width:0.4786164991820519;fill:none;stroke-dasharray:5.0,5.0;" x1="63.1774" x2="63.1774" y1="86.0014" y2="1456.8413"/><line style="stroke:#000000;stroke-width:0.4786164991820519;fill:none;stroke-dasharray:5.0,5.0;" x1="295.3064" x2="295.3064" y1="86.0014" y2="1456.8413"/><line style="stroke:#000000;stroke-width:0.4786164991820519;fill:none;stroke-dasharray:5.0,5.0;" x1="581.0404" x2="581.0404" y1="86.0014" y2="1456.8413"/><line style="stroke:#000000;stroke-width:0.4786164991820519;fill:none;stroke-dasharray:5.0,5.0;" x1="799.2896" x2="799.2896" y1="86.0014" y2="1456.8413"/><line style="stroke:#000000;stroke-width:0.4786164991820519;fill:none;stroke-dasharray:5.0,5.0;" x1="1143.8934" x2="1143.8934" y1="86.0014" y2="1456.8413"/><line style="stroke:#000000;stroke-width:0.4786164991820519;fill:none;stroke-dasharray:5.0,5.0;" x1="1477.4891" x2="1477.4891" y1="86.0014" y2="1456.8413"/><line style="stroke:#000000;stroke-width:0.4786164991820519;fill:none;stroke-dasharray:5.0,5.0;" x1="1764.1804" x2="1764.1804" y1="86.0014" y2="1456.8413"/><line style="stroke:#000000;stroke-width:0.4786164991820519;fill:none;stroke-dasharray:5.0,5.0;" x1="1988.6516" x2="1988.6516" y1="86.0014" y2="1456.8413"/><text fill="#000000" font-family="Aapex" font-size="19.1447" lengthAdjust="spacing" textLength="83.2793" x="19.1447" y="81.4863">Nutzer A</text><ellipse cx="63.656" cy="14.4183" fill="#DCDCDC" rx="7.6579" ry="7.6579" style="stroke:#000000;stroke-width:0.4786164991820519;"/><path d="M63.656,22.0762 L63.656,47.9215 M51.212,29.7341 L76.1,29.7341 M63.656,47.9215 L51.212,62.28 M63.656,47.9215 L76.1,62.28 " fill="none" style="stroke:#000000;stroke-width:0.4786164991820519;"/><text fill="#000000" font-family="Aapex" font-size="19.1447" lengthAdjust="spacing" textLength="83.2793" x="19.1447" y="1473.6546">Nutzer A</text><ellipse cx="63.656" cy="1486.3061" fill="#DCDCDC" rx="7.6579" ry="7.6579" style="stroke:#000000;stroke-width:0.4786164991820519;"/><path d="M63.656,1493.964 L63.656,1519.8093 M51.212,1501.6219 L76.1,1501.6219 M63.656,1519.8093 L51.212,1534.1678 M63.656,1519.8093 L76.1,1534.1678 " fill="none" style="stroke:#000000;stroke-width:0.4786164991820519;"/><rect fill="#EFEFFF" height="35.6868" rx="2.3931" ry="2.3931" style="stroke:#000000;stroke-width:0.4786164991820519;" width="204.8479" x="192.8824" y="49.3573"/><text fill="#000000" font-family="Impact" font-size="19.1447" lengthAdjust="spacing" textLength="121.5686" x="234.5221" y="73.8285">TI-M Client A</text><rect fill="#EFEFFF" height="35.6868" rx="2.3931" ry="2.3931" style="stroke:#000000;stroke-width:0.4786164991820519;" width="204.8479" x="192.8824" y="1455.8841"/><text fill="#000000" font-family="Impact" font-size="19.1447" lengthAdjust="spacing" textLength="121.5686" x="234.5221" y="1480.3552">TI-M Client A</text><rect fill="#EFEFFF" height="80.258" rx="2.3931" ry="2.3931" style="stroke:#000000;stroke-width:0.4786164991820519;" width="211.5485" x="475.7448" y="4.7862"/><text fill="#000000" font-family="Impact" font-size="19.1447" lengthAdjust="spacing" textLength="198.1472" x="482.4454" y="29.2573">Messenger-Service A</text><text fill="#000000" font-family="Impact" font-size="19.1447" lengthAdjust="spacing" textLength="190.4894" x="486.2744" y="51.5429">(Messenger-Proxy +</text><text fill="#000000" font-family="Impact" font-size="19.1447" lengthAdjust="spacing" textLength="122.5258" x="520.2561" y="73.8285">Homeserver)</text><rect fill="#EFEFFF" height="80.258" rx="2.3931" ry="2.3931" style="stroke:#000000;stroke-width:0.4786164991820519;" width="211.5485" x="475.7448" y="1455.8841"/><text fill="#000000" font-family="Impact" font-size="19.1447" lengthAdjust="spacing" textLength="198.1472" x="482.4454" y="1480.3552">Messenger-Service A</text><text fill="#000000" font-family="Impact" font-size="19.1447" lengthAdjust="spacing" textLength="190.4894" x="486.2744" y="1502.6408">(Messenger-Proxy +</text><text fill="#000000" font-family="Impact" font-size="19.1447" lengthAdjust="spacing" textLength="122.5258" x="520.2561" y="1524.9264">Homeserver)</text><rect fill="#EFEFFF" height="35.6868" rx="2.3931" ry="2.3931" style="stroke:#000000;stroke-width:0.4786164991820519;" width="204.8479" x="696.8656" y="49.3573"/><text fill="#000000" font-family="Impact" font-size="19.1447" lengthAdjust="spacing" textLength="138.7988" x="729.8902" y="73.8285">FHIR-Directory</text><rect fill="#EFEFFF" height="35.6868" rx="2.3931" ry="2.3931" style="stroke:#000000;stroke-width:0.4786164991820519;" width="204.8479" x="696.8656" y="1455.8841"/><text fill="#000000" font-family="Impact" font-size="19.1447" lengthAdjust="spacing" textLength="138.7988" x="729.8902" y="1480.3552">FHIR-Directory</text><rect fill="#EFEFFF" height="35.6868" rx="2.3931" ry="2.3931" style="stroke:#000000;stroke-width:0.4786164991820519;" width="231.6504" x="1028.0682" y="49.3573"/><text fill="#000000" font-family="Impact" font-size="19.1447" lengthAdjust="spacing" textLength="218.2491" x="1034.7689" y="73.8285">Registrierungsdienst B</text><rect fill="#EFEFFF" height="35.6868" rx="2.3931" ry="2.3931" style="stroke:#000000;stroke-width:0.4786164991820519;" width="231.6504" x="1028.0682" y="1455.8841"/><text fill="#000000" font-family="Impact" font-size="19.1447" lengthAdjust="spacing" textLength="218.2491" x="1034.7689" y="1480.3552">Registrierungsdienst B</text><rect fill="#EFEFFF" height="80.258" rx="2.3931" ry="2.3931" style="stroke:#000000;stroke-width:0.4786164991820519;" width="211.5485" x="1372.1935" y="4.7862"/><text fill="#000000" font-family="Impact" font-size="19.1447" lengthAdjust="spacing" textLength="198.1472" x="1378.8941" y="29.2573">Messenger-Service B</text><text fill="#000000" font-family="Impact" font-size="19.1447" lengthAdjust="spacing" textLength="190.4894" x="1382.7231" y="51.5429">(Messenger-Proxy +</text><text fill="#000000" font-family="Impact" font-size="19.1447" lengthAdjust="spacing" textLength="122.5258" x="1416.7048" y="73.8285">Homeserver)</text><rect fill="#EFEFFF" height="80.258" rx="2.3931" ry="2.3931" style="stroke:#000000;stroke-width:0.4786164991820519;" width="211.5485" x="1372.1935" y="1455.8841"/><text fill="#000000" font-family="Impact" font-size="19.1447" lengthAdjust="spacing" textLength="198.1472" x="1378.8941" y="1480.3552">Messenger-Service B</text><text fill="#000000" font-family="Impact" font-size="19.1447" lengthAdjust="spacing" textLength="190.4894" x="1382.7231" y="1502.6408">(Messenger-Proxy +</text><text fill="#000000" font-family="Impact" font-size="19.1447" lengthAdjust="spacing" textLength="122.5258" x="1416.7048" y="1524.9264">Homeserver)</text><rect fill="#EFEFFF" height="35.6868" rx="2.3931" ry="2.3931" style="stroke:#000000;stroke-width:0.4786164991820519;" width="204.8479" x="1661.7565" y="49.3573"/><text fill="#000000" font-family="Impact" font-size="19.1447" lengthAdjust="spacing" textLength="121.5686" x="1703.3961" y="73.8285">TI-M Client B</text><rect fill="#EFEFFF" height="35.6868" rx="2.3931" ry="2.3931" style="stroke:#000000;stroke-width:0.4786164991820519;" width="204.8479" x="1661.7565" y="1455.8841"/><text fill="#000000" font-family="Impact" font-size="19.1447" lengthAdjust="spacing" textLength="121.5686" x="1703.3961" y="1480.3552">TI-M Client B</text><text fill="#000000" font-family="Aapex" font-size="19.1447" lengthAdjust="spacing" textLength="83.2793" x="1944.6188" y="81.4863">Nutzer B</text><ellipse cx="1989.1302" cy="14.4183" fill="#DCDCDC" rx="7.6579" ry="7.6579" style="stroke:#000000;stroke-width:0.4786164991820519;"/><path d="M1989.1302,22.0762 L1989.1302,47.9215 M1976.6861,29.7341 L2001.5742,29.7341 M1989.1302,47.9215 L1976.6861,62.28 M1989.1302,47.9215 L2001.5742,62.28 " fill="none" style="stroke:#000000;stroke-width:0.4786164991820519;"/><text fill="#000000" font-family="Aapex" font-size="19.1447" lengthAdjust="spacing" textLength="83.2793" x="1944.6188" y="1473.6546">Nutzer B</text><ellipse cx="1989.1302" cy="1486.3061" fill="#DCDCDC" rx="7.6579" ry="7.6579" style="stroke:#000000;stroke-width:0.4786164991820519;"/><path d="M1989.1302,1493.964 L1989.1302,1519.8093 M1976.6861,1501.6219 L2001.5742,1501.6219 M1989.1302,1519.8093 L1976.6861,1534.1678 M1989.1302,1519.8093 L2001.5742,1534.1678 " fill="none" style="stroke:#000000;stroke-width:0.4786164991820519;"/><rect fill="#DCDCDC" height="1257.5649" style="stroke:#000000;stroke-width:0.9572329983641038;" width="9.5723" x="290.5202" y="189.7041"/><rect fill="#DCDCDC" height="849.1629" style="stroke:#000000;stroke-width:0.9572329983641038;" width="9.5723" x="576.7329" y="598.1061"/><rect fill="#DCDCDC" height="32.344" style="stroke:#000000;stroke-width:0.9572329983641038;" width="9.5723" x="794.5034" y="222.0481"/><rect fill="#DCDCDC" height="51.2867" style="stroke:#000000;stroke-width:0.9572329983641038;" width="9.5723" x="794.5034" y="977.9855"/><rect fill="#DCDCDC" height="486.3118" style="stroke:#000000;stroke-width:0.9572329983641038;" width="9.5723" x="1139.1073" y="862.968"/><rect fill="#DCDCDC" height="846.4931" style="stroke:#000000;stroke-width:0.9572329983641038;" width="9.5723" x="1473.1816" y="535.1306"/><rect fill="#DCDCDC" height="826.7502" style="stroke:#000000;stroke-width:0.9572329983641038;" width="9.5723" x="1759.3943" y="470.4426"/><path d="M9.5723,102.2744 L70.8352,102.2744 L70.8352,109.1021 L61.2629,118.6745 L9.5723,118.6745 L9.5723,102.2744 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.4358494975461558;"/><rect fill="none" height="183.7065" style="stroke:#000000;stroke-width:1.4358494975461558;" width="901.7135" x="9.5723" y="102.2744"/><text fill="#000000" font-family="sans-serif" font-size="12.444" font-weight="bold" lengthAdjust="spacing" textLength="18.1874" x="23.9308" y="114.7824">alt</text><text fill="#000000" font-family="sans-serif" font-size="10.5296" font-weight="bold" lengthAdjust="spacing" textLength="4.7862" x="85.1937" y="119.534">[</text><text fill="#000000" font-family="sans-serif" font-size="15.3157" font-weight="bold" lengthAdjust="spacing" textLength="206.7623" x="89.9799" y="118.4052">Suche im FHIR-Directory</text><text fill="#000000" font-family="sans-serif" font-size="10.5296" font-weight="bold" lengthAdjust="spacing" textLength="4.7862" x="296.7422" y="119.534">]</text><polygon fill="#000000" points="279.0334,185.8752,288.6057,189.7041,279.0334,193.5331,282.8624,189.7041" style="stroke:#000000;stroke-width:0.9572329983641038;"/><line style="stroke:#000000;stroke-width:0.9572329983641038;" x1="63.656" x2="284.7768" y1="189.7041" y2="189.7041"/><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="208.6768" x="70.3566" y="165.0091">möchte TI-M Kontakt zum</text><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="116.7824" x="70.3566" y="183.9519">chatten finden</text><polygon fill="#000000" points="783.0166,218.2192,792.5889,222.0481,783.0166,225.8771,786.8455,222.0481" style="stroke:#000000;stroke-width:0.9572329983641038;"/><line style="stroke:#000000;stroke-width:0.9572329983641038;" x1="300.0925" x2="788.76" y1="222.0481" y2="222.0481"/><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="160.8151" x="306.7932" y="216.2959">FHIR search request</text><polygon fill="#000000" points="310.6221,250.5632,301.0498,254.3921,310.6221,258.2211,306.7932,254.3921" style="stroke:#000000;stroke-width:0.9572329983641038;"/><line style="stroke:#000000;stroke-width:0.9572329983641038;stroke-dasharray:2.0,2.0;" x1="304.8787" x2="798.3323" y1="254.3921" y2="254.3921"/><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="306.3146" x="486.2744" y="248.6399">FHIR response mit MXID von Nutzer B</text><path d="M9.5723,299.3821 L70.8352,299.3821 L70.8352,306.2099 L61.2629,315.7822 L9.5723,315.7822 L9.5723,299.3821 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.4358494975461558;"/><rect fill="none" height="267.3372" style="stroke:#000000;stroke-width:1.4358494975461558;" width="2033.6415" x="9.5723" y="299.3821"/><text fill="#000000" font-family="sans-serif" font-size="12.444" font-weight="bold" lengthAdjust="spacing" textLength="18.1874" x="23.9308" y="311.8902">alt</text><text fill="#000000" font-family="sans-serif" font-size="10.5296" font-weight="bold" lengthAdjust="spacing" textLength="4.7862" x="85.1937" y="316.6417">[</text><text fill="#000000" font-family="sans-serif" font-size="15.3157" font-weight="bold" lengthAdjust="spacing" textLength="485.3171" x="89.9799" y="315.513">Tauscht bei persönlichem Treffen MXID mit Nutzer B aus</text><text fill="#000000" font-family="sans-serif" font-size="10.5296" font-weight="bold" lengthAdjust="spacing" textLength="4.7862" x="575.297" y="316.6417">]</text><polygon fill="#000000" points="1977.6434,364.0402,1987.2157,367.8691,1977.6434,371.6981,1981.4723,367.8691" style="stroke:#000000;stroke-width:0.9572329983641038;"/><line style="stroke:#000000;stroke-width:0.9572329983641038;" x1="63.656" x2="1983.3868" y1="367.8691" y2="367.8691"/><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="280.4693" x="70.3566" y="362.1168">Kontaktdaten austauschen per App</text><polygon fill="#000000" points="279.0334,415.3269,288.6057,419.1559,279.0334,422.9848,282.8624,419.1559" style="stroke:#000000;stroke-width:0.9572329983641038;"/><line style="stroke:#000000;stroke-width:0.9572329983641038;" x1="63.656" x2="284.7768" y1="419.1559" y2="419.1559"/><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="154.1145" x="70.3566" y="394.4609">MXID von Nutzer B</text><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="201.9762" x="70.3566" y="413.4036">zu Kontakten hinzufügen</text><polygon fill="#000000" points="1779.4961,466.6137,1769.9238,470.4426,1779.4961,474.2716,1775.6672,470.4426" style="stroke:#000000;stroke-width:0.9572329983641038;"/><line style="stroke:#000000;stroke-width:0.9572329983641038;" x1="1773.7527" x2="1988.1729" y1="470.4426" y2="470.4426"/><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="153.1573" x="1780.4534" y="445.7476">MXID von Nutzer A</text><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="201.9762" x="1780.4534" y="464.6903">zu Kontakten hinzufügen</text><polygon fill="#000000" points="570.0323,498.9577,579.6046,502.7866,570.0323,506.6156,573.8612,502.7866" style="stroke:#000000;stroke-width:0.9572329983641038;"/><line style="stroke:#000000;stroke-width:0.9572329983641038;" x1="300.0925" x2="575.7756" y1="502.7866" y2="502.7866"/><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="241.2227" x="306.7932" y="497.0344">invite von Nutzer B ist erlaubt</text><polygon fill="#000000" points="1493.2835,531.3017,1483.7111,535.1306,1493.2835,538.9596,1489.4545,535.1306" style="stroke:#000000;stroke-width:0.9572329983641038;"/><line style="stroke:#000000;stroke-width:0.9572329983641038;" x1="1487.5401" x2="1758.437" y1="535.1306" y2="535.1306"/><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="240.2655" x="1512.4281" y="529.3784">invite von Nutzer A ist erlaubt</text><polygon fill="#000000" points="565.2461,594.2772,574.8184,598.1061,565.2461,601.935,569.075,598.1061" style="stroke:#000000;stroke-width:0.9572329983641038;"/><line style="stroke:#000000;stroke-width:0.9572329983641038;" x1="300.0925" x2="570.9895" y1="598.1061" y2="598.1061"/><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="96.6805" x="306.7932" y="592.3538">create room</text><polygon fill="#000000" points="310.6221,626.6212,301.0498,630.4501,310.6221,634.279,306.7932,630.4501" style="stroke:#000000;stroke-width:0.9572329983641038;"/><line style="stroke:#000000;stroke-width:0.9572329983641038;stroke-dasharray:2.0,2.0;" x1="304.8787" x2="575.7756" y1="630.4501" y2="630.4501"/><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="106.2529" x="463.7794" y="624.6978">room created</text><polygon fill="#000000" points="565.2461,658.9652,574.8184,662.7941,565.2461,666.623,569.075,662.7941" style="stroke:#000000;stroke-width:0.9572329983641038;"/><line style="stroke:#000000;stroke-width:0.9572329983641038;" x1="300.0925" x2="570.9895" y1="662.7941" y2="662.7941"/><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="253.6667" x="306.7932" y="657.0418">invite von Nutzer A an Nutzer B</text><polygon fill="#000000" points="1461.6948,691.3092,1471.2671,695.1381,1461.6948,698.967,1465.5237,695.1381" style="stroke:#000000;stroke-width:0.9572329983641038;"/><line style="stroke:#000000;stroke-width:0.9572329983641038;" x1="586.3052" x2="1467.4382" y1="695.1381" y2="695.1381"/><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="253.6667" x="593.0058" y="689.3858">invite von Nutzer A an Nutzer B</text><path d="M183.3101,709.4966 L244.573,709.4966 L244.573,716.3244 L235.0007,725.8967 L183.3101,725.8967 L183.3101,709.4966 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.4358494975461558;"/><rect fill="none" height="731.0717" style="stroke:#000000;stroke-width:1.4358494975461558;" width="1692.8666" x="183.3101" y="709.4966"/><text fill="#000000" font-family="sans-serif" font-size="12.444" font-weight="bold" lengthAdjust="spacing" textLength="18.1874" x="197.6686" y="722.0047">alt</text><text fill="#000000" font-family="sans-serif" font-size="10.5296" font-weight="bold" lengthAdjust="spacing" textLength="4.7862" x="258.9315" y="726.7563">[</text><text fill="#000000" font-family="sans-serif" font-size="15.3157" font-weight="bold" lengthAdjust="spacing" textLength="255.5812" x="263.7177" y="725.6275">invite von Nutzer A ist erlaubt</text><text fill="#000000" font-family="sans-serif" font-size="10.5296" font-weight="bold" lengthAdjust="spacing" textLength="4.7862" x="519.2989" y="726.7563">]</text><polygon fill="#000000" points="1747.9075,750.2239,1757.4798,754.0528,1747.9075,757.8817,1751.7364,754.0528" style="stroke:#000000;stroke-width:0.9572329983641038;"/><line style="stroke:#000000;stroke-width:0.9572329983641038;" x1="1482.7539" x2="1753.6509" y1="754.0528" y2="754.0528"/><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="253.6667" x="1489.4545" y="748.3005">invite von Nutzer A an Nutzer B</text><line style="stroke:#000000;stroke-width:0.9572329983641038;stroke-dasharray:2.0,2.0;" x1="183.3101" x2="1876.1767" y1="762.6679" y2="762.6679"/><text fill="#000000" font-family="sans-serif" font-size="10.5296" font-weight="bold" lengthAdjust="spacing" textLength="4.7862" x="188.0963" y="778.0131">[</text><text fill="#000000" font-family="sans-serif" font-size="15.3157" font-weight="bold" lengthAdjust="spacing" textLength="276.6403" x="192.8824" y="776.8843">invite von Nutzer A nicht erlaubt</text><text fill="#000000" font-family="sans-serif" font-size="10.5296" font-weight="bold" lengthAdjust="spacing" textLength="4.7862" x="469.5228" y="778.0131">]</text><polygon fill="#000000" points="1159.2092,859.1391,1149.6368,862.968,1159.2092,866.7969,1155.3802,862.968" style="stroke:#000000;stroke-width:0.9572329983641038;"/><line style="stroke:#000000;stroke-width:0.9572329983641038;" x1="1153.4658" x2="1472.2244" y1="862.968" y2="862.968"/><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="126.3548" x="1261.6331" y="800.3875">REST Operation</text><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="204.8479" x="1261.6331" y="819.3302">IsAllowedCommunication</text><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="165.6013" x="1261.6331" y="838.273">(src=MXID Nutzer A,</text><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="163.6868" x="1266.4193" y="857.2157">dst=MXID Nutzer B)</text><line style="stroke:#000000;stroke-width:0.9572329983641038;" x1="1148.6796" x2="1188.8834" y1="914.2547" y2="914.2547"/><line style="stroke:#000000;stroke-width:0.9572329983641038;" x1="1188.8834" x2="1188.8834" y1="914.2547" y2="926.6988"/><line style="stroke:#000000;stroke-width:0.9572329983641038;" x1="1149.6368" x2="1188.8834" y1="926.6988" y2="926.6988"/><polygon fill="#000000" points="1159.2092,922.8698,1149.6368,926.6988,1159.2092,930.5277,1155.3802,926.6988" style="stroke:#000000;stroke-width:0.9572329983641038;"/><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="246.9661" x="1155.3802" y="889.5597">hashA = hash(MXID Nutzer A),</text><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="244.0944" x="1155.3802" y="908.5025">hashB = hash(MXID Nutzer B)</text><polygon fill="#000000" points="814.6053,974.1566,805.033,977.9855,814.6053,981.8144,810.7763,977.9855" style="stroke:#000000;stroke-width:0.9572329983641038;"/><line style="stroke:#000000;stroke-width:0.9572329983641038;" x1="808.8619" x2="1138.15" y1="977.9855" y2="977.9855"/><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="126.3548" x="863.4242" y="953.2905">REST Operation</text><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="268.9825" x="863.4242" y="972.2332">WhereIs(hashA), WhereIs(hashB)</text><polygon fill="#000000" points="1127.6205,1025.4433,1137.1928,1029.2723,1127.6205,1033.1012,1131.4494,1029.2723" style="stroke:#000000;stroke-width:0.9572329983641038;"/><line style="stroke:#000000;stroke-width:0.9572329983641038;stroke-dasharray:2.0,2.0;" x1="799.2896" x2="1133.3639" y1="1029.2723" y2="1029.2723"/><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="306.3146" x="805.9902" y="1004.5772">Response (hashA is in PractitionerDir),</text><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="312.058" x="805.9902" y="1023.52">Response (hashB is in OrganizationDir)</text><line style="stroke:#000000;stroke-width:0.9572329983641038;" x1="1148.6796" x2="1188.8834" y1="1061.6163" y2="1061.6163"/><line style="stroke:#000000;stroke-width:0.9572329983641038;" x1="1188.8834" x2="1188.8834" y1="1061.6163" y2="1074.0603"/><line style="stroke:#000000;stroke-width:0.9572329983641038;" x1="1149.6368" x2="1188.8834" y1="1074.0603" y2="1074.0603"/><polygon fill="#000000" points="1159.2092,1070.2314,1149.6368,1074.0603,1159.2092,1077.8892,1155.3802,1074.0603" style="stroke:#000000;stroke-width:0.9572329983641038;"/><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="191.4466" x="1155.3802" y="1055.864">Cache Response (1 Tag)</text><line style="stroke:#000000;stroke-width:0.9572329983641038;" x1="1148.6796" x2="1188.8834" y1="1220.0608" y2="1220.0608"/><line style="stroke:#000000;stroke-width:0.9572329983641038;" x1="1188.8834" x2="1188.8834" y1="1220.0608" y2="1232.5048"/><line style="stroke:#000000;stroke-width:0.9572329983641038;" x1="1149.6368" x2="1188.8834" y1="1232.5048" y2="1232.5048"/><polygon fill="#000000" points="1159.2092,1228.6759,1149.6368,1232.5048,1159.2092,1236.3337,1155.3802,1232.5048" style="stroke:#000000;stroke-width:0.9572329983641038;"/><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="73.7069" x="1155.3802" y="1100.652">Decision[</text><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="282.3837" x="1155.3802" y="1119.5948">if hashB is in organization directory</text><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="75.6214" x="1155.3802" y="1138.5375">then true</text><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="311.1007" x="1155.3802" y="1157.4803">else if hashA is in practitioner directory</text><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="294.8278" x="1160.1664" y="1176.423">and hashB is in practitioner directory</text><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="75.6214" x="1155.3802" y="1195.3657">then true</text><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="80.4076" x="1155.3802" y="1214.3085">else false]</text><polygon fill="#000000" points="1461.6948,1261.0199,1471.2671,1264.8488,1461.6948,1268.6777,1465.5237,1264.8488" style="stroke:#000000;stroke-width:0.9572329983641038;"/><line style="stroke:#000000;stroke-width:0.9572329983641038;stroke-dasharray:2.0,2.0;" x1="1148.6796" x2="1467.4382" y1="1264.8488" y2="1264.8488"/><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="113.9107" x="1155.3802" y="1259.0965">Response true</text><polygon fill="#000000" points="1752.6936,1293.3639,1762.2659,1297.1928,1752.6936,1301.0217,1756.5226,1297.1928" style="stroke:#000000;stroke-width:0.9572329983641038;"/><line style="stroke:#000000;stroke-width:0.9572329983641038;" x1="1482.7539" x2="1758.437" y1="1297.1928" y2="1297.1928"/><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="253.6667" x="1489.4545" y="1291.4405">invite von Nutzer A an Nutzer B</text><line style="stroke:#000000;stroke-width:0.9572329983641038;stroke-dasharray:2.0,2.0;" x1="183.3101" x2="1876.1767" y1="1305.8079" y2="1305.8079"/><text fill="#000000" font-family="sans-serif" font-size="10.5296" font-weight="bold" lengthAdjust="spacing" textLength="4.7862" x="188.0963" y="1321.1531">[</text><text fill="#000000" font-family="sans-serif" font-size="15.3157" font-weight="bold" lengthAdjust="spacing" textLength="188.5749" x="192.8824" y="1320.0243">Invite ist nicht erlaubt</text><text fill="#000000" font-family="sans-serif" font-size="10.5296" font-weight="bold" lengthAdjust="spacing" textLength="4.7862" x="381.4573" y="1321.1531">]</text><polygon fill="#000000" points="1461.6948,1345.4508,1471.2671,1349.2797,1461.6948,1353.1087,1465.5237,1349.2797" style="stroke:#000000;stroke-width:0.9572329983641038;"/><line style="stroke:#000000;stroke-width:0.9572329983641038;stroke-dasharray:2.0,2.0;" x1="1143.8934" x2="1467.4382" y1="1349.2797" y2="1349.2797"/><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="117.7397" x="1150.5941" y="1343.5275">Response false</text><polygon fill="#000000" points="596.8348,1377.7948,587.2624,1381.6237,596.8348,1385.4527,593.0058,1381.6237" style="stroke:#000000;stroke-width:0.9572329983641038;"/><line style="stroke:#000000;stroke-width:0.9572329983641038;" x1="591.0914" x2="1477.0105" y1="1381.6237" y2="1381.6237"/><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="428.8404" x="1042.4267" y="1375.8715">ERROR: invite von Nutzer A an Nutzer B nicht erlaubt</text><polygon fill="#000000" points="310.6221,1429.0816,301.0498,1432.9105,310.6221,1436.7394,306.7932,1432.9105" style="stroke:#000000;stroke-width:0.9572329983641038;"/><line style="stroke:#000000;stroke-width:0.9572329983641038;stroke-dasharray:2.0,2.0;" x1="304.8787" x2="575.7756" y1="1432.9105" y2="1432.9105"/><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="222.0781" x="347.9542" y="1408.2155">ERROR: invite von Nutzer A</text><text fill="#000000" font-family="sans-serif" font-size="16.273" lengthAdjust="spacing" textLength="201.9762" x="347.9542" y="1427.1582">an Nutzer B nicht erlaubt</text><!--MD5=[802beef47d7faa34bae7f9e35efffa03]
@startuml
skinparam sequenceMessageAlign direction
skinparam minClassWidth 200
skinparam BoxPadding 1
skinparam sequenceReferenceHeaderBackgroundColor palegreen
scale max 2048 width

skinparam sequence {
ArrowColor black
ArrowFontSize 17
ActorBorderColor black
LifeLineBorderColor black
LifeLineBackgroundColor Gainsboro

ParticipantBorderColor Motivation
ParticipantBackgroundColor Motivation
ParticipantFontName Impact
ParticipantFontSize 20
ParticipantFontColor black
ParticipantBorderColor Black
ParticipantBackgroundColor MOTIVATION

ActorBackgroundColor Gainsboro
ActorFontColor black
ActorFontSize 20
ActorFontName Aapex
}

actor a as "Nutzer A"
participant cl as "TI-M Client A"
participant mp as "Messenger-Service A\n(Messenger-Proxy +\nHomeserver)"
participant fd as "FHIR-Directory"
participant rdb as "Registrierungsdienst B"
participant mpb as "Messenger-Service B\n(Messenger-Proxy +\nHomeserver)"
participant clb as "TI-M Client B"
actor b as "Nutzer B"

alt <size:16>Suche im FHIR-Directory</size>
|||
>>>>>>> master
a -> cl: möchte TI-M Kontakt zum\nchatten finden
activate cl
cl -> fd: FHIR search request
activate fd
fd - -> cl: FHIR response mit MXID von Nutzer B
deactivate fd
<<<<<<< HEAD
end
alt Tauscht bei persönlichem Treffen MXID mit Nutzer B aus
=======
|||
end
alt <size:16>Tauscht bei persönlichem Treffen MXID mit Nutzer B aus</size>
|||
>>>>>>> master
a -> b: Kontaktdaten austauschen per App
a -> cl: MXID von Nutzer B\nzu Kontakten hinzufügen
b -> clb: MXID von Nutzer A\nzu Kontakten hinzufügen
activate clb
<<<<<<< HEAD
cl -> mp: POST /_matrix/client/r0/user/{userId}/openid/request_token
activate mp
mp - -> cl: HTTP 200 OK, Result body {"access_token": "Matrix-OpenID-Token",...,\n"matrix_server_name": "example.com",...}
deactivate mp
cl -> rd: invite von Nutzer B ist erlaubt\n(Auth Header mit Matrix-OpenID-Token)
activate rd
rd->rd: verify that the token comes\nfrom own Messenger-Service
rd -> mp: GET /openid/userinfo/\nrequest header, Authorization: Bearer Matrix-OpenID-Token
mp - -> rd: HTTP 200 OK\n(Result Body MXID des Nutzers)activate rd
rd - -> cl: HTTP 200 OK
deactivate rd
clb -> mpb: POST /_matrix/client/r0/user/{userId}/openid/request_token
activate mpb
mpb - -> clb: HTTP 200 OK, Result body {"access_token": "Matrix-OpenID-Token",\n..., "matrix_server_name": "example.com",...}
deactivate mpb
clb -> rdb: invite von Nutzer A ist erlaubt\n(Auth Header mit Matrix-OpenID-Token)
activate rdb
rdb->rdb: verify that the token comes\nfrom own Messenger-Service
rdb -> mpb: GET /openid/userinfo/\nrequest header, Authorization: Bearer Matrix-OpenID-Token
mpb - -> rdb: HTTP 200 OK\n(Result Body MXID des Nutzers)activate rd
rdb - -> clb: HTTP 200 OK
deactivate rdb
=======
cl -> mp: invite von Nutzer B ist erlaubt
clb -> mpb: invite von Nutzer A ist erlaubt
|||
activate mpb
>>>>>>> master
end
cl -> mp: create room
activate mp
mp - -> cl: room created

' Invite
cl -> mp: invite von Nutzer A an Nutzer B
mp -> mpb: invite von Nutzer A an Nutzer B
<<<<<<< HEAD
activate mpb
mpb -> rdb: REST Operation\nIsAllowedCommunication(src=MXID Nutzer A,\n dst=MXID Nutzer B)
activate rdb
alt invite von Nutzer A ist erlaubt
rdb - -> mpb: Response true
mpb -> clb: invite von Nutzer A an Nutzer B
else invite von Nutzer A nicht erlaubt
=======
alt <size:16>invite von Nutzer A ist erlaubt</size>
mpb -> clb: invite von Nutzer A an Nutzer B
else <size:16>invite von Nutzer A nicht erlaubt</size>
mpb -> rdb: REST Operation\nIsAllowedCommunication\n(src=MXID Nutzer A,\n dst=MXID Nutzer B)
activate rdb
>>>>>>> master
rdb -> rdb: hashA = hash(MXID Nutzer A),\nhashB = hash(MXID Nutzer B)
rdb -> fd: REST Operation\nWhereIs(hashA), WhereIs(hashB)
activate fd
fd - -> rdb: Response (hashA is in PractitionerDir),\nResponse (hashB is in OrganizationDir)
deactivate fd
rdb -> rdb: Cache Response (1 Tag)
<<<<<<< HEAD
rdb -> rdb: Decision[\nif hashB is in organization directory then true\nelse if hashA is in practitioner directory\n and hashB is in practitioner directory then true\nelse false]
rdb - -> mpb: Response true
mpb -> clb: invite von Nutzer A an Nutzer B
deactivate clb
else Invite ist nicht erlaubt
=======
rdb -> rdb: Decision[\nif hashB is in organization directory\nthen true\nelse if hashA is in practitioner directory\n and hashB is in practitioner directory\nthen true\nelse false]
rdb - -> mpb: Response true
mpb -> clb: invite von Nutzer A an Nutzer B
deactivate clb
else <size:16>Invite ist nicht erlaubt</size>
>>>>>>> master
rdb - -> mpb: Response false
deactivate rdb
mpb -> mp: ERROR: invite von Nutzer A an Nutzer B nicht erlaubt
deactivate mpb
<<<<<<< HEAD
mp - -> cl: ERROR: invite von Nutzer A an Nutzer B nicht erlaubt
=======
mp - -> cl: ERROR: invite von Nutzer A\nan Nutzer B nicht erlaubt
>>>>>>> master
end
deactivate mp
deactivate cl
@enduml

<<<<<<< HEAD
@startuml TI-Messenger communication control without PASSporT
!pragma layout smetana
skinparam monochrome true

actor a as "Nutzer A"
participant cl as "TI-M Client A"
box TI-Messenger Anbieter A #GhostWhite
participant mp as "Messenger-Service A\n(Messenger-Proxy +\nHomeserver)"
participant rd as "Registrierungsdienst A"
end box
participant fd as "FHIR-Directory"
box TI-Messenger Anbieter B7 #GhostWhite
participant rdb as "Registrierungsdienst B"
participant mpb as "Messenger-Service B\n(Messenger-Proxy +\nHomeserver)"
end box
participant clb as "TI-M Client B"
actor b as "Nutzer B"

alt Suche im FHIR-Directory
=======
@startuml
skinparam sequenceMessageAlign direction
skinparam minClassWidth 200
skinparam BoxPadding 1
skinparam sequenceReferenceHeaderBackgroundColor palegreen
scale max 2048 width

skinparam sequence {
ArrowColor black
ArrowFontSize 17
ActorBorderColor black
LifeLineBorderColor black
LifeLineBackgroundColor Gainsboro

ParticipantBorderColor Motivation
ParticipantBackgroundColor Motivation
ParticipantFontName Impact
ParticipantFontSize 20
ParticipantFontColor black
ParticipantBorderColor Black
ParticipantBackgroundColor MOTIVATION

ActorBackgroundColor Gainsboro
ActorFontColor black
ActorFontSize 20
ActorFontName Aapex
}

actor a as "Nutzer A"
participant cl as "TI-M Client A"
participant mp as "Messenger-Service A\n(Messenger-Proxy +\nHomeserver)"
participant fd as "FHIR-Directory"
participant rdb as "Registrierungsdienst B"
participant mpb as "Messenger-Service B\n(Messenger-Proxy +\nHomeserver)"
participant clb as "TI-M Client B"
actor b as "Nutzer B"

alt <size:16>Suche im FHIR-Directory</size>
|||
>>>>>>> master
a -> cl: möchte TI-M Kontakt zum\nchatten finden
activate cl
cl -> fd: FHIR search request
activate fd
fd - -> cl: FHIR response mit MXID von Nutzer B
deactivate fd
<<<<<<< HEAD
end
alt Tauscht bei persönlichem Treffen MXID mit Nutzer B aus
=======
|||
end
alt <size:16>Tauscht bei persönlichem Treffen MXID mit Nutzer B aus</size>
|||
>>>>>>> master
a -> b: Kontaktdaten austauschen per App
a -> cl: MXID von Nutzer B\nzu Kontakten hinzufügen
b -> clb: MXID von Nutzer A\nzu Kontakten hinzufügen
activate clb
<<<<<<< HEAD
cl -> mp: POST /_matrix/client/r0/user/{userId}/openid/request_token
activate mp
mp - -> cl: HTTP 200 OK, Result body {"access_token": "Matrix-OpenID-Token",...,\n"matrix_server_name": "example.com",...}
deactivate mp
cl -> rd: invite von Nutzer B ist erlaubt\n(Auth Header mit Matrix-OpenID-Token)
activate rd
rd->rd: verify that the token comes\nfrom own Messenger-Service
rd -> mp: GET /openid/userinfo/\nrequest header, Authorization: Bearer Matrix-OpenID-Token
mp - -> rd: HTTP 200 OK\n(Result Body MXID des Nutzers)activate rd
rd - -> cl: HTTP 200 OK
deactivate rd
clb -> mpb: POST /_matrix/client/r0/user/{userId}/openid/request_token
activate mpb
mpb - -> clb: HTTP 200 OK, Result body {"access_token": "Matrix-OpenID-Token",\n..., "matrix_server_name": "example.com",...}
deactivate mpb
clb -> rdb: invite von Nutzer A ist erlaubt\n(Auth Header mit Matrix-OpenID-Token)
activate rdb
rdb->rdb: verify that the token comes\nfrom own Messenger-Service
rdb -> mpb: GET /openid/userinfo/\nrequest header, Authorization: Bearer Matrix-OpenID-Token
mpb - -> rdb: HTTP 200 OK\n(Result Body MXID des Nutzers)activate rd
rdb - -> clb: HTTP 200 OK
deactivate rdb
=======
cl -> mp: invite von Nutzer B ist erlaubt
clb -> mpb: invite von Nutzer A ist erlaubt
|||
activate mpb
>>>>>>> master
end
cl -> mp: create room
activate mp
mp - -> cl: room created

cl -> mp: invite von Nutzer A an Nutzer B
mp -> mpb: invite von Nutzer A an Nutzer B
<<<<<<< HEAD
activate mpb
mpb -> rdb: REST Operation\nIsAllowedCommunication(src=MXID Nutzer A,\n dst=MXID Nutzer B)
activate rdb
alt invite von Nutzer A ist erlaubt
rdb - -> mpb: Response true
mpb -> clb: invite von Nutzer A an Nutzer B
else invite von Nutzer A nicht erlaubt
=======
alt <size:16>invite von Nutzer A ist erlaubt</size>
mpb -> clb: invite von Nutzer A an Nutzer B
else <size:16>invite von Nutzer A nicht erlaubt</size>
mpb -> rdb: REST Operation\nIsAllowedCommunication\n(src=MXID Nutzer A,\n dst=MXID Nutzer B)
activate rdb
>>>>>>> master
rdb -> rdb: hashA = hash(MXID Nutzer A),\nhashB = hash(MXID Nutzer B)
rdb -> fd: REST Operation\nWhereIs(hashA), WhereIs(hashB)
activate fd
fd - -> rdb: Response (hashA is in PractitionerDir),\nResponse (hashB is in OrganizationDir)
deactivate fd
rdb -> rdb: Cache Response (1 Tag)
<<<<<<< HEAD
rdb -> rdb: Decision[\nif hashB is in organization directory then true\nelse if hashA is in practitioner directory\n and hashB is in practitioner directory then true\nelse false]
rdb - -> mpb: Response true
mpb -> clb: invite von Nutzer A an Nutzer B
deactivate clb
else Invite ist nicht erlaubt
=======
rdb -> rdb: Decision[\nif hashB is in organization directory\nthen true\nelse if hashA is in practitioner directory\n and hashB is in practitioner directory\nthen true\nelse false]
rdb - -> mpb: Response true
mpb -> clb: invite von Nutzer A an Nutzer B
deactivate clb
else <size:16>Invite ist nicht erlaubt</size>
>>>>>>> master
rdb - -> mpb: Response false
deactivate rdb
mpb -> mp: ERROR: invite von Nutzer A an Nutzer B nicht erlaubt
deactivate mpb
<<<<<<< HEAD
mp - -> cl: ERROR: invite von Nutzer A an Nutzer B nicht erlaubt
=======
mp - -> cl: ERROR: invite von Nutzer A\nan Nutzer B nicht erlaubt
>>>>>>> master
end
deactivate mp
deactivate cl
@enduml

PlantUML version 1.2022.5(Sat Apr 30 10:55:52 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>