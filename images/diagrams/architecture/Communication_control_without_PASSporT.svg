<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1286.4583px" preserveAspectRatio="none" style="width:1960px;height:1286px;background:#FFFFFF;" version="1.1" viewBox="0 0 1960 1286" width="1960.4167px" zoomAndPan="magnify"><defs><filter height="300%" id="f1ma20w0qydkeb" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0833333333333335"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.166666666666667" dy="4.166666666666667" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1ma20w0qydkeb)" height="1023.3236" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="245.3125" y="165.3076"/><rect fill="#FFFFFF" filter="url(#f1ma20w0qydkeb)" height="709.3018" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="629.6875" y="479.3294"/><rect fill="#FFFFFF" filter="url(#f1ma20w0qydkeb)" height="30.3467" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="785.9375" y="195.6543"/><rect fill="#FFFFFF" filter="url(#f1ma20w0qydkeb)" height="46.11" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="785.9375" y="808.9111"/><rect fill="#FFFFFF" filter="url(#f1ma20w0qydkeb)" height="486.5234" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="1079.6875" y="703.1494"/><rect fill="#FFFFFF" filter="url(#f1ma20w0qydkeb)" height="746.9401" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="1418.2292" y="441.6911"/><rect fill="#FFFFFF" filter="url(#f1ma20w0qydkeb)" height="807.6335" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="1663.0208" y="380.9977"/><rect fill="#FFFFFF" filter="url(#f1ma20w0qydkeb)" height="124.6501" style="stroke:#000000;stroke-width:2.0833333333333335;" width="851.5625" x="10.4167" y="109.6842"/><rect fill="#FFFFFF" filter="url(#f1ma20w0qydkeb)" height="201.1068" style="stroke:#000000;stroke-width:2.0833333333333335;" width="1892.1875" x="10.4167" y="248.9176"/><rect fill="#FFFFFF" filter="url(#f1ma20w0qydkeb)" height="595.3451" style="stroke:#000000;stroke-width:2.0833333333333335;" width="1759.8958" x="186.4583" y="585.9945"/><rect fill="#FFFFFF" height="440.6901" style="stroke:none;stroke-width:1.0416666666666667;" width="1759.8958" x="186.4583" y="634.1878"/><rect fill="#FFFFFF" height="106.4616" style="stroke:none;stroke-width:1.0416666666666667;" width="1759.8958" x="186.4583" y="1074.8779"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="54.1667" x2="54.1667" y1="91.9759" y2="1199.0479"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="250" x2="250" y1="91.9759" y2="1199.0479"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="634.8958" x2="634.8958" y1="91.9759" y2="1199.0479"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="791.1458" x2="791.1458" y1="91.9759" y2="1199.0479"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="1084.8958" x2="1084.8958" y1="91.9759" y2="1199.0479"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="1422.9167" x2="1422.9167" y1="91.9759" y2="1199.0479"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="1668.2292" x2="1668.2292" y1="91.9759" y2="1199.0479"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="1857.8125" x2="1857.8125" y1="91.9759" y2="1199.0479"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="1919.2708" x2="1919.2708" y1="91.9759" y2="1199.0479"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="61.4583" x="20.8333" y="88.5366">Nutzer A</text><ellipse cx="54.6875" cy="15.625" fill="#F8F8F8" filter="url(#f1ma20w0qydkeb)" rx="8.3333" ry="8.3333" style="stroke:#383838;stroke-width:2.0833333333333335;"/><path d="M54.6875,23.9583 L54.6875,52.0833 M41.1458,32.2917 L68.2292,32.2917 M54.6875,52.0833 L41.1458,67.7083 M54.6875,52.0833 L68.2292,67.7083 " fill="none" filter="url(#f1ma20w0qydkeb)" style="stroke:#383838;stroke-width:2.0833333333333335;"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="61.4583" x="20.8333" y="1211.5428">Nutzer A</text><ellipse cx="54.6875" cy="1225.3988" fill="#F8F8F8" filter="url(#f1ma20w0qydkeb)" rx="8.3333" ry="8.3333" style="stroke:#383838;stroke-width:2.0833333333333335;"/><path d="M54.6875,1233.7321 L54.6875,1261.8571 M41.1458,1242.0654 L68.2292,1242.0654 M54.6875,1261.8571 L41.1458,1277.4821 M54.6875,1261.8571 L68.2292,1277.4821 " fill="none" filter="url(#f1ma20w0qydkeb)" style="stroke:#383838;stroke-width:2.0833333333333335;"/><rect fill="#F8F8F8" filter="url(#f1ma20w0qydkeb)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="103.125" x="196.875" y="55.2083"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="88.5417" x="204.1667" y="76.0366">TI-M Client A</text><rect fill="#F8F8F8" filter="url(#f1ma20w0qydkeb)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="103.125" x="196.875" y="1198.0062"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="88.5417" x="204.1667" y="1218.8344">TI-M Client A</text><rect fill="#F8F8F8" filter="url(#f1ma20w0qydkeb)" height="65.5111" style="stroke:#383838;stroke-width:1.5625;" width="166.6667" x="549.4792" y="21.2565"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="152.0833" x="556.7708" y="42.0848">Messenger-Service A</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="146.875" x="559.375" y="59.0607">(Messenger-Proxy +</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="92.7083" x="586.4583" y="76.0366">Homeserver)</text><rect fill="#F8F8F8" filter="url(#f1ma20w0qydkeb)" height="65.5111" style="stroke:#383838;stroke-width:1.5625;" width="166.6667" x="549.4792" y="1198.0062"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="152.0833" x="556.7708" y="1218.8344">Messenger-Service A</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="146.875" x="559.375" y="1235.8103">(Messenger-Proxy +</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="92.7083" x="586.4583" y="1252.7863">Homeserver)</text><rect fill="#F8F8F8" filter="url(#f1ma20w0qydkeb)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="116.6667" x="730.7292" y="55.2083"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="102.0833" x="738.0208" y="76.0366">FHIR-Directory</text><rect fill="#F8F8F8" filter="url(#f1ma20w0qydkeb)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="116.6667" x="730.7292" y="1198.0062"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="102.0833" x="738.0208" y="1218.8344">FHIR-Directory</text><rect fill="#F8F8F8" filter="url(#f1ma20w0qydkeb)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="179.1667" x="993.2292" y="55.2083"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="164.5833" x="1000.5208" y="76.0366">Registrierungsdienst B</text><rect fill="#F8F8F8" filter="url(#f1ma20w0qydkeb)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="179.1667" x="993.2292" y="1198.0062"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="164.5833" x="1000.5208" y="1218.8344">Registrierungsdienst B</text><rect fill="#F8F8F8" filter="url(#f1ma20w0qydkeb)" height="65.5111" style="stroke:#383838;stroke-width:1.5625;" width="167.7083" x="1337.5" y="21.2565"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="153.125" x="1344.7917" y="42.0848">Messenger-Service B</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="146.875" x="1347.9167" y="59.0607">(Messenger-Proxy +</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="92.7083" x="1375" y="76.0366">Homeserver)</text><rect fill="#F8F8F8" filter="url(#f1ma20w0qydkeb)" height="65.5111" style="stroke:#383838;stroke-width:1.5625;" width="167.7083" x="1337.5" y="1198.0062"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="153.125" x="1344.7917" y="1218.8344">Messenger-Service B</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="146.875" x="1347.9167" y="1235.8103">(Messenger-Proxy +</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="92.7083" x="1375" y="1252.7863">Homeserver)</text><rect fill="#F8F8F8" filter="url(#f1ma20w0qydkeb)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="104.1667" x="1614.0625" y="55.2083"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="89.5833" x="1621.3542" y="76.0366">TI-M Client B</text><rect fill="#F8F8F8" filter="url(#f1ma20w0qydkeb)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="104.1667" x="1614.0625" y="1198.0062"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="89.5833" x="1621.3542" y="1218.8344">TI-M Client B</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="62.5" x="1823.4375" y="88.5366">Nutzer B</text><ellipse cx="1857.8125" cy="15.625" fill="#F8F8F8" filter="url(#f1ma20w0qydkeb)" rx="8.3333" ry="8.3333" style="stroke:#383838;stroke-width:2.0833333333333335;"/><path d="M1857.8125,23.9583 L1857.8125,52.0833 M1844.2708,32.2917 L1871.3542,32.2917 M1857.8125,52.0833 L1844.2708,67.7083 M1857.8125,52.0833 L1871.3542,67.7083 " fill="none" filter="url(#f1ma20w0qydkeb)" style="stroke:#383838;stroke-width:2.0833333333333335;"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="62.5" x="1823.4375" y="1211.5428">Nutzer B</text><ellipse cx="1857.8125" cy="1225.3988" fill="#F8F8F8" filter="url(#f1ma20w0qydkeb)" rx="8.3333" ry="8.3333" style="stroke:#383838;stroke-width:2.0833333333333335;"/><path d="M1857.8125,1233.7321 L1857.8125,1261.8571 M1844.2708,1242.0654 L1871.3542,1242.0654 M1857.8125,1261.8571 L1844.2708,1277.4821 M1857.8125,1261.8571 L1871.3542,1277.4821 " fill="none" filter="url(#f1ma20w0qydkeb)" style="stroke:#383838;stroke-width:2.0833333333333335;"/><rect fill="#F8F8F8" filter="url(#f1ma20w0qydkeb)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="29.1667" x="1902.6042" y="55.2083"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="14.5833" x="1909.8958" y="76.0366">rd</text><rect fill="#F8F8F8" filter="url(#f1ma20w0qydkeb)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="29.1667" x="1902.6042" y="1198.0062"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="14.5833" x="1909.8958" y="1218.8344">rd</text><rect fill="#FFFFFF" filter="url(#f1ma20w0qydkeb)" height="1023.3236" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="245.3125" y="165.3076"/><rect fill="#FFFFFF" filter="url(#f1ma20w0qydkeb)" height="709.3018" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="629.6875" y="479.3294"/><rect fill="#FFFFFF" filter="url(#f1ma20w0qydkeb)" height="30.3467" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="785.9375" y="195.6543"/><rect fill="#FFFFFF" filter="url(#f1ma20w0qydkeb)" height="46.11" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="785.9375" y="808.9111"/><rect fill="#FFFFFF" filter="url(#f1ma20w0qydkeb)" height="486.5234" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="1079.6875" y="703.1494"/><rect fill="#FFFFFF" filter="url(#f1ma20w0qydkeb)" height="746.9401" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="1418.2292" y="441.6911"/><rect fill="#FFFFFF" filter="url(#f1ma20w0qydkeb)" height="807.6335" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="1663.0208" y="380.9977"/><path d="M10.4167,109.6842 L77.0833,109.6842 L77.0833,116.9759 L66.6667,127.3926 L10.4167,127.3926 L10.4167,109.6842 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0416666666666667;"/><rect fill="none" height="124.6501" style="stroke:#000000;stroke-width:2.0833333333333335;" width="851.5625" x="10.4167" y="109.6842"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" font-weight="bold" lengthAdjust="spacing" textLength="19.7917" x="26.0417" y="123.2956">alt</text><text fill="#000000" font-family="sans-serif" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="170.8333" x="92.7083" y="122.4035">[Suche im FHIR-Directory]</text><polygon fill="#383838" points="232.8125,161.141,243.2292,165.3076,232.8125,169.4743,236.9792,165.3076" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="54.6875" x2="239.0625" y1="165.3076" y2="165.3076"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="170.8333" x="61.9792" y="144.2673">möchte TI-M Kontakt zum</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="95.8333" x="61.9792" y="160.0306">chatten finden</text><polygon fill="#383838" points="773.4375,191.4876,783.8542,195.6543,773.4375,199.821,777.6042,195.6543" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="255.7292" x2="779.6875" y1="195.6543" y2="195.6543"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="133.3333" x="263.0208" y="190.3773">FHIR search request</text><polygon fill="#383838" points="267.1875,221.8343,256.7708,226.001,267.1875,230.1676,263.0208,226.001" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="260.9375" x2="790.1042" y1="226.001" y2="226.001"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="248.9583" x="273.4375" y="220.724">FHIR response mit MXID von Nutzer B</text><path d="M10.4167,248.9176 L77.0833,248.9176 L77.0833,256.2093 L66.6667,266.626 L10.4167,266.626 L10.4167,248.9176 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0416666666666667;"/><rect fill="none" height="201.1068" style="stroke:#000000;stroke-width:2.0833333333333335;" width="1892.1875" x="10.4167" y="248.9176"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" font-weight="bold" lengthAdjust="spacing" textLength="19.7917" x="26.0417" y="262.529">alt</text><text fill="#000000" font-family="sans-serif" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="387.5" x="92.7083" y="261.6369">[Tauscht bei persönlichem Treffen MXID mit Nutzer B aus]</text><polygon fill="#383838" points="1845.3125,284.611,1855.7292,288.7777,1845.3125,292.9443,1849.4792,288.7777" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="54.6875" x2="1851.5625" y1="288.7777" y2="288.7777"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="235.4167" x="61.9792" y="283.5007">Kontaktdaten austauschen per App</text><polygon fill="#383838" points="232.8125,330.721,243.2292,334.8877,232.8125,339.0544,236.9792,334.8877" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="54.6875" x2="239.0625" y1="334.8877" y2="334.8877"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="123.9583" x="61.9792" y="313.8474">MXID von Nutzer B</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="164.5833" x="61.9792" y="329.6107">zu Kontakten hinzufügen</text><polygon fill="#383838" points="1684.8958,376.8311,1674.4792,380.9977,1684.8958,385.1644,1680.7292,380.9977" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="1678.6458" x2="1856.7708" y1="380.9977" y2="380.9977"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="123.9583" x="1691.1458" y="359.9574">MXID von Nutzer A</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="164.5833" x="1691.1458" y="375.7207">zu Kontakten hinzufügen</text><polygon fill="#383838" points="622.3958,407.1777,632.8125,411.3444,622.3958,415.5111,626.5625,411.3444" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="255.7292" x2="628.6458" y1="411.3444" y2="411.3444"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="196.875" x="263.0208" y="406.0674">invite von Nutzer B ist erlaubt</text><polygon fill="#383838" points="1440.1042,437.5244,1429.6875,441.6911,1440.1042,445.8577,1435.9375,441.6911" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="1433.8542" x2="1661.9792" y1="441.6911" y2="441.6911"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="196.875" x="1446.3542" y="436.4141">invite von Nutzer A ist erlaubt</text><polygon fill="#383838" points="617.1875,475.1628,627.6042,479.3294,617.1875,483.4961,621.3542,479.3294" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="255.7292" x2="623.4375" y1="479.3294" y2="479.3294"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="82.2917" x="263.0208" y="474.0524">create room</text><polygon fill="#383838" points="267.1875,505.5094,256.7708,509.6761,267.1875,513.8428,263.0208,509.6761" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="260.9375" x2="628.6458" y1="509.6761" y2="509.6761"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="90.625" x="273.4375" y="504.3991">room created</text><polygon fill="#383838" points="617.1875,535.8561,627.6042,540.0228,617.1875,544.1895,621.3542,540.0228" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="255.7292" x2="623.4375" y1="540.0228" y2="540.0228"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="209.375" x="263.0208" y="534.7458">invite von Nutzer A an Nutzer B</text><polygon fill="#383838" points="1405.7292,566.2028,1416.1458,570.3695,1405.7292,574.5361,1409.8958,570.3695" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="640.1042" x2="1411.9792" y1="570.3695" y2="570.3695"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="209.375" x="647.3958" y="565.0925">invite von Nutzer A an Nutzer B</text><path d="M186.4583,585.9945 L253.125,585.9945 L253.125,593.2861 L242.7083,603.7028 L186.4583,603.7028 L186.4583,585.9945 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0416666666666667;"/><rect fill="none" height="595.3451" style="stroke:#000000;stroke-width:2.0833333333333335;" width="1759.8958" x="186.4583" y="585.9945"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" font-weight="bold" lengthAdjust="spacing" textLength="19.7917" x="202.0833" y="599.6058">alt</text><text fill="#000000" font-family="sans-serif" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="209.375" x="268.75" y="598.7137">[invite von Nutzer A ist erlaubt]</text><polygon fill="#383838" points="1650.5208,621.6878,1660.9375,625.8545,1650.5208,630.0212,1654.6875,625.8545" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="1428.6458" x2="1656.7708" y1="625.8545" y2="625.8545"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="209.375" x="1435.9375" y="620.5775">invite von Nutzer A an Nutzer B</text><line style="stroke:#000000;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="186.4583" x2="1946.3542" y1="635.2295" y2="635.2295"/><text fill="#000000" font-family="sans-serif" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="226.0417" x="191.6667" y="645.8654">[invite von Nutzer A nicht erlaubt]</text><polygon fill="#383838" points="1101.5625,698.9827,1091.1458,703.1494,1101.5625,707.3161,1097.3958,703.1494" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="1095.3125" x2="1417.1875" y1="703.1494" y2="703.1494"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="103.125" x="1107.8125" y="666.3457">REST Operation</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="302.0833" x="1107.8125" y="682.1091">IsAllowedCommunication(src=MXID Nutzer A,</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="133.3333" x="1111.9792" y="697.8724">dst=MXID Nutzer B)</text><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="1090.1042" x2="1133.8542" y1="749.2594" y2="749.2594"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="1133.8542" x2="1133.8542" y1="749.2594" y2="762.8011"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="1091.1458" x2="1133.8542" y1="762.8011" y2="762.8011"/><polygon fill="#383838" points="1101.5625,758.6344,1091.1458,762.8011,1101.5625,766.9678,1097.3958,762.8011" style="stroke:#383838;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="204.1667" x="1097.3958" y="728.2191">hashA = hash(MXID Nutzer A),</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="200" x="1097.3958" y="743.9824">hashB = hash(MXID Nutzer B)</text><polygon fill="#383838" points="807.8125,804.7445,797.3958,808.9111,807.8125,813.0778,803.6458,808.9111" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="801.5625" x2="1078.6458" y1="808.9111" y2="808.9111"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="103.125" x="814.0625" y="787.8708">REST Operation</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="216.6667" x="814.0625" y="803.6341">WhereIs(hashA), WhereIs(hashB)</text><polygon fill="#383838" points="1067.1875,850.8545,1077.6042,855.0212,1067.1875,859.1878,1071.3542,855.0212" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="791.1458" x2="1073.4375" y1="855.0212" y2="855.0212"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="254.1667" x="798.4375" y="833.9808">Response (hashA is in PractitionerDir),</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="258.3333" x="798.4375" y="849.7442">Response (hashB is in OrganizationDir)</text><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="1090.1042" x2="1133.8542" y1="885.3678" y2="885.3678"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="1133.8542" x2="1133.8542" y1="885.3678" y2="898.9095"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="1091.1458" x2="1133.8542" y1="898.9095" y2="898.9095"/><polygon fill="#383838" points="1101.5625,894.7428,1091.1458,898.9095,1101.5625,903.0762,1097.3958,898.9095" style="stroke:#383838;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="161.4583" x="1097.3958" y="880.0908">Cache Response (1 Tag)</text><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="1090.1042" x2="1133.8542" y1="992.3096" y2="992.3096"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="1133.8542" x2="1133.8542" y1="992.3096" y2="1005.8512"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="1091.1458" x2="1133.8542" y1="1005.8512" y2="1005.8512"/><polygon fill="#383838" points="1101.5625,1001.6846,1091.1458,1005.8512,1101.5625,1010.0179,1097.3958,1005.8512" style="stroke:#383838;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="61.4583" x="1097.3958" y="923.9792">Decision[</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="297.9167" x="1097.3958" y="939.7425">if hashB is in organization directory then true</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="257.2917" x="1097.3958" y="955.5059">else if hashA is in practitioner directory</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="309.375" x="1101.5625" y="971.2692">and hashB is in practitioner directory then true</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="67.7083" x="1097.3958" y="987.0326">else false]</text><polygon fill="#383838" points="1405.7292,1032.0313,1416.1458,1036.1979,1405.7292,1040.3646,1409.8958,1036.1979" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="1090.1042" x2="1411.9792" y1="1036.1979" y2="1036.1979"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="95.8333" x="1097.3958" y="1030.9209">Response true</text><polygon fill="#383838" points="1650.5208,1062.3779,1660.9375,1066.5446,1650.5208,1070.7113,1654.6875,1066.5446" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="1428.6458" x2="1656.7708" y1="1066.5446" y2="1066.5446"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="209.375" x="1435.9375" y="1061.2676">invite von Nutzer A an Nutzer B</text><line style="stroke:#000000;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="186.4583" x2="1946.3542" y1="1075.9196" y2="1075.9196"/><text fill="#000000" font-family="sans-serif" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="158.3333" x="191.6667" y="1086.5555">[Invite ist nicht erlaubt]</text><polygon fill="#383838" points="1440.1042,1108.1462,1429.6875,1112.3128,1440.1042,1116.4795,1435.9375,1112.3128" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="1433.8542" x2="1918.2292" y1="1112.3128" y2="1112.3128"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="100" x="1446.3542" y="1107.0358">Response false</text><polygon fill="#383838" points="651.5625,1138.4928,641.1458,1142.6595,651.5625,1146.8262,647.3958,1142.6595" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="645.3125" x2="1417.1875" y1="1142.6595" y2="1142.6595"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="348.9583" x="657.8125" y="1137.3825">ERROR: invite von Nutzer A an Nutzer B nicht erlaubt</text><polygon fill="#383838" points="267.1875,1168.8395,256.7708,1173.0062,267.1875,1177.1729,263.0208,1173.0062" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="260.9375" x2="628.6458" y1="1173.0062" y2="1173.0062"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="348.9583" x="273.4375" y="1167.7292">ERROR: invite von Nutzer A an Nutzer B nicht erlaubt</text><!--MD5=[77871b7fa2da161d7d59557857f1c691]
@startuml TI-Messenger communication control without PASSporT
/'
Vorteile:
- bessere Kompatibilität mit Matrix API
- einfachere Architektur
- keine Signaturprüfung von PASSporT im Messenger-Proxy
  - kein download von Signatur-, CA- und Root-Zertifikaten erforderlich (Schnittstelle und
    Spezifikation fehlen noch in aktueller Spec)
  - keine Abhängigkeit mehr zu PT Infrastructure
- Bessere Latenz bei Suchen im FHIR-Dir
  - einheitliche Schnittstelle im FHIR-Dir für TIM und KIM 2.0
  - geringere Abhängigkeit vom FHIR-Dir
- Ermöglicht TI 2.0 Zero Trust Architektur (Policy Decision Point (PDP) ist entweder in
  Registrierungsdienst integriert oder eigenständige Komponente, Policy Enforcement Point ist der Messenger-Proxy)
  - einfache Erweiterung um zusätzliche Policies im PDP möglich (z. B. für Versicherte)
  - Sicherheit von TIM wird durch TIM-Komponenten kontrolliert (und nicht durch das FHIR-Dir)
- Bessere UX für Austausch von TI-M Adressen bei persönlichem Kontakt.
  - Austausch von TIM Adressen grundsätzlich auch remote möglich

Was muss getan werden, um ohne PASSporTs auszukommen?
- PASSporT aus der TI-M Spec entfernen
- PASSporT aus der FHIR-Dir Spec entfernen
- REST Operationen am Messenger-Proxy spezifizieren (invite von MXIDs erlauben und Erlaubnis widerrufen,
  Dauer der Erlaubnis als Parameter)
- zusätzliche REST Operationen an I_TIM_Provider_Services
- Erläuternde Beschreibung der Abläufe zwischen Messenger-Proxy und Registrierungsdienst
'/
skinparam dpi 100
skinparam WrapWidth 200
skinparam monochrome true

actor a as "Nutzer A"
participant cl as "TI-M Client A"
participant mp as "Messenger-Service A\n(Messenger-Proxy +\nHomeserver)"
participant fd as "FHIR-Directory"
participant rdb as "Registrierungsdienst B"
participant mpb as "Messenger-Service B\n(Messenger-Proxy +\nHomeserver)"
participant clb as "TI-M Client B"
actor b as "Nutzer B"

alt Suche im FHIR-Directory
a -> cl: möchte TI-M Kontakt zum\nchatten finden
activate cl
cl -> fd: FHIR search request
activate fd
fd - -> cl: FHIR response mit MXID von Nutzer B
deactivate fd
end
alt Tauscht bei persönlichem Treffen MXID mit Nutzer B aus
a -> b: Kontaktdaten austauschen per App
a -> cl: MXID von Nutzer B\nzu Kontakten hinzufügen
b -> clb: MXID von Nutzer A\nzu Kontakten hinzufügen
activate clb
cl -> mp: invite von Nutzer B ist erlaubt
clb -> mpb: invite von Nutzer A ist erlaubt
activate mpb
end
cl -> mp: create room
activate mp
mp - -> cl: room created

' Invite
cl -> mp: invite von Nutzer A an Nutzer B
mp -> mpb: invite von Nutzer A an Nutzer B
alt invite von Nutzer A ist erlaubt
mpb -> clb: invite von Nutzer A an Nutzer B
else invite von Nutzer A nicht erlaubt
mpb -> rdb: REST Operation\nIsAllowedCommunication(src=MXID Nutzer A,\n dst=MXID Nutzer B)
activate rdb
rdb -> rdb: hashA = hash(MXID Nutzer A),\nhashB = hash(MXID Nutzer B)
rdb -> fd: REST Operation\nWhereIs(hashA), WhereIs(hashB)
activate fd
fd - -> rdb: Response (hashA is in PractitionerDir),\nResponse (hashB is in OrganizationDir)
deactivate fd
rdb -> rdb: Cache Response (1 Tag)
rdb -> rdb: Decision[\nif hashB is in organization directory then true\nelse if hashA is in practitioner directory\n and hashB is in practitioner directory then true\nelse false]
rdb - -> mpb: Response true
mpb -> clb: invite von Nutzer A an Nutzer B
else Invite ist nicht erlaubt
rd - -> mpb: Response false
mpb -> mp: ERROR: invite von Nutzer A an Nutzer B nicht erlaubt
mp - -> cl: ERROR: invite von Nutzer A an Nutzer B nicht erlaubt
end
deactivate clb
deactivate mpb
deactivate mp
deactivate cl
@enduml

@startuml TI-Messenger communication control without PASSporT
skinparam dpi 100
skinparam WrapWidth 200
skinparam monochrome true

actor a as "Nutzer A"
participant cl as "TI-M Client A"
participant mp as "Messenger-Service A\n(Messenger-Proxy +\nHomeserver)"
participant fd as "FHIR-Directory"
participant rdb as "Registrierungsdienst B"
participant mpb as "Messenger-Service B\n(Messenger-Proxy +\nHomeserver)"
participant clb as "TI-M Client B"
actor b as "Nutzer B"

alt Suche im FHIR-Directory
a -> cl: möchte TI-M Kontakt zum\nchatten finden
activate cl
cl -> fd: FHIR search request
activate fd
fd - -> cl: FHIR response mit MXID von Nutzer B
deactivate fd
end
alt Tauscht bei persönlichem Treffen MXID mit Nutzer B aus
a -> b: Kontaktdaten austauschen per App
a -> cl: MXID von Nutzer B\nzu Kontakten hinzufügen
b -> clb: MXID von Nutzer A\nzu Kontakten hinzufügen
activate clb
cl -> mp: invite von Nutzer B ist erlaubt
clb -> mpb: invite von Nutzer A ist erlaubt
activate mpb
end
cl -> mp: create room
activate mp
mp - -> cl: room created

cl -> mp: invite von Nutzer A an Nutzer B
mp -> mpb: invite von Nutzer A an Nutzer B
alt invite von Nutzer A ist erlaubt
mpb -> clb: invite von Nutzer A an Nutzer B
else invite von Nutzer A nicht erlaubt
mpb -> rdb: REST Operation\nIsAllowedCommunication(src=MXID Nutzer A,\n dst=MXID Nutzer B)
activate rdb
rdb -> rdb: hashA = hash(MXID Nutzer A),\nhashB = hash(MXID Nutzer B)
rdb -> fd: REST Operation\nWhereIs(hashA), WhereIs(hashB)
activate fd
fd - -> rdb: Response (hashA is in PractitionerDir),\nResponse (hashB is in OrganizationDir)
deactivate fd
rdb -> rdb: Cache Response (1 Tag)
rdb -> rdb: Decision[\nif hashB is in organization directory then true\nelse if hashA is in practitioner directory\n and hashB is in practitioner directory then true\nelse false]
rdb - -> mpb: Response true
mpb -> clb: invite von Nutzer A an Nutzer B
else Invite ist nicht erlaubt
rd - -> mpb: Response false
mpb -> mp: ERROR: invite von Nutzer A an Nutzer B nicht erlaubt
mp - -> cl: ERROR: invite von Nutzer A an Nutzer B nicht erlaubt
end
deactivate clb
deactivate mpb
deactivate mp
deactivate cl
@enduml

PlantUML version 1.2021.16(Wed Dec 08 17:25:22 UTC 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>